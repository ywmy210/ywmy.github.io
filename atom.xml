<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ywmy运维日志</title>
  
  <subtitle>network &amp; delicacy</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2021-02-22T08:02:52.741Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>Ian &amp; Doudou</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>dpkg 清除已卸载程序的配置信息</title>
    <link href="http://example.com/2021/02/22/dpkg-%E6%B8%85%E9%99%A4%E5%B7%B2%E5%8D%B8%E8%BD%BD%E7%A8%8B%E5%BA%8F%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF/"/>
    <id>http://example.com/2021/02/22/dpkg-清除已卸载程序的配置信息/</id>
    <published>2021-02-22T07:30:03.000Z</published>
    <updated>2021-02-22T08:02:52.741Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ubuntu清除已卸载程序的配置文件"><a href="#ubuntu清除已卸载程序的配置文件" class="headerlink" title="ubuntu清除已卸载程序的配置文件"></a>ubuntu清除已卸载程序的配置文件</h2><p>ubuntu 上卸载软件后，后有一些残留的配置文件信息在电脑里面，操作清除配置文件。</p><p>1、使用dpkg -l 列出系统安装包信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">dpkg -l</span><br><span class="line">期望状态=未知(u)/安装(i)/删除(r)/清除(p)/保持(h)</span><br><span class="line">| 状态=未安装(n)/已安装(i)/仅存配置(c)/仅解压缩(U)/配置失败(F)/不完全安装(H)/触发器等待(W)/触发器未决(T)</span><br><span class="line">|/ 错误?=(无)/须重装(R) (状态，错误：大写=故障)</span><br><span class="line">||/ 名称                                          版本                                     体系结构     描述</span><br><span class="line">+++-=============================================-========================================-============-======================================================================================</span><br><span class="line">================</span><br><span class="line">ii  accountsservice                               0.6.55-0ubuntu12~20.04.4                 amd64        query and manipulate user account information</span><br><span class="line">ii  acl                                           2.2.53-6                                 amd64        access control list - utilities</span><br><span class="line">ii  acpi-support                                  0.143                                    amd64        scripts <span class="keyword">for</span> handling many ACPI events</span><br><span class="line">ii  acpid                                         1:2.0.32-1ubuntu1                        amd64        Advanced Configuration and Power Interface event daemon</span><br><span class="line">ii  adb                                           1:8.1.0+r23-5ubuntu2                     amd64        Android Debug Bridge</span><br><span class="line"><span class="comment">### 示例</span></span><br></pre></td></tr></table></figure><p>2、选出已经删除的但有配置残留的包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pkg -l | grep <span class="string">&quot;^rc&quot;</span></span><br><span class="line">rc  spark-typeeasy:i386                           1.0                                      i386         Typeeasy on Deepin Wine</span><br><span class="line">rc  wechat                                        2.0.0                                    amd64        微信</span><br></pre></td></tr></table></figure><p>卸载过的微信uos版客户端的金山打字通。</p><p>3、清除配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dpkg -l | grep <span class="string">&quot;^rc&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs sudo aptitude -y purge</span><br><span class="line">[sudo] ian 的密码： </span><br><span class="line">下列软件包将被“删除”：           </span><br><span class="line">  spark-typeeasy:i386&#123;p&#125; wechat&#123;p&#125; </span><br><span class="line">0 个软件包被升级，新安装 0 个，2 个将被删除， 同时 0 个将不升级。</span><br><span class="line">需要获取 0 B 的存档。解包后将要使用 0 B。</span><br><span class="line">(正在读取数据库 ... 系统当前共安装有 815779 个文件和目录。)</span><br><span class="line">正在清除 wechat (2.0.0) 的配置文件 ...</span><br><span class="line">正在清除 spark-typeeasy:i386 (1.0) 的配置文件 ...</span><br></pre></td></tr></table></figure><p>如上示例：</p><p>dpkg -l 列出所有包的状态，grep 提取开头为rc的包，awk命令打印这些包的第二个字段，即包的名字，再通过xargs命令传递到 sudo aptitude -y purge后面，purge命令会消除配置文件。-y参数自动对后面aptitude命令提示回答yes。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ubuntu清除已卸载程序的配置文件&quot;&gt;&lt;a href=&quot;#ubuntu清除已卸载程序的配置文件&quot; class=&quot;headerlink&quot; title=&quot;ubuntu清除已卸载程序的配置文件&quot;&gt;&lt;/a&gt;ubuntu清除已卸载程序的配置文件&lt;/h2&gt;&lt;p&gt;ubuntu
      
    
    </summary>
    
    
      <category term="linux" scheme="http://example.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>history 环境变量</title>
    <link href="http://example.com/2021/02/22/history-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/"/>
    <id>http://example.com/2021/02/22/history-环境变量/</id>
    <published>2021-02-22T06:39:16.000Z</published>
    <updated>2021-02-22T06:56:55.865Z</updated>
    
    <content type="html"><![CDATA[<h2 id="linux-添加history-环境变量"><a href="#linux-添加history-环境变量" class="headerlink" title="linux 添加history 环境变量"></a>linux 添加history 环境变量</h2><p>在linux下，我们可以通过history命令来查看用户的历史操作记录，在未进行配置的情况下，history只能查看历史操作记录，不记录时间及用户。可以从审计的角度来做一些事情。让history日志记录更细化。</p><p>1、命令历史记录中添加时间、源、用户信息</p><p>在/etc/profile.d目录下创建history.sh文件,不建议直接修改profile文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># history</span></span><br><span class="line">USER_IP=`who -u am i 2&gt;/dev/null | awk <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span> | sed -e <span class="string">&#x27;s/[()]//g&#x27;</span>`</span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$USER_IP</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">USER_IP=`hostname`</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> HISTTIMEFORMAT=<span class="string">&quot;[%Y.%m.%d %H:%M:%S][<span class="variable">$&#123;USER_IP&#125;</span>-<span class="variable">$&#123;LOGNAME&#125;</span>]&quot;</span></span><br></pre></td></tr></table></figure><p>2、重新加载新的环境变量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sour /etc/profile</span><br></pre></td></tr></table></figure><p>更新完成后，执行history命令，即可看到history命令输出日志、时间、源IP、用户，以及运行的命令信息。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;linux-添加history-环境变量&quot;&gt;&lt;a href=&quot;#linux-添加history-环境变量&quot; class=&quot;headerlink&quot; title=&quot;linux 添加history 环境变量&quot;&gt;&lt;/a&gt;linux 添加history 环境变量&lt;/h2&gt;&lt;
      
    
    </summary>
    
    
      <category term="linux" scheme="http://example.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>cisco 恢复 enable 密码</title>
    <link href="http://example.com/2021/02/01/cisco-%E6%81%A2%E5%A4%8D-enable-%E5%AF%86%E7%A0%81/"/>
    <id>http://example.com/2021/02/01/cisco-恢复-enable-密码/</id>
    <published>2021-02-01T02:25:05.000Z</published>
    <updated>2021-02-01T04:18:47.236Z</updated>
    
    <content type="html"><![CDATA[<h2 id="cisco-4507-enable-密码恢复"><a href="#cisco-4507-enable-密码恢复" class="headerlink" title="cisco 4507 enable 密码恢复"></a>cisco 4507 enable 密码恢复</h2><p>公司项目上的一个问题，一台cisco 4507的交换机，被其它维护单位更改了enable密码，后面问到是否有更改密码，对方坚持说没有改过。着急配置，没办法只能着手恢复enable密码。</p><p><strong>Tips:恢复enable密码的操作不会丢失配置信息。建议通过tftp备份配置后操作。</strong></p><h3 id="1、重启设备加电"><a href="#1、重启设备加电" class="headerlink" title="1、重启设备加电"></a>1、重启设备加电</h3><p>重启后进入引导界面，5秒内按住<strong>Ctrl-C</strong>键，防止自动引导，进入ROM监视提示模式。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">!--- Here, you power cycle the switch.</span><br><span class="line"></span><br><span class="line">********************************************************** </span><br><span class="line"> *                                                        * </span><br><span class="line"> * Welcome to ROM Monitor <span class="keyword">for</span> WS-X4014 System.            * </span><br><span class="line"> * Copyright (c) 1999-2000, 2001 by Cisco Systems, Inc.   * </span><br><span class="line"> * All rights reserved.                                   * </span><br><span class="line"> *                                                        * </span><br><span class="line"> **********************************************************</span><br><span class="line"> </span><br><span class="line"> ROM Monitor Program Version 12.1(10r)EY(1.21) </span><br><span class="line"></span><br><span class="line"> Board <span class="built_in">type</span> 1, Board revision 7</span><br><span class="line"> Swamp FPGA revision 16, Dagobah FPGA revision 43 </span><br><span class="line"> </span><br><span class="line"> Timer interrupt <span class="built_in">test</span> passed.</span><br><span class="line"></span><br><span class="line"> MAC Address  : 00-02-b9-83-af-fe </span><br><span class="line"> IP Address   : 172.16.84.122 </span><br><span class="line"> Netmask      : 255.255.255.0 </span><br><span class="line"> Gateway      : 172.16.84.1 </span><br><span class="line"> TftpServer   : Not <span class="built_in">set</span>. </span><br><span class="line"> Main Memory  : 256 MBytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> ***** The system will autoboot <span class="keyword">in</span> 5 seconds *****</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> Type control-C to prevent autobooting. </span><br><span class="line"></span><br><span class="line">!--- At this point, press Ctrl-C.</span><br><span class="line"></span><br><span class="line">Autoboot cancelled......... please <span class="built_in">wait</span>!!!</span><br><span class="line">Autoboot cancelled......... please <span class="built_in">wait</span>!!!</span><br><span class="line">rommon 1 &gt; [interrupt]  </span><br><span class="line"></span><br><span class="line">!--- The module ended <span class="keyword">in</span> the ROMmon.</span><br><span class="line"></span><br><span class="line">rommon 1 &gt; [interrupt]</span><br></pre></td></tr></table></figure><h3 id="2、在common模式下使用confreg配置"><a href="#2、在common模式下使用confreg配置" class="headerlink" title="2、在common模式下使用confreg配置"></a>2、在common模式下使用confreg配置</h3><p>使重新启动从新的寄存器中加载配置。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">rommon 1 &gt; <span class="built_in">set</span></span><br><span class="line">rommon 1 &gt; confreg</span><br><span class="line"></span><br><span class="line"> Configuration Summary : </span><br><span class="line"> =&gt; load ROM after netboot fails</span><br><span class="line"> =&gt; console baud: 9600</span><br><span class="line"> =&gt; autoboot from: commands specified <span class="keyword">in</span> <span class="string">&#x27;BOOT&#x27;</span> environment variable</span><br><span class="line"></span><br><span class="line"> <span class="keyword">do</span> you wish to change the configuration? y/n  [n]:  **y**</span><br><span class="line"> <span class="built_in">enable</span>  <span class="string">&quot;diagnostic mode&quot;</span>? y/n  [n]:  **n**</span><br><span class="line"> <span class="built_in">enable</span>  <span class="string">&quot;use net in IP bcast address&quot;</span>? y/n  [n]:  **n**</span><br><span class="line"> <span class="built_in">disable</span> <span class="string">&quot;load ROM after netboot fails&quot;</span>? y/n  [n]:  **n**</span><br><span class="line"> <span class="built_in">enable</span>  <span class="string">&quot;use all zero broadcast&quot;</span>? y/n  [n]:  **n**</span><br><span class="line"> <span class="built_in">enable</span>  <span class="string">&quot;break/abort has effect&quot;</span>? y/n  [n]:  **n**</span><br><span class="line"> <span class="built_in">enable</span>  <span class="string">&quot;ignore system config info&quot;</span>? y/n  [n]:  **y**</span><br><span class="line"></span><br><span class="line"> change console baud rate? y/n  [n]:  **n**</span><br><span class="line"></span><br><span class="line"> change the boot characteristics? y/n  [n]:  **n**</span><br><span class="line"></span><br><span class="line"> Configuration Summary : </span><br><span class="line"> =&gt; load ROM after netboot fails</span><br><span class="line"> =&gt; ignore system config info</span><br><span class="line"> =&gt; console baud: 9600</span><br><span class="line"> =&gt; autoboot from: commands specified <span class="keyword">in</span> <span class="string">&#x27;BOOT&#x27;</span> environment variable</span><br><span class="line"></span><br><span class="line"> <span class="keyword">do</span> you wish to save this configuration? y/n  [n]:  y</span><br><span class="line"> You must reset or power cycle <span class="keyword">for</span> new configuration to take effect</span><br><span class="line">Note: You can also use the confreg 0x2142 <span class="built_in">command</span> at the ROMmon prompt <span class="keyword">in</span> order to <span class="built_in">set</span> the configuration register value to bypass the startup configuration stored <span class="keyword">in</span> NVRAM.</span><br><span class="line"></span><br><span class="line">rommon 1 &gt;confreg 0x2142  <span class="comment">#记住这里寄存器的位置</span></span><br><span class="line">You must reset or power cycle <span class="keyword">for</span> the new configuration to take effect.</span><br></pre></td></tr></table></figure><h3 id="3、重启设备"><a href="#3、重启设备" class="headerlink" title="3、重启设备"></a>3、重启设备</h3><p>使用reset命令重新引导模块，因为第二步中配置忽略系统配置信息，这里将不会引导已保存的配置信息。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">rommon 2 &gt; reset</span><br><span class="line"></span><br><span class="line">Resetting .......</span><br><span class="line"></span><br><span class="line">rommon 3 &gt;</span><br><span class="line"></span><br><span class="line"> ********************************************************** </span><br><span class="line"> *                                                        * </span><br><span class="line"> * Welcome to ROM Monitor <span class="keyword">for</span> WS-X4014 System.            * </span><br><span class="line"> * Copyright (c) 1999-2000, 2001 by Cisco Systems, Inc.   * </span><br><span class="line"> * All rights reserved.                                   * </span><br><span class="line"> *                                                        * </span><br><span class="line"> **********************************************************</span><br><span class="line"></span><br><span class="line">!--- Output suppressed.</span><br><span class="line"></span><br><span class="line">Press RETURN to get started! </span><br><span class="line"></span><br><span class="line">!--- Press Return.</span><br><span class="line"></span><br><span class="line">00:00:21: %SYS-5-RESTART: System restarted --</span><br><span class="line">Cisco Internetwork Operating System Software </span><br><span class="line">IOS (tm) Catalyst 4000 L3 Switch Software (cat4000-IS-M), </span><br><span class="line">   Version 12.1(8a)EW,  RELEASE SOFTWARE (fc1)</span><br><span class="line">TAC Support: http://www.cisco.com/tac</span><br><span class="line">Copyright (c) 1986-2002 by cisco Systems, Inc.</span><br><span class="line">Compiled Thu 24-Jan-02 17:34 by ccai</span><br><span class="line">00:00:21: %SNMP-5-COLDSTART: SNMP agent on host Switch </span><br><span class="line">   is undergoing a cold start</span><br><span class="line">Switch&gt;</span><br></pre></td></tr></table></figure><h3 id="4、加载"><a href="#4、加载" class="headerlink" title="4、加载"></a>4、加载</h3><p>此值使设备从Flash启动，而无需加载已保存的配置。在Switch提示符下发出enable命令进入启用模式。然后，使用show version命令以检查配置寄存器值。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Switch&gt; <span class="built_in">enable</span></span><br><span class="line">Switch<span class="comment">#show version</span></span><br><span class="line">Cisco Internetwork Operating System Software </span><br><span class="line">IOS (TM) Catalyst 4000 L3 Switch Software (cat4000-IS-M),</span><br><span class="line">   Version 12.1(8a)EW,  RELEASE SOFTWARE (fc1)</span><br><span class="line">TAC Support: http://www.cisco.com/tac</span><br><span class="line">Copyright (c) 1986-2002 by cisco Systems, Inc.</span><br><span class="line">Compiled Thu 24-Jan-02 17:34 by ccai</span><br><span class="line">Image text-base: 0x00000000, data-base: 0x00AA2B8C</span><br><span class="line"></span><br><span class="line">ROM: 12.1(10r)EY(1.21)</span><br><span class="line">Switch uptime is 5 minutes</span><br><span class="line">System returned to ROM by reload</span><br><span class="line">Running default software</span><br><span class="line"></span><br><span class="line">cisco WS-C4006 (MPC8245) processor (revision 7) with 262144K bytes of memory.</span><br><span class="line">Processor board ID FOX04183666</span><br><span class="line">Last reset from Reload</span><br><span class="line">32 Gigabit Ethernet/IEEE 802.3 interface(s)</span><br><span class="line">467K bytes of non-volatile configuration memory.</span><br><span class="line"></span><br><span class="line">Configuration register is 0x2142  <span class="comment">#查看加载的寄存器地址</span></span><br><span class="line"></span><br><span class="line">Switch<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="5、将配置恢复到内存中"><a href="#5、将配置恢复到内存中" class="headerlink" title="5、将配置恢复到内存中"></a>5、将配置恢复到内存中</h3><p>使用configure memory命令或copy startup-config running-config命令将NVRAM复制到内存中。<br>请勿使用configure terminal命令，该命令显示模块的默认配置。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Switch<span class="comment">#configure memory</span></span><br><span class="line"></span><br><span class="line">Uncompressed configuration from 1307 bytes to 3014 bytes</span><br><span class="line">Switch<span class="comment">#</span></span><br><span class="line">00:13:52: %SYS-5-CONFIG_I: Configured from memory by console</span><br><span class="line">c-4006-SUPIII<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="6、检查接口状态"><a href="#6、检查接口状态" class="headerlink" title="6、检查接口状态"></a>6、检查接口状态</h3><p>使用show ip interface brief命令以确保之前使用的接口显示“ up up ”状态。<br>如果在密码恢复之前使用的任何接口显示“ down ”，请在该接口上发出no shutdown命令以启动接口。</p><h3 id="7、检查配置文件"><a href="#7、检查配置文件" class="headerlink" title="7、检查配置文件"></a>7、检查配置文件</h3><p>使用write terminal命令和show running-config命令检查配置。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">c-4006-SUPIII<span class="comment">#show running-config </span></span><br><span class="line">Building configuration...</span><br><span class="line"></span><br><span class="line">Current configuration : 3014 bytes</span><br><span class="line">!</span><br><span class="line">version 12.1</span><br><span class="line">no service pad</span><br><span class="line">service timestamps debug uptime</span><br><span class="line">service timestamps <span class="built_in">log</span> uptime</span><br><span class="line">no service password-encryption</span><br><span class="line">service compress-config</span><br><span class="line">!</span><br><span class="line">hostname c-4006-SUPIII</span><br><span class="line">!</span><br><span class="line">boot system flash bootflash:</span><br><span class="line">!</span><br><span class="line">vtp mode transparent</span><br><span class="line"></span><br><span class="line">!--- Output suppressed.</span><br><span class="line"></span><br><span class="line">line con 0</span><br><span class="line"> stopbits 1</span><br><span class="line">line vty 0 4</span><br><span class="line"> login</span><br><span class="line">!</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">c-4006-SUPIII<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>现在可以更改密码了。</p><h3 id="更改密码"><a href="#更改密码" class="headerlink" title="更改密码"></a>更改密码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">c-4006-SUPIII<span class="comment">#configure terminal </span></span><br><span class="line">Enter configuration commands, one per line.  End with CNTL/Z.</span><br><span class="line">c-4006-SUPIII(config)<span class="comment">#no enable secret  #删除旧密码</span></span><br><span class="line"></span><br><span class="line">!--- This step is necessary <span class="keyword">if</span> the switch had an <span class="built_in">enable</span> !--- secret password.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c-4006-SUPIII(config)<span class="comment">#enable secret &lt; password &gt;  设置新密码</span></span><br><span class="line">[Choose a strong password with at least one capital letter,</span><br><span class="line"> one number, and one special character.]</span><br><span class="line"></span><br><span class="line">!--- This <span class="built_in">command</span> sets the new password.</span><br></pre></td></tr></table></figure><h3 id="确保将配置寄存器的值改回0x2102"><a href="#确保将配置寄存器的值改回0x2102" class="headerlink" title="确保将配置寄存器的值改回0x2102"></a>确保将配置寄存器的值改回0x2102</h3><p>在config模式下更改寄存器的值，并查看下一次启动引导寄存器位置是否正确。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">c-4006-SUPIII(config)<span class="comment">#config-register 0x2102</span></span><br><span class="line">c-4006-SUPIII(config)<span class="comment"># ^Z</span></span><br><span class="line">c-4006-SUPIII<span class="comment">#</span></span><br><span class="line">00:19:01: %SYS-5-CONFIG_I: Configured from console by console</span><br><span class="line">c-4006-SUPIII<span class="comment">#write memory </span></span><br><span class="line"></span><br><span class="line">!--- This step saves the configuration.</span><br><span class="line"></span><br><span class="line">Building configuration...</span><br><span class="line">Compressed configuration from 3061 bytes to 1365 bytes[OK]</span><br><span class="line">c-4006-SUPIII<span class="comment">#show version </span></span><br><span class="line"></span><br><span class="line">!--- This step verifies the value change.</span><br><span class="line"></span><br><span class="line">Cisco Internetwork Operating System Software </span><br><span class="line">IOS (TM) Catalyst 4000 L3 Switch Software (cat4000-IS-M), </span><br><span class="line">Version 12.1(8a)EW,  RELEASE SOFTWARE (fc1)</span><br><span class="line">TAC Support: http://www.cisco.com/tac</span><br><span class="line">Copyright (c) 1986-2002 by cisco Systems, Inc.</span><br><span class="line">Compiled Thu 24-Jan-02 17:34 by ccai</span><br><span class="line">Image text-base: 0x00000000, database: 0x00AA2B8C</span><br><span class="line"></span><br><span class="line">ROM: 12.1(10r)EY(1.21)</span><br><span class="line">c-4006-SUPIII uptime is 20 minutes</span><br><span class="line">System returned to ROM by reload</span><br><span class="line">Running default software</span><br><span class="line"></span><br><span class="line">cisco WS-C4006 (MPC8245) processor (revision 7) with 262144K bytes of memory.</span><br><span class="line">Processor board ID FOX04183666</span><br><span class="line">Last reset from Reload</span><br><span class="line">32 Gigabit Ethernet/IEEE 802.3 interface(s)</span><br><span class="line">467K bytes of nonvolatile configuration memory.</span><br><span class="line"></span><br><span class="line">Configuration register is 0x2142 (will be 0x2102 at next reload)</span><br><span class="line"></span><br><span class="line">c-4006-SUPIII<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>到这一步，已经完成enable密码更改了。</p><p>参考<a href="https://www.cisco.com/c/en/us/support/docs/switches/catalyst-4000-series-switches/21229-pswdrec-cat4000-supiii-21229.html">链接</a>，<a href="https://www.hello2099.com/1913.html">链接</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;cisco-4507-enable-密码恢复&quot;&gt;&lt;a href=&quot;#cisco-4507-enable-密码恢复&quot; class=&quot;headerlink&quot; title=&quot;cisco 4507 enable 密码恢复&quot;&gt;&lt;/a&gt;cisco 4507 enable 密码
      
    
    </summary>
    
    
      <category term="network" scheme="http://example.com/tags/network/"/>
    
  </entry>
  
  <entry>
    <title>mu-editor python3 PyQt5相关问题</title>
    <link href="http://example.com/2021/01/31/mu-editor-python3-PyQt5%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/"/>
    <id>http://example.com/2021/01/31/mu-editor-python3-PyQt5相关问题/</id>
    <published>2021-01-31T08:25:55.000Z</published>
    <updated>2021-01-31T09:07:32.540Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ubuntu-20-04-python3"><a href="#ubuntu-20-04-python3" class="headerlink" title="ubuntu 20.04 python3"></a>ubuntu 20.04 python3</h2><p>最近无事，电脑的ubuntu 18.04提示升级，一时手痒，升级到了20.04。升级结束，启用了相关的软件源，确实是有很多非ubuntu源里的软件不可以使用了。</p><p>之前使用的一个简单的python3 IDE打开提示报错，重新安装mu-editor。</p><p>ubuntu下安装，直接使用pip安装。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pip3 install mu-editor</span><br><span class="line"><span class="comment"># 创建快捷方式</span></span><br><span class="line">pip3 install shortcut</span><br><span class="line">shortcut mu-editor</span><br></pre></td></tr></table></figure><p>运行程序报错：</p><blockquote><p>ModuleNotFoundError: No module named ‘PyQt5.QtSerialPort’</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 尝试操作如下:</span></span><br><span class="line">sudo pip3 install --upgrade pip setuptools pyserial --upgrade</span><br><span class="line">sudo pip3 install --upgrade pip setuptools -i https://pypi.tuna.tsinghua.edu.cn/simple   <span class="comment"># -i 指定清华的python3源</span></span><br><span class="line">sudo pip3 install launchpadlib -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line">sudo pip3 install pyserial -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line"></span><br><span class="line">sudo apt install python3 python3-pip</span><br><span class="line">sudo apt install python3 python3-pyqt5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新安装 python3 python3-pyqt5</span></span><br><span class="line">sudo apt install python3-serial python3-pyqt5 --reinstall</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重点这个</span></span><br><span class="line">sudo apt-get install python3-pyqt5.qtserialport</span><br><span class="line"></span><br><span class="line">运行时，还有错误</span><br><span class="line">sudo apt-get install python3-pyqt5.qsci</span><br><span class="line"></span><br><span class="line">装完这个后，正常使用了。缺哪个装哪个。</span><br></pre></td></tr></table></figure><p>参考<a href="https://github.com/tasmota/tasmotizer/issues/12">连接</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ubuntu-20-04-python3&quot;&gt;&lt;a href=&quot;#ubuntu-20-04-python3&quot; class=&quot;headerlink&quot; title=&quot;ubuntu 20.04 python3&quot;&gt;&lt;/a&gt;ubuntu 20.04 python3&lt;/h2&gt;&lt;
      
    
    </summary>
    
    
      <category term="linux" scheme="http://example.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>openssh 添加 sha1支持</title>
    <link href="http://example.com/2021/01/29/openssh-%E6%B7%BB%E5%8A%A0-sha1%E6%94%AF%E6%8C%81/"/>
    <id>http://example.com/2021/01/29/openssh-添加-sha1支持/</id>
    <published>2021-01-29T06:32:45.000Z</published>
    <updated>2021-01-29T09:21:36.288Z</updated>
    
    <content type="html"><![CDATA[<h2 id="openssh-添加-sha1支持"><a href="#openssh-添加-sha1支持" class="headerlink" title="openssh 添加 sha1支持"></a>openssh 添加 sha1支持</h2><p>ubuntu 20.04 默认的 openssh 版本8.2p1不再支持老的hash加密算法。连接网络设备时报错。提示如下：</p><blockquote><p>Unable to negotiate with 10.10.100.253 port 22: no matching key exchange method found. Their offer: diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1</p></blockquote><p><img src="https://blog.ywmy.xyz/network/diffine-hellman.jpg" alt="diffine-hellman"></p><h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><ul><li>方法一</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -oKexAlgorithms=+diffie-hellman-group1-sha1 user@legacyhost</span><br></pre></td></tr></table></figure><p>如上面示例设备提供的加密算法为diffie-hellman-group14-sha1<br>连接时实际使用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -oKexAlgorithms=+diffie-hellman-group14-sha1 admin@10.10.100.253</span><br></pre></td></tr></table></figure><ul><li>方法二</li></ul><p>编辑家目录下的配置文件(~/.ssh/config)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Host somehost.example.org</span><br><span class="line">    KexAlgorithms +diffie-hellman-group1-sha1</span><br></pre></td></tr></table></figure><p>追加到config文件后面，即可。</p><p>其它的算法支持，参考openssh官方<a href="http://www.openssh.com/legacy.html">文档</a>。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;openssh-添加-sha1支持&quot;&gt;&lt;a href=&quot;#openssh-添加-sha1支持&quot; class=&quot;headerlink&quot; title=&quot;openssh 添加 sha1支持&quot;&gt;&lt;/a&gt;openssh 添加 sha1支持&lt;/h2&gt;&lt;p&gt;ubuntu 20.
      
    
    </summary>
    
    
      <category term="linux" scheme="http://example.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>华为设备安全登录示例</title>
    <link href="http://example.com/2021/01/29/%E5%8D%8E%E4%B8%BA%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%99%BB%E5%BD%95%E7%A4%BA%E4%BE%8B/"/>
    <id>http://example.com/2021/01/29/华为设备安全登录示例/</id>
    <published>2021-01-29T02:03:56.000Z</published>
    <updated>2021-01-29T03:00:56.260Z</updated>
    
    <content type="html"><![CDATA[<h2 id="设备登录安全配置示例"><a href="#设备登录安全配置示例" class="headerlink" title="设备登录安全配置示例"></a>设备登录安全配置示例</h2><p>登录设备的两种方式，本地console口和远程stelnet。</p><h3 id="本地console口登录安全配置示例"><a href="#本地console口登录安全配置示例" class="headerlink" title="本地console口登录安全配置示例"></a>本地console口登录安全配置示例</h3><p>通过Console口（也称串口）登录交换机是登录设备的最基本方式，也是其他登录方式（如Telnet和STelnet）的基础。一旦攻击者接触到Console口后，交换机将暴露给攻击者，交换机的安全无法保障。通过配置Console口用户界面的认证方式、用户的认证信息和用户级别，可以保证Console登录的安全性。</p><pre><code>**部署注意事项**- 如果用户通过console口登录设备再进行console用户界面配置，所配置的属性需要退出当前登录，再次通过console口登录后才会生效。- 为充分保证设备安全，首次登录设备时，必须按照要求修改缺省密码，并定期修改密码。</code></pre><h4 id="步骤1"><a href="#步骤1" class="headerlink" title="步骤1"></a>步骤1</h4><pre><code>配置console用户界面的认证方式。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] user-interface console 0 //进入Console用户界面</span><br><span class="line">[HUAWEI-console0] authentication-mode aaa //配置认证方式为AAA，默认情况下即AAA</span><br><span class="line">[HUAWEI-console0] quit</span><br></pre></td></tr></table></figure></code></pre><h4 id="步骤2"><a href="#步骤2" class="headerlink" title="步骤2"></a>步骤2</h4><pre><code>配置console用户认证信息及用户级别<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    [HUAWEI] aaa</span><br><span class="line">    [HUAWEI-aaa] local-user abcd password irreversible-cipher abcd@123 //创建本地用户abcd，登录密码为abcd@123</span><br><span class="line">    [HUAWEI-aaa] local-user abcd privilege level 15 //配置本地用户abcd的级别为15</span><br><span class="line">    Warning: This operation may ffcì online users, are you sure to change the user privilege level ?[Y/N]y</span><br><span class="line">    [HUAWEI-aaa] local-user abcd service-type terminal //配置本地用户abcd的接入类型为终端用</span><br><span class="line">户，即Console用户</span><br></pre></td></tr></table></figure></code></pre><h4 id="步骤3"><a href="#步骤3" class="headerlink" title="步骤3"></a>步骤3</h4><pre><code>通过console口连接设备，提示用户输入用户名密码，实现console口登录。（配置示例用户为abcd，密码为abcd@123）<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Login authentication</span><br><span class="line">Username:abcd</span><br><span class="line">Password: </span><br><span class="line">&lt;HUAWEI&gt;</span><br></pre></td></tr></table></figure>**结束**</code></pre><h3 id="远程stelnet登录安全配置示例"><a href="#远程stelnet登录安全配置示例" class="headerlink" title="远程stelnet登录安全配置示例"></a>远程stelnet登录安全配置示例</h3><p>Telnet和STelnet是远程登录交换机两种方式，Telnet协议存在安全风险，而STelnet则基于SSH协议，实现了在不安全网络上提供安全的远程登录，提供安全信息保障和强大认证功能，保护交换机不受IP欺骗等击。</p><pre><code>**部署注意事项**- 登录设备前，需要确保终端PC和设备之间路由可达。- 使用STelnet V1协议存在安全风险，建议使用STelnet V2登录设备。- 配置STelnet登录交换机前，用户终端应该已安装SSH服务器登录软件。如putty。- 通过STelnet登录设备需配置用户界面支持的协议是SSH，必须设置VTY用户界面认证方式为AAA认证。- 为充分保证设备安全，请定期修改密码。</code></pre><h4 id="step-1"><a href="#step-1" class="headerlink" title="step 1"></a>step 1</h4><pre><code>配置VTY用户界面的支持协议类型、认证方式和用户级别。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[HUAWEI] user-interface vty 0 4</span><br><span class="line">[HUAWEI-ui-vty0-4] authentication-mode aaa //配置VTY用户界面认证方式为AAA认证</span><br><span class="line">[HUAWEI-ui-vty0-4] protocol inbound ssh //配置VTY用户界面支持的协议为SSH，默认情况下即SSH</span><br><span class="line">[HUAWEI-ui-vty0-4] user privilege level 15 //配置VTY用户界面的级别为15</span><br><span class="line">[HUAWEI-ui-vty0-4] quit</span><br></pre></td></tr></table></figure></code></pre><h4 id="step-2"><a href="#step-2" class="headerlink" title="step 2"></a>step 2</h4><pre><code>开启STelnet服务器功能并创建SSH用户。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[HUAWEI] stelnet server <span class="built_in">enable</span> //使能设备的STelnet服务器功能</span><br><span class="line">[HUAWEI] ssh user abcd //创建SSH用户abcd</span><br><span class="line">[HUAWEI] ssh user abcd service-type stelnet //配置SSH用户的服务方式为STelnet</span><br></pre></td></tr></table></figure></code></pre><h4 id="step-3"><a href="#step-3" class="headerlink" title="step 3"></a>step 3</h4><pre><code>配置SSH用户认证方式为Password。使用Password认证方式时，需要在AAA视图下配置与SSH用户同名的本地用户。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[HUAWEI] ssh user abcd authentication-type password //配置SSH用户认证方式为password</span><br><span class="line">[HUAWEI] aaa</span><br><span class="line">[HUAWEI-aaa] local-user abcd password irreversible-cipher abcd@123 //创建与SSH用户同名的本地用户和对应的登录密码</span><br><span class="line">[HUAWEI-aaa] local-user abcd privilege level 15 //配置本地用户级别为15</span><br><span class="line">[HUAWEI-aaa] local-user abcd service-type ssh //配置本地用户的服务方式为SSH</span><br><span class="line">[HUAWEI-aaa] quit</span><br></pre></td></tr></table></figure># 配置SSH用户认证方式为RSA、DSA或ECC。（以ECC认证方式为例，RSA、DSA认证方式步骤类似）使用RSA、DSA或ECC认证方式时，需要在SSH服务器上输入SSH客户端生成的密钥中的公钥部分。这样当客户端登录服务器时，自己的私钥如果与输入的公钥匹配成功，则认证通过。客户端公钥的生成请参见相应的SSH客户端软件的帮助文档。[HUAWEI] ssh user abcd authentication-type ecc //配置SSH用户认证方式为ecc[HUAWEI] ecc peer-public-key key01 encoding-type pem //配置ECC公共密钥编码格式，并进入ECC公共密钥视图,key01为公共密钥名称Enter &quot;ECC public key&quot; view, return system view with &quot;peer-public-key end&quot;.[HUAWEI-ecc-public-key] public-key-code begin //进入公共密钥编辑视图Enter &quot;ECC key code&quot; view, return last view with &quot;public-key-code end&quot;.[HUAWEI-dsa-key-code] 308188 //拷贝复制客户端的公钥，为十六进制字符串[HUAWEI-dsa-key-code] 028180[HUAWEI-dsa-key-code] B21315DD 859AD7E4 A6D0D9B8 121F23F0 006BB1BB[HUAWEI-dsa-key-code] A443130F 7CDB95D8 4A4AE2F3 D94A73D7 36FDFD5F[HUAWEI-dsa-key-code] 411B8B73 3CDD494A 236F35AB 9BBFE19A 7336150B[HUAWEI-dsa-key-code] 40A35DE6 2C6A82D7 5C5F2C36 67FBC275 2DF7E4C5[HUAWEI-dsa-key-code] 1987178B 8C364D57 DD0AA24A A0C2F87F 474C7931[HUAWEI-ecc-key-code] A9F7E8FE E0D5A1B5 092F7112 660BD153 7FB7D5B2[HUAWEI-ecc-key-code] 171896FB 1FFC38CD[HUAWEI-ecc-key-code] 0203[HUAWEI-ecc-key-code] 010001[HUAWEI-ecc-key-code] public-key-code end //退回到公共密钥视图[HUAWEI-ecc-public-key] peer-public-key end //退回到系统视图[HUAWEI] ssh user abcd assign ecc-key key01 //为用户abcd分配一个已经存在的公钥key01</code></pre><h4 id="step-4"><a href="#step-4" class="headerlink" title="step 4"></a>step 4</h4><pre><code>在服务器端生成本地密钥对。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] ecc local-key-pair create</span><br><span class="line">Info: The key name will be: HUAWEI_Host_ECC.</span><br><span class="line">Info: The key modulus can be any one of the following: 256, 384, 521.</span><br><span class="line">Info: If the key modulus is greater than 512, it may take a few minutes.</span><br><span class="line">Please input the modulus [default=521]:521</span><br><span class="line">Info: Generating keys..........</span><br><span class="line">Info: Succeeded <span class="keyword">in</span> creating the ECC host keys.</span><br></pre></td></tr></table></figure></code></pre><h4 id="step-5"><a href="#step-5" class="headerlink" title="step 5"></a>step 5</h4><pre><code>PC端用Password认证方式连接SSH服务器。通过PuTTY软件登录设备，输入设备的IP地址，选择协议类型为SSH。```bashlogin as: abcdSent username &quot;abcd&quot;abcd@10.10.10.20&#39;s password:Info: The max number of VTY users is 8, and the number of current VTY users on line is 5. The current login time is 2018-12-22 09:35:28+00:00.&lt;HUAWEI&gt;**结束**</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;设备登录安全配置示例&quot;&gt;&lt;a href=&quot;#设备登录安全配置示例&quot; class=&quot;headerlink&quot; title=&quot;设备登录安全配置示例&quot;&gt;&lt;/a&gt;设备登录安全配置示例&lt;/h2&gt;&lt;p&gt;登录设备的两种方式，本地console口和远程stelnet。&lt;/p&gt;
&lt;h
      
    
    </summary>
    
    
      <category term="network" scheme="http://example.com/tags/network/"/>
    
  </entry>
  
  <entry>
    <title>linux nc 命令</title>
    <link href="http://example.com/2021/01/21/linux-nc-%E5%91%BD%E4%BB%A4/"/>
    <id>http://example.com/2021/01/21/linux-nc-命令/</id>
    <published>2021-01-21T14:32:58.000Z</published>
    <updated>2021-02-03T13:35:27.469Z</updated>
    
    <content type="html"><![CDATA[<p>Netcat 是一款简单的Unix工具，使用UDP和TCP协议。 它是一个可靠的容易被其他程序所启用的后台操作工具。 使用它你可以轻易的建立任何连接。内建有很多实用的工具。</p><h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc [-hlnruz][-g&lt;网关...&gt;][-G&lt;指向器数目&gt;][-i&lt;延迟秒数&gt;][-o&lt;输出文件&gt;][-p&lt;通信端口&gt;][-s&lt;来源位址&gt;][-v...][-w&lt;超时秒数&gt;][主机名称][通信端口...]</span><br></pre></td></tr></table></figure><h3 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h3><ul><li>-g&lt;网关&gt; 设置路由器跃程通信网关，最多可设置8个。</li><li>-G&lt;指向器数目&gt; 设置来源路由指向器，其数值为4的倍数。</li><li>-h 帮助</li><li>-i&lt;延迟秒数&gt; 设置时间间隔，以便传送信息及扫描端口。</li><li>-l 使用监听模式，管控传入信息。</li><li>-p 设置本地主机使用的通信端口</li><li>-u 使用UDP协议</li><li>-v 显示指令执行过程</li><li>-w 设置等待连线时间</li><li>-z 只扫描监听的进程</li></ul><h3 id="参考实例"><a href="#参考实例" class="headerlink" title="参考实例"></a>参考实例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># udp 端口扫描</span><br><span class="line">nc -zuv cn.pool.ntp.org 123  # 扫描cn.pool.ntp.org 的123 号端口</span><br><span class="line">Connection to cn.pool.ntp.org 123 port [udp&#x2F;ntp] succeeded!  # 扫描到使用udp传输的ntp协议</span><br><span class="line"># tcp 端口扫描</span><br><span class="line">nc -zv IP&#x2F;域名 port_number</span><br><span class="line">nc -zv a.b.c.d 22</span><br><span class="line">Connection to a.b.c.d 22 port [tcp&#x2F;ssh] succeeded!</span><br></pre></td></tr></table></figure><p>nc 端口通信测试见图示：<br><img src="https://blog.ywmy.xyz/nc_connected.gif" alt="nc端口通信测试"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Netcat 是一款简单的Unix工具，使用UDP和TCP协议。 它是一个可靠的容易被其他程序所启用的后台操作工具。 使用它你可以轻易的建立任何连接。内建有很多实用的工具。&lt;/p&gt;
&lt;h2 id=&quot;语法&quot;&gt;&lt;a href=&quot;#语法&quot; class=&quot;headerlink&quot; t
      
    
    </summary>
    
    
      <category term="linux" scheme="http://example.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>linux 时间同步</title>
    <link href="http://example.com/2020/07/28/linux-%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5/"/>
    <id>http://example.com/2020/07/28/linux-时间同步/</id>
    <published>2020-07-28T15:12:56.000Z</published>
    <updated>2021-01-21T14:33:58.696Z</updated>
    
    <content type="html"><![CDATA[<h2 id="linux时间同步"><a href="#linux时间同步" class="headerlink" title="linux时间同步"></a>linux时间同步</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每天早上0点执行</span></span><br><span class="line">0 0 * * * /usr/sbin/ntpdate cn.pool.ntp.org &amp;&amp; /sbin/hwclock -w</span><br><span class="line">0 0 * * * (/usr/sbin/ntpdate cn.pool.ntp.org ; /sbin/clock -w)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;linux时间同步&quot;&gt;&lt;a href=&quot;#linux时间同步&quot; class=&quot;headerlink&quot; title=&quot;linux时间同步&quot;&gt;&lt;/a&gt;linux时间同步&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td
      
    
    </summary>
    
    
      <category term="linux" scheme="http://example.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>编译安装zabbix agent</title>
    <link href="http://example.com/2020/03/21/%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85zabbix-agent/"/>
    <id>http://example.com/2020/03/21/编译安装zabbix-agent/</id>
    <published>2020-03-21T04:02:44.000Z</published>
    <updated>2021-01-21T14:53:35.550Z</updated>
    
    <content type="html"><![CDATA[<h2 id="编译安装zabbix-agent"><a href="#编译安装zabbix-agent" class="headerlink" title="编译安装zabbix-agent"></a>编译安装zabbix-agent</h2><p>前期依赖程序安装，下载zabbix相对应的软件包。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum update</span><br><span class="line">yum install epel-release gcc pcre-devel net-snmp-devel libevent-devel openssl-devel libxml2 libssh2-devel</span><br></pre></td></tr></table></figure><p>下载源代码归档<br>下载地址<a href="https://www.zabbix.com/download_agents">zabbix download page</a>，下载，解压源码.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf zabbix-3.4.15.tar.gz</span><br></pre></td></tr></table></figure><p>创建用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">groupadd --system zabbix</span><br><span class="line">useradd --system -g zabbix -d /usr/lib/zabbix -s /sbin/nologin -C <span class="string">&quot;Zabbix Monitoring System&quot;</span>  zabbix</span><br></pre></td></tr></table></figure><p>编译安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./configure --enable-agent  --prefix=/usr/<span class="built_in">local</span>/zabbix</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><p>更改配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/<span class="built_in">local</span>/zabbix/etc/zabbix_agentd.conf | grep -Ev <span class="string">&#x27;^#|^$&#x27;</span></span><br><span class="line">PidFile=/tmp/zabbix_agentd.pid</span><br><span class="line">LogFile=/tmp/zabbix_agentd.log</span><br><span class="line">Server=zabbix_server_or_proxy</span><br><span class="line">ServerActive=zabbix_server_or_proxy</span><br><span class="line">Hostname=your_computer_hostname</span><br></pre></td></tr></table></figure><p>添加开机启动项</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Zabbix Agent</span><br><span class="line">After=syslog.target</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=zabbix</span><br><span class="line">Group=zabbix</span><br><span class="line">Environment=<span class="string">&quot;CONFFILE=/usr/local/zabbix/etc/zabbix_agentd.conf&quot;</span></span><br><span class="line">Type=forking</span><br><span class="line">Restart=on-failure</span><br><span class="line">PIDFile=/tmp/zabbix_agentd.pid</span><br><span class="line">KillMode=control-group</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_agentd -c <span class="variable">$CONFFILE</span></span><br><span class="line">ExecStop=/bin/<span class="built_in">kill</span> -SIGTERM <span class="variable">$MAINPID</span></span><br><span class="line">RestartSec=10s</span><br><span class="line">TimeoutSec=0</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>防火墙配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --add-port=10050/tcp</span><br><span class="line">firelwall-cmd --permanent --add-port=10051/tcp</span><br><span class="line">firewall-cmd --complete-reload</span><br></pre></td></tr></table></figure><p>最后启动服务就完事了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start zabbix-agent</span><br><span class="line">systemctl <span class="built_in">enable</span> zabbix-agent</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;编译安装zabbix-agent&quot;&gt;&lt;a href=&quot;#编译安装zabbix-agent&quot; class=&quot;headerlink&quot; title=&quot;编译安装zabbix-agent&quot;&gt;&lt;/a&gt;编译安装zabbix-agent&lt;/h2&gt;&lt;p&gt;前期依赖程序安装，下载zab
      
    
    </summary>
    
    
      <category term="linux" scheme="http://example.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>mysql ibdata 数据迁移</title>
    <link href="http://example.com/2020/03/07/mysql-ibdata-%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB/"/>
    <id>http://example.com/2020/03/07/mysql-ibdata-数据迁移/</id>
    <published>2020-03-07T06:25:17.000Z</published>
    <updated>2021-02-03T13:36:54.223Z</updated>
    
    <content type="html"><![CDATA[<h2 id="mysql-ibdata1数据迁移"><a href="#mysql-ibdata1数据迁移" class="headerlink" title="mysql ibdata1数据迁移"></a>mysql ibdata1数据迁移</h2><p>这两天zabbix上提示一台数据库的空间要满了。mariadb是直接yum安装的，查了一下，/var/lib/mysql/下的文件ibdata1太大了，34G+，根目录下已经快撑满 了。看了一下硬盘的其它分区，还有一个目录挂载的还有500多个G，是肯定够用的。迁移操作如下：</p><p>1 备份数据库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home</span><br><span class="line">mkdri mysql </span><br><span class="line">chown mysql:mysql ./mysql -R</span><br><span class="line">mysqldump -u root -p --add-drop-table --all-databases &gt; ./mysql_20200307.sql</span><br></pre></td></tr></table></figure><p>2 关闭mysql服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop mariadb</span><br></pre></td></tr></table></figure><p>3 迁移数据</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var/lib/mysql/</span><br><span class="line">mv -rv ./* /home/mysql/</span><br></pre></td></tr></table></figure><p>4 修改mysql配置文件 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br><span class="line"><span class="comment"># 修改datadir和socket路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改前</span></span><br><span class="line">[mysqld]</span><br><span class="line">datadir=/var/lib/mysql</span><br><span class="line">socket=/var/lib/mysql/mysql.sock</span><br><span class="line"><span class="comment"># Disabling symbolic-links is recommended to prevent assorted security risks</span></span><br><span class="line">symbolic-links=0</span><br><span class="line"><span class="comment"># Settings user and group are ignored when systemd is used.</span></span><br><span class="line"><span class="comment"># If you need to run mysqld under a different user or group,</span></span><br><span class="line"><span class="comment"># customize your systemd unit file for mariadb according to the</span></span><br><span class="line"><span class="comment"># instructions in http://fedoraproject.org/wiki/Systemd</span></span><br><span class="line"></span><br><span class="line">[mysqld_safe]</span><br><span class="line">log-error=/var/<span class="built_in">log</span>/mariadb/mariadb.log</span><br><span class="line">pid-file=/var/run/mariadb/mariadb.pid</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># include all files from the config directory</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">!includedir /etc/my.cnf.d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改后</span></span><br><span class="line">[mysqld]</span><br><span class="line">datadir=/home/mysql</span><br><span class="line">socket=/home/mysql/mysql.sock</span><br><span class="line"><span class="comment"># Disabling symbolic-links is recommended to prevent assorted security risks</span></span><br><span class="line">symbolic-links=0</span><br><span class="line"><span class="comment"># Settings user and group are ignored when systemd is used.</span></span><br><span class="line"><span class="comment"># If you need to run mysqld under a different user or group,</span></span><br><span class="line"><span class="comment"># customize your systemd unit file for mariadb according to the</span></span><br><span class="line"><span class="comment"># instructions in http://fedoraproject.org/wiki/Systemd</span></span><br><span class="line"></span><br><span class="line">[mysqld_safe]</span><br><span class="line">log-error=/var/<span class="built_in">log</span>/mariadb/mariadb.log</span><br><span class="line">pid-file=/var/run/mariadb/mariadb.pid</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># include all files from the config directory</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">!includedir /etc/my.cnf.d</span><br></pre></td></tr></table></figure><p>5 重新启动mariadb</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mariadb</span><br><span class="line"><span class="comment"># 创建mysql.sock软链接</span></span><br><span class="line"></span><br><span class="line">ln -s /home/mysql/mysql.sock /var/lib/mysql/mysql.sock</span><br><span class="line"></span><br><span class="line">mysql -u root -p</span><br><span class="line"></span><br><span class="line">登录成功，mariadb服务和登录正常。</span><br></pre></td></tr></table></figure><p>结束。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;mysql-ibdata1数据迁移&quot;&gt;&lt;a href=&quot;#mysql-ibdata1数据迁移&quot; class=&quot;headerlink&quot; title=&quot;mysql ibdata1数据迁移&quot;&gt;&lt;/a&gt;mysql ibdata1数据迁移&lt;/h2&gt;&lt;p&gt;这两天zabbix上
      
    
    </summary>
    
    
      <category term="database" scheme="http://example.com/tags/database/"/>
    
  </entry>
  
  <entry>
    <title>zabbix 3.4 中文乱码</title>
    <link href="http://example.com/2020/03/07/zabbix-3-4-%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81/"/>
    <id>http://example.com/2020/03/07/zabbix-3-4-中文乱码/</id>
    <published>2020-03-07T03:37:52.000Z</published>
    <updated>2021-02-03T13:46:21.383Z</updated>
    
    <content type="html"><![CDATA[<h2 id="zabbix-3-4中文乱码"><a href="#zabbix-3-4中文乱码" class="headerlink" title="zabbix 3.4中文乱码"></a>zabbix 3.4中文乱码</h2><p>切换到中文后，图表里有乱码，操作办法。替换换乱码的字体。</p><p>zabbix图表字体位置</p><p>/usr/share/zabbix/fonts/graphfont.ttf</p><p>这个字体软链接到:</p><p>/etc/alternatives/zabbix-web-font </p><p>又链接到<br>/usr/share/fonts/dejavu/DejaVuSans.ttf</p><p>这下 简单，找一个微软系统自带的字体，比如simkai.ttf上传到/usr/share/fonts/目录下</p><p>备份一下zabbix的默认链接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mv  zabbix-web-font zabbix-web-font_backup</span><br><span class="line">ln -s /usr/share/fonts/simkai.ttf ./zabbix-web-font</span><br></pre></td></tr></table></figure><p>重新刷新 一下zabbix页面 。好了，中文方框不见了。结束。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;zabbix-3-4中文乱码&quot;&gt;&lt;a href=&quot;#zabbix-3-4中文乱码&quot; class=&quot;headerlink&quot; title=&quot;zabbix 3.4中文乱码&quot;&gt;&lt;/a&gt;zabbix 3.4中文乱码&lt;/h2&gt;&lt;p&gt;切换到中文后，图表里有乱码，操作办法。替换换
      
    
    </summary>
    
    
      <category term="linux" scheme="http://example.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>zabbix 忘记admin密码</title>
    <link href="http://example.com/2020/02/28/zabbix-%E5%BF%98%E8%AE%B0admin%E5%AF%86%E7%A0%81/"/>
    <id>http://example.com/2020/02/28/zabbix-忘记admin密码/</id>
    <published>2020-02-27T16:07:53.000Z</published>
    <updated>2021-02-03T13:46:29.250Z</updated>
    
    <content type="html"><![CDATA[<h2 id="zabbix忘记admin密码"><a href="#zabbix忘记admin密码" class="headerlink" title="zabbix忘记admin密码"></a>zabbix忘记admin密码</h2><p>好长时间 没有使用admin登录zabbix了，尝试了几次没登录上去，虽然有其它用户 暂不影响使用，但问题一直在，也不是办法。</p><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><h3 id="1-连接zabbix数据库"><a href="#1-连接zabbix数据库" class="headerlink" title="1.连接zabbix数据库"></a>1.连接zabbix数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure><h3 id="2-查询user表信息"><a href="#2-查询user表信息" class="headerlink" title="2.查询user表信息"></a>2.查询user表信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 7191</span><br><span class="line">Server version: 5.5.64-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; use zabbix;</span><br><span class="line">Reading table information <span class="keyword">for</span> completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">MariaDB [zabbix]&gt; show tables;</span><br><span class="line">+----------------------------+</span><br><span class="line">| Tables_in_zabbix           |</span><br><span class="line">+----------------------------+</span><br><span class="line">| acknowledges               |</span><br><span class="line">| actions                              |</span><br><span class="line">| alerts                                 |</span><br><span class="line">|.......</span><br><span class="line">+----------------------------+</span><br><span class="line">140 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [zabbix]&gt; select userid,<span class="built_in">alias</span>,passwd from users;</span><br><span class="line">+--------+-------+----------------------------------+</span><br><span class="line">| userid | <span class="built_in">alias</span> | passwd                           |</span><br><span class="line">+--------+-------+----------------------------------+</span><br><span class="line">|      1 | Admin | fa062259ac376b119949f55de4f4c420|</span><br><span class="line">|      2 | guest   | fa062259ac376b119949f55de4f4c420|</span><br><span class="line">|      4 | abc       | fa062259ac376b119949f55de4f4c420|</span><br><span class="line">+--------+-------+----------------------------------+</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [zabbix]&gt; </span><br></pre></td></tr></table></figure><h3 id="3-生成新的密码的md5信息"><a href="#3-生成新的密码的md5信息" class="headerlink" title="3.生成新的密码的md5信息"></a>3.生成新的密码的md5信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[abc@abc-pc ~]  <span class="built_in">echo</span> -n lucky | openssl md5</span><br><span class="line">(stdin)= 339a65e93299ad8d72c42b263aa23117</span><br><span class="line"></span><br><span class="line"><span class="comment"># luck为新的密码</span></span><br></pre></td></tr></table></figure><h3 id="4-update表数据，userid-1的这个用户"><a href="#4-update表数据，userid-1的这个用户" class="headerlink" title="4.update表数据，userid=1的这个用户"></a>4.update表数据，userid=1的这个用户</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [zabbix]&gt; update users <span class="built_in">set</span> passwd=<span class="string">&#x27;339a65e93299ad8d72c42b263aa23117&#x27;</span> <span class="built_in">where</span> userid = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [zabbix]&gt; </span><br></pre></td></tr></table></figure><h3 id="5-刷新重新加载权限表"><a href="#5-刷新重新加载权限表" class="headerlink" title="5.刷新重新加载权限表"></a>5.刷新重新加载权限表</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;zabbix忘记admin密码&quot;&gt;&lt;a href=&quot;#zabbix忘记admin密码&quot; class=&quot;headerlink&quot; title=&quot;zabbix忘记admin密码&quot;&gt;&lt;/a&gt;zabbix忘记admin密码&lt;/h2&gt;&lt;p&gt;好长时间 没有使用admin登录za
      
    
    </summary>
    
    
      <category term="linux" scheme="http://example.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>centos 6 更换网卡</title>
    <link href="http://example.com/2020/02/22/centos-6-%E6%9B%B4%E6%8D%A2%E7%BD%91%E5%8D%A1/"/>
    <id>http://example.com/2020/02/22/centos-6-更换网卡/</id>
    <published>2020-02-22T09:48:25.000Z</published>
    <updated>2020-02-22T10:34:55.373Z</updated>
    
    <content type="html"><![CDATA[<h2 id="CentOS-6-更换网卡"><a href="#CentOS-6-更换网卡" class="headerlink" title="CentOS 6 更换网卡"></a>CentOS 6 更换网卡</h2><p>开年上班了，到公司第一件事情就是处理过年期间挂掉的几台服务器。其中一台在自己尝试BIOS电池放电、换内存、换电源都没办法点亮后，就只能想着找一块一样的主板换上，试试能不能正常启来。还好主板是有的，换上后，正常开机了。启动后的一个问题，换主板了，网卡信息就变更了，这样新的网卡就没办法正常启用。</p><ul><li>备份udev下的70-persistent-net.rules文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /etc/udev/rules.d/70-persistent-net.rules /etc/udev/rules.d/70-persistent-net.rules_backup</span><br></pre></td></tr></table></figure><ul><li>重启服务器</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">init 6</span><br></pre></td></tr></table></figure><ul><li>修改新生成的70-persistent-net.rules文件，将NAME硬件名称更改为eth0 </li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/udev/rules.d/70-persistent-net.rules</span><br><span class="line"></span><br><span class="line"><span class="comment"># This file was automatically generated by the /lib/udev/write_net_rules</span></span><br><span class="line"><span class="comment"># program, run by the persistent-net-generator.rules rules file.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You can modify it, as long as you keep each rule on a single</span></span><br><span class="line"><span class="comment"># line, and change only the value of the NAME= key.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># PCI device 0x10ec:0x8168 (r8169)</span></span><br><span class="line">SUBSYSTEM==<span class="string">&quot;net&quot;</span>, ACTION==<span class="string">&quot;add&quot;</span>, DRIVERS==<span class="string">&quot;?*&quot;</span>, ATTR&#123;address&#125;==<span class="string">&quot;c8:60:00:aa:bb:cc&quot;</span>, ATTR&#123;<span class="built_in">type</span>&#125;==<span class="string">&quot;1&quot;</span>, KERNEL==<span class="string">&quot;eth*&quot;</span>, NAME=<span class="string">&quot;eth0&quot;</span></span><br></pre></td></tr></table></figure><ul><li>修改network-script下的ifcfg-eth0文件，将mac地址更改为新的网卡mac地址</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line"></span><br><span class="line">DEVICE=eth0</span><br><span class="line">HWADDR=C8:60:00:aa:bb:cc</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">UUID=21e445f2-209e-4a80-aa32-8c06bde93917</span><br><span class="line">ONBOOT=yes</span><br><span class="line">NM_CONTROLLED=yes</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">IPADDR=192.168.121.121</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=192.168.121.1</span><br><span class="line">DNS1=221.12.1.227</span><br></pre></td></tr></table></figure><ul><li>重启</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot 或 init 6</span><br></pre></td></tr></table></figure><p>重启后，网卡正常工作，结束 。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;CentOS-6-更换网卡&quot;&gt;&lt;a href=&quot;#CentOS-6-更换网卡&quot; class=&quot;headerlink&quot; title=&quot;CentOS 6 更换网卡&quot;&gt;&lt;/a&gt;CentOS 6 更换网卡&lt;/h2&gt;&lt;p&gt;开年上班了，到公司第一件事情就是处理过年期间挂掉的几
      
    
    </summary>
    
    
      <category term="linux" scheme="http://example.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>linux 终端生成随机密码</title>
    <link href="http://example.com/2020/02/05/linux-%E7%BB%88%E7%AB%AF%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E5%AF%86%E7%A0%81/"/>
    <id>http://example.com/2020/02/05/linux-终端生成随机密码/</id>
    <published>2020-02-05T04:56:17.000Z</published>
    <updated>2020-03-08T08:35:10.427Z</updated>
    
    <content type="html"><![CDATA[<h2 id="llinux下生成随机密码"><a href="#llinux下生成随机密码" class="headerlink" title="llinux下生成随机密码"></a>llinux下生成随机密码</h2><h3 id="工具一：pwgen"><a href="#工具一：pwgen" class="headerlink" title="工具一：pwgen"></a>工具一：pwgen</h3><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ubuntu</span></span><br><span class="line">sudo apt install pwgen</span><br><span class="line"><span class="comment"># centos</span></span><br><span class="line">sudo yum install pwgen</span><br></pre></td></tr></table></figure><h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ pwgen</span><br><span class="line"><span class="comment"># 默认生成 160个8位密码</span></span><br><span class="line">$ pwgen -s</span><br><span class="line"><span class="comment"># 生成安全随机密码，使用-s选 项</span></span><br><span class="line">$ pwgen -s 14 5</span><br><span class="line"><span class="comment"># 生成长度为14位的5组安全密码</span></span><br><span class="line">$ pwgen -cnys 14 6</span><br><span class="line"><span class="comment"># 生成6组14位的随机强度密码，常用 </span></span><br></pre></td></tr></table></figure><h3 id="工具二：openssl"><a href="#工具二：openssl" class="headerlink" title="工具二：openssl"></a>工具二：openssl</h3><h4 id="用法一"><a href="#用法一" class="headerlink" title="用法一"></a>用法一</h4><p>示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl rand -base64 14</span><br><span class="line"><span class="comment"># 生成14位密码</span></span><br></pre></td></tr></table></figure><h4 id="用法二"><a href="#用法二" class="headerlink" title="用法二"></a>用法二</h4><p>示例：生成10个14位随机强度密码。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">for</span> pw <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span> openssl rand -base64 14; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">vIFqxQb/Pl8CgaX4j3M=</span><br><span class="line">32GRzfSnxMd6yElzRq0=</span><br><span class="line">XbH3OVDe5kq4frXee8s=</span><br><span class="line">UJIVRb5WlwKL4nRlraM=</span><br><span class="line">myzSSVmoMllQu5rfNHM=</span><br><span class="line">vcz7dIHYcLQjjeZhoHQ=</span><br><span class="line">3u32tYwDldLbF22+9sc=</span><br><span class="line">61mMsj1RF8lqjUe9q6A=</span><br><span class="line">t/kDbVHAxCfAWszi++Q=</span><br><span class="line">mS5BVEZiKgob06gSnck=</span><br></pre></td></tr></table></figure><h3 id="工具三：gpg"><a href="#工具三：gpg" class="headerlink" title="工具三：gpg"></a>工具三：gpg</h3><h4 id="示例1："><a href="#示例1：" class="headerlink" title="示例1："></a>示例1：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gpg --gen-random --armor 14 1</span><br><span class="line">4flq4ofGrHFqpsyi1NM=</span><br></pre></td></tr></table></figure><h4 id="示例2："><a href="#示例2：" class="headerlink" title="示例2："></a>示例2：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">for</span> pw <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span> gpg --gen-random --armor 1 14; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">4yCOBter8EA2bMSfaoM=</span><br><span class="line">wHSuQzrRAATSPixas1s=</span><br><span class="line">PlK5rIml+Ikdcq3U644=</span><br><span class="line">yPIMFc+pMkDxknnxW0s=</span><br><span class="line">ZHRU6HO3n7Kd0WIUDMU=</span><br><span class="line">ZJcNXsfLfC1cdI8aABU=</span><br><span class="line">gENZMAifzy+oNMrEmvw=</span><br><span class="line">CqC871lLiIUNNZ/chK8=</span><br><span class="line">ltL+Ce75tckVWlfy94I=</span><br><span class="line">38GuiLF5n7HmgxommhI=</span><br></pre></td></tr></table></figure><h3 id="其它工具"><a href="#其它工具" class="headerlink" title="其它工具"></a>其它工具</h3><h4 id="使用md5sum"><a href="#使用md5sum" class="headerlink" title="使用md5sum"></a>使用md5sum</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ date | md5sum</span><br><span class="line">b932c4670f1bae71b5e43c4https://blog.ywmy.xyz/ywmy/linuxlinux_mount.png59be83a90  -</span><br></pre></td></tr></table></figure><h4 id="使用-dev-urandom"><a href="#使用-dev-urandom" class="headerlink" title="使用/dev/urandom"></a>使用/dev/urandom</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /dev/urandom | tr -dc <span class="string">&#x27;a-zA-Z0-9&#x27;</span> | head -c 14</span><br><span class="line">YIqMOLPN913M0M% </span><br></pre></td></tr></table></figure><h4 id="使用sha356sum"><a href="#使用sha356sum" class="headerlink" title="使用sha356sum"></a>使用sha356sum</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ date | sha256sum</span><br><span class="line">b0726dc3b8d717df789988f755589c598dc742f045cddaaedb00482d0659007f  -</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;llinux下生成随机密码&quot;&gt;&lt;a href=&quot;#llinux下生成随机密码&quot; class=&quot;headerlink&quot; title=&quot;llinux下生成随机密码&quot;&gt;&lt;/a&gt;llinux下生成随机密码&lt;/h2&gt;&lt;h3 id=&quot;工具一：pwgen&quot;&gt;&lt;a href=&quot;#
      
    
    </summary>
    
    
      <category term="linux" scheme="http://example.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>linux nc command</title>
    <link href="http://example.com/2019/11/30/linux-nc-command/"/>
    <id>http://example.com/2019/11/30/linux-nc-command/</id>
    <published>2019-11-30T08:25:01.000Z</published>
    <updated>2021-02-03T13:35:10.215Z</updated>
    
    <content type="html"><![CDATA[<p>Netcat 是一款简单的Unix工具，使用UDP和TCP协议。 它是一个可靠的容易被其他程序所启用的后台操作工具。 使用它你可以轻易的建立任何连接。内建有很多实用的工具。</p><h2 id="linux-nc-命令"><a href="#linux-nc-命令" class="headerlink" title="linux nc 命令"></a>linux nc 命令</h2><h3 id="netcat-安装"><a href="#netcat-安装" class="headerlink" title="netcat 安装"></a>netcat 安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ubuntu 18.04</span></span><br><span class="line">sudo apt install netcat</span><br><span class="line"><span class="comment"># centos  7</span></span><br><span class="line">sudo yum install nc</span><br></pre></td></tr></table></figure><h3 id="应用案例"><a href="#应用案例" class="headerlink" title="应用案例"></a>应用案例</h3><ul><li>端口扫描</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -z -v  10.10.0.103 3389  <span class="comment">#查看主机3389端口是否启用</span></span><br></pre></td></tr></table></figure><p>回显示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3389端口</span></span><br><span class="line">Connection to 10.10.0.103 3389 port [tcp/*] succeeded!</span><br><span class="line"><span class="comment"># 80端口</span></span><br><span class="line">Connection to 10.10.0.103 80 port [tcp/http] succeeded!</span><br><span class="line"><span class="comment"># 22端口</span></span><br><span class="line">Connection to 10.10.0.100 22 port [tcp/ssh] succeeded!</span><br></pre></td></tr></table></figure><p>无回显，则端口无法通信。默认TCP，-u参数可调整为UDP模式。</p><p>端口扫描案例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">For example:</span><br><span class="line"></span><br><span class="line">           $ nc -zv host.example.com 20-30</span><br><span class="line">           Connection to host.example.com 22 port [tcp/ssh] succeeded!</span><br><span class="line">           Connection to host.example.com 25 port [tcp/smtp] succeeded!</span><br><span class="line"></span><br><span class="line">     The port range was specified to <span class="built_in">limit</span> the search to ports 20 - 30, and is</span><br><span class="line">     scanned by increasing order.</span><br><span class="line"></span><br><span class="line">     You can also specify a list of ports to scan, <span class="keyword">for</span> example:</span><br><span class="line"></span><br><span class="line">           $ nc -zv host.example.com 80 20 22</span><br><span class="line">           nc: connect to host.example.com 80 (tcp) failed: Connection refused</span><br><span class="line">           nc: connect to host.example.com 20 (tcp) failed: Connection refused</span><br><span class="line">           Connection to host.example.com port [tcp/ssh] succeeded!</span><br><span class="line"></span><br><span class="line">     The ports are scanned by the order you given.</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Netcat 是一款简单的Unix工具，使用UDP和TCP协议。 它是一个可靠的容易被其他程序所启用的后台操作工具。 使用它你可以轻易的建立任何连接。内建有很多实用的工具。&lt;/p&gt;
&lt;h2 id=&quot;linux-nc-命令&quot;&gt;&lt;a href=&quot;#linux-nc-命令&quot; cl
      
    
    </summary>
    
    
      <category term="linux" scheme="http://example.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>centos+rsyslog+loganalyzer</title>
    <link href="http://example.com/2019/08/07/centos-rsyslog-loganalyzer/"/>
    <id>http://example.com/2019/08/07/centos-rsyslog-loganalyzer/</id>
    <published>2019-08-07T09:25:40.000Z</published>
    <updated>2020-03-08T09:00:32.006Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Rsyslog-Analyzer搭建"><a href="#Rsyslog-Analyzer搭建" class="headerlink" title="Rsyslog+Analyzer搭建"></a>Rsyslog+Analyzer搭建</h2><p>一个项目上需求，需要内部网络上设备的日志存储满足180天，且支持日志报表导出。于是想到搭建一个日志应用。再加上日志报表分析，想到一个组合，rsyslog+loganalyzer。</p><p>操作如下：</p><h3 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h3><p>CentOS Linux release 7.6.1810 (Core) </p><h3 id="依赖安装"><a href="#依赖安装" class="headerlink" title="依赖安装"></a>依赖安装</h3><h4 id="设置时间同步"><a href="#设置时间同步" class="headerlink" title="设置时间同步"></a>设置时间同步</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install ntpdate epel-release vim curl wget</span><br><span class="line">ntpdate cn.ntp.org.cn</span><br><span class="line">hwclock -w</span><br></pre></td></tr></table></figure><p>配置crontab任务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/crontab</span><br><span class="line">00 23 * * * ntpdate cn.ntp.org.cn</span><br><span class="line">30 00 * * * hwclock -w</span><br></pre></td></tr></table></figure><h4 id="安装apache、php、mariadb-server"><a href="#安装apache、php、mariadb-server" class="headerlink" title="安装apache、php、mariadb-server"></a>安装apache、php、mariadb-server</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install php php-mysql php-gd php-mbstring php-mcrypt php-devel php-xml mariadb-server httpd</span><br></pre></td></tr></table></figure><p>设置开机启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> httpd</span><br><span class="line">systemctl <span class="built_in">enable</span> mariadb</span><br><span class="line">systemctl start httpd</span><br><span class="line">systemctl start mariadb</span><br></pre></td></tr></table></figure><p>配置mariadb-server</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_secure_installation</span><br></pre></td></tr></table></figure><h4 id="安装rsyslog-mysql"><a href="#安装rsyslog-mysql" class="headerlink" title="安装rsyslog-mysql"></a>安装rsyslog-mysql</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install rsyslog rsyslog-mysql -y</span><br></pre></td></tr></table></figure><h4 id="创建rsyslog数据库和用户"><a href="#创建rsyslog数据库和用户" class="headerlink" title="创建rsyslog数据库和用户"></a>创建rsyslog数据库和用户</h4><p>导入rsyslog数据库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p &lt; /usr/share/doc/rsyslog-8.24.0/mysql-createDB.sql </span><br></pre></td></tr></table></figure><p>创建rsyslog用户，并授权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line">mysql&gt; GRANT ALL ON  Syslog.* TO <span class="string">&#x27;rsyslog&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;MYSQLPASSOWRD&#x27;</span>;</span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br><span class="line">mysql&gt; <span class="built_in">exit</span>;</span><br></pre></td></tr></table></figure><h4 id="设置rsyslog-mysql"><a href="#设置rsyslog-mysql" class="headerlink" title="设置rsyslog-mysql"></a>设置rsyslog-mysql</h4><p>修改rsyslog配置文件，启用rsyslog mysql 模块，配置mysql 连接信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/rsyslog.conf</span><br><span class="line"><span class="comment"># 添加下面的信息</span></span><br><span class="line"><span class="variable">$ModLoad</span> ommysql</span><br><span class="line">*.* :ommysql:127.0.0.1,Syslog,rsyslog,MYSQLPASSWORD</span><br></pre></td></tr></table></figure><p>最终如下所示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rsyslog configuration file</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># For more information see /usr/share/doc/rsyslog-*/rsyslog_conf.html</span></span><br><span class="line"><span class="comment"># If you experience problems, see http://www.rsyslog.com/doc/troubleshoot.html</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#### MODULES ####</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The imjournal module bellow is now used as a message source instead of imuxsock.</span></span><br><span class="line"><span class="variable">$ModLoad</span> imuxsock <span class="comment"># provides support for local system logging (e.g. via logger command)</span></span><br><span class="line"><span class="variable">$ModLoad</span> imjournal <span class="comment"># provides access to the systemd journal</span></span><br><span class="line"><span class="variable">$ModLoad</span> imklog <span class="comment"># reads kernel messages (the same are read from journald)</span></span><br><span class="line"><span class="variable">$ModLoad</span> immark  <span class="comment"># provides --MARK-- message capability</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Provides UDP syslog reception</span></span><br><span class="line"><span class="variable">$ModLoad</span> imudp</span><br><span class="line"><span class="variable">$UDPServerRun</span> 514</span><br><span class="line"></span><br><span class="line"><span class="comment"># Provides TCP syslog reception</span></span><br><span class="line"><span class="variable">$ModLoad</span> imtcp</span><br><span class="line"><span class="variable">$InputTCPServerRun</span> 514</span><br><span class="line"><span class="comment"># 新启用的rsyslog mysql模块</span></span><br><span class="line"><span class="variable">$Modload</span> ommysql</span><br><span class="line">*.* :ommysql:localhost,Syslog,rsyslog,MYSQLPASSWORD</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#### GLOBAL DIRECTIVES ####</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Where to place auxiliary files</span></span><br><span class="line"><span class="variable">$WorkDirectory</span> /var/lib/rsyslog</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use default timestamp format</span></span><br><span class="line"><span class="variable">$ActionFileDefaultTemplate</span> RSYSLOG_TraditionalFileFormat</span><br><span class="line"></span><br><span class="line"><span class="comment"># File syncing capability is disabled by default. This feature is usually not required,</span></span><br><span class="line"><span class="comment"># not useful and an extreme performance hit</span></span><br><span class="line"><span class="comment">#$ActionFileEnableSync on</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Include all config files in /etc/rsyslog.d/</span></span><br><span class="line"><span class="variable">$IncludeConfig</span> /etc/rsyslog.d/*.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># Turn off message reception via local log socket;</span></span><br><span class="line"><span class="comment"># local messages are retrieved through imjournal now.</span></span><br><span class="line"><span class="variable">$OmitLocalLogging</span> on</span><br><span class="line"></span><br><span class="line"><span class="comment"># File to store the position in the journal</span></span><br><span class="line"><span class="variable">$IMJournalStateFile</span> imjournal.state</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#### RULES ####</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Log all kernel messages to the console.</span></span><br><span class="line"><span class="comment"># Logging much else clutters up the screen.</span></span><br><span class="line"><span class="comment">#kern.*                                                 /dev/console</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Log anything (except mail) of level info or higher.</span></span><br><span class="line"><span class="comment"># Don&#x27;t log private authentication messages!</span></span><br><span class="line">*.info;mail.none;authpriv.none;cron.none                /var/<span class="built_in">log</span>/messages</span><br><span class="line"></span><br><span class="line"><span class="comment"># The authpriv file has restricted access.</span></span><br><span class="line">authpriv.*                                              /var/<span class="built_in">log</span>/secure</span><br><span class="line"></span><br><span class="line"><span class="comment"># Log all the mail messages in one place.</span></span><br><span class="line">mail.*                                                  -/var/<span class="built_in">log</span>/maillog</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Log cron stuff</span></span><br><span class="line">cron.*                                                  /var/<span class="built_in">log</span>/cron</span><br><span class="line"></span><br><span class="line"><span class="comment"># Everybody gets emergency messages</span></span><br><span class="line">*.emerg                                                 :omusrmsg:*</span><br><span class="line"></span><br><span class="line"><span class="comment"># Save news errors of level crit and higher in a special file.</span></span><br><span class="line">uucp,news.crit                                          /var/<span class="built_in">log</span>/spooler</span><br><span class="line"></span><br><span class="line"><span class="comment"># Save boot messages also to boot.log</span></span><br><span class="line">local7.*                                                /var/<span class="built_in">log</span>/boot.log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ### begin forwarding rule ###</span></span><br><span class="line"><span class="comment"># The statement between the begin ... end define a SINGLE forwarding</span></span><br><span class="line"><span class="comment"># rule. They belong together, do NOT split them. If you create multiple</span></span><br><span class="line"><span class="comment"># forwarding rules, duplicate the whole block!</span></span><br><span class="line"><span class="comment"># Remote Logging (we use TCP for reliable delivery)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># An on-disk queue is created for this action. If the remote host is</span></span><br><span class="line"><span class="comment"># down, messages are spooled to disk and sent when it is up again.</span></span><br><span class="line"><span class="comment">#$ActionQueueFileName fwdRule1 # unique name prefix for spool files</span></span><br><span class="line"><span class="comment">#$ActionQueueMaxDiskSpace 1g   # 1gb space limit (use as much as possible)</span></span><br><span class="line"><span class="comment">#$ActionQueueSaveOnShutdown on # save messages to disk on shutdown</span></span><br><span class="line"><span class="comment">#$ActionQueueType LinkedList   # run asynchronously</span></span><br><span class="line"><span class="comment">#$ActionResumeRetryCount -1    # infinite retries if host is down</span></span><br><span class="line"><span class="comment"># remote host is: name/ip:port, e.g. 192.168.0.1:514, port optional</span></span><br><span class="line"><span class="comment">#*.* @@remote-host:514</span></span><br><span class="line"><span class="comment"># ### end of the forwarding rule ###</span></span><br></pre></td></tr></table></figure><h4 id="重新启用rsyslog服务"><a href="#重新启用rsyslog服务" class="headerlink" title="重新启用rsyslog服务"></a>重新启用rsyslog服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart rsyslog</span><br></pre></td></tr></table></figure><p>至此，rsyslog的日志存储已经可以在mysql中查看，接下来我们还需要对存储的日志可视化操作。即安装loganalyzer。</p><h3 id="安装loganalyzer"><a href="#安装loganalyzer" class="headerlink" title="安装loganalyzer"></a>安装loganalyzer</h3><h4 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/download</span><br><span class="line">wget http://download.adiscon.com/loganalyzer/loganalyzer-4.1.7.tar.gz</span><br><span class="line">tar -xzf loganalyzer-4.1.7.tar.gz</span><br></pre></td></tr></table></figure><p>把安装源文件复制到本地站点目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -r /loganalyzer-4.1.7/src /var/www/html/loganalyzer</span><br></pre></td></tr></table></figure><h4 id="创建loganalyzer的配置文件"><a href="#创建loganalyzer的配置文件" class="headerlink" title="创建loganalyzer的配置文件"></a>创建loganalyzer的配置文件</h4><p>创建配置文件的时候，先把selinux关闭，不然后面写入配置文件的时候会有问题。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var/www/html/loganalyzer</span><br><span class="line">touch config.php</span><br><span class="line">chown apache:apache ./*</span><br><span class="line">chmod 666 config.php</span><br></pre></td></tr></table></figure><h4 id="安装引导"><a href="#安装引导" class="headerlink" title="安装引导"></a>安装引导</h4><p>打开安装引导页面</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://server-ip/loganalyzer/install.php</span><br></pre></td></tr></table></figure><p>根据引导页面开始安装，安装过程中，如果遇到config.php的问题，参考selinux配置，即需要关闭，重启后操作。</p><p>连接数据库后，有一个配置创建第一个rsyslog信息源。注意表名SystemEvents这个表名，不确定的，可以登录mysql查看Syslog表名确认。不然这里的创建后面登录后，查不到日志信息。</p><p>引导页面安装结束，即可以看到日志。</p><p>如果查询不到日志，提示以下错误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">“Could not find the configured table, maybe misspelled or the table names are <span class="keyword">case</span> sensitive”</span><br></pre></td></tr></table></figure><p>解决方法如下：</p><p>更改loganalyzer 的config.php文件，更改如下行内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$CFG</span>[‘Sources’][‘Source1’][‘DBTableName’] = ‘systemevents’; =&gt; ‘SystemEvents’</span><br></pre></td></tr></table></figure><p>更新数据库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql -u rsyslog -p</span><br><span class="line">mysql&gt; update logcon_sources <span class="built_in">set</span> DBTableName =’SystemEvents’ <span class="built_in">where</span> ID=1;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1 Changed: 1 Warnings: 0</span><br></pre></td></tr></table></figure><h3 id="配置其它主机的日志"><a href="#配置其它主机的日志" class="headerlink" title="配置其它主机的日志"></a>配置其它主机的日志</h3><p>添加一台主机，把日志存储到laganalyzer主机上，只需要配置主机的rsyslog配置文件，配置文件如下例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># An on-disk queue is created for this action. If the remote host is</span></span><br><span class="line"><span class="comment"># down, messages are spooled to disk and sent when it is up again.</span></span><br><span class="line"><span class="comment">#$ActionQueueFileName fwdRule1 # unique name prefix for spool files</span></span><br><span class="line"><span class="comment">#$ActionQueueMaxDiskSpace 1g   # 1gb space limit (use as much as possible)</span></span><br><span class="line"><span class="comment">#$ActionQueueSaveOnShutdown on # save messages to disk on shutdown</span></span><br><span class="line"><span class="comment">#$ActionQueueType LinkedList   # run asynchronously</span></span><br><span class="line"><span class="comment">#$ActionResumeRetryCount -1    # infinite retries if host is down</span></span><br><span class="line"><span class="comment"># remote host is: name/ip:port, e.g. 192.168.0.1:514, port optional</span></span><br><span class="line"><span class="comment">#*.* @@remote-host:514</span></span><br><span class="line">*.* @loganalyzer-IP:514</span><br><span class="line"><span class="comment"># ### end of the forwarding rule ###</span></span><br></pre></td></tr></table></figure><p>开放loganalyzer服务器的514端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --add-port=514/tcp</span><br><span class="line">firewall-cmd --permanent --add-port=514/udp</span><br><span class="line">firewall-cmd --complete-reload</span><br></pre></td></tr></table></figure><p><img src="https://blog.ywmy.xyz/linux/Loganalyzer.png" alt="loganzlyzer"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Rsyslog-Analyzer搭建&quot;&gt;&lt;a href=&quot;#Rsyslog-Analyzer搭建&quot; class=&quot;headerlink&quot; title=&quot;Rsyslog+Analyzer搭建&quot;&gt;&lt;/a&gt;Rsyslog+Analyzer搭建&lt;/h2&gt;&lt;p&gt;一个项目上需
      
    
    </summary>
    
    
      <category term="linux" scheme="http://example.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>终端录制与回放</title>
    <link href="http://example.com/2019/07/28/%E7%BB%88%E7%AB%AF%E5%BD%95%E5%88%B6%E4%B8%8E%E5%9B%9E%E6%94%BE/"/>
    <id>http://example.com/2019/07/28/终端录制与回放/</id>
    <published>2019-07-28T14:07:50.000Z</published>
    <updated>2021-02-03T13:48:19.920Z</updated>
    
    <content type="html"><![CDATA[<h2 id="linux-shell-终端的录制与回放"><a href="#linux-shell-终端的录制与回放" class="headerlink" title="linux shell 终端的录制与回放"></a>linux shell 终端的录制与回放</h2><p>最近有一个需求，在给一个H3C路由器排除问题的时候，启用debug模式，debug模式下，输出到屏幕的调试信息没有办法导出到文件，只能想办法试试看能不能从终端会话录制上实现。</p><h3 id="终端的会话操作录制"><a href="#终端的会话操作录制" class="headerlink" title="终端的会话操作录制"></a>终端的会话操作录制</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">script -t 2&gt; timing.log -a output.session</span><br><span class="line"><span class="built_in">type</span> commands;</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure><p>exit退出录制。</p><p>两个配置文件被当做script命令的参数。这两个文件可以随便命名，这里用timing.log和output.session。其中timing.log用于存储时序信息，描述每一个指令在何时运行；output.session用于存储命令信息输出。-t选项用于将时序数据导入stderr。2&gt;用于stderr重定向到timing.log。</p><h3 id="录制回放"><a href="#录制回放" class="headerlink" title="录制回放"></a>录制回放</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scriptreplay timing.log output.session</span><br></pre></td></tr></table></figure><p>经验证，录制还是可以的。整个屏幕输出的内容存储在输出的output.session文件中，以文本打开，就可以直接查看之前录制回显的内容了。也可以方便后期回放温故。</p><h3 id="script广播会话"><a href="#script广播会话" class="headerlink" title="script广播会话"></a>script广播会话</h3><p>以两个终端为例：</p><h4 id="终端1操作"><a href="#终端1操作" class="headerlink" title="终端1操作"></a>终端1操作</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkfifo scriptfifo</span><br></pre></td></tr></table></figure><h4 id="终端2操作"><a href="#终端2操作" class="headerlink" title="终端2操作"></a>终端2操作</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat  scriptfifo</span><br></pre></td></tr></table></figure><h4 id="终端1操作-1"><a href="#终端1操作-1" class="headerlink" title="终端1操作"></a>终端1操作</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">script -f scritpfifo</span><br><span class="line">commands</span><br><span class="line"></span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>exit退出。</p><p>此时，终端2上同步回显终端1上的操作内容。</p><p>屏幕录制操作结束。</p><p>补充一个H3C 屏幕回显debug信息的操作步骤，全程用户模式下操作：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">debugging nat packet   //例如调试nat包信息</span><br><span class="line">terminal debugging   //打开调试信息的屏幕输出开关</span><br><span class="line">display debugging    //查看启用了哪些调试信息</span><br><span class="line">termainal monitor    //开启控制台对系统信息的监视功能</span><br></pre></td></tr></table></figure><p>汇总结束，通过录制终端会话，来排查设备的debugging信息。设备debugging是比较消耗资源的一件事情，输出的信息也非常多，输出了非专业人员排查问题也是比较困难的。一般这个也就用于提交设备厂商售后分析了。今日份结束。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;linux-shell-终端的录制与回放&quot;&gt;&lt;a href=&quot;#linux-shell-终端的录制与回放&quot; class=&quot;headerlink&quot; title=&quot;linux shell 终端的录制与回放&quot;&gt;&lt;/a&gt;linux shell 终端的录制与回放&lt;/h2&gt;&lt;
      
    
    </summary>
    
    
      <category term="linux" scheme="http://example.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>cisco 设备配置文件的保存和恢复</title>
    <link href="http://example.com/2019/07/27/cisco-%E8%AE%BE%E5%A4%87%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E4%BF%9D%E5%AD%98%E5%92%8C%E6%81%A2%E5%A4%8D/"/>
    <id>http://example.com/2019/07/27/cisco-设备配置文件的保存和恢复/</id>
    <published>2019-07-27T04:00:03.000Z</published>
    <updated>2021-02-03T13:51:12.149Z</updated>
    
    <content type="html"><![CDATA[<h2 id="cisco-配置文件的保存和恢复"><a href="#cisco-配置文件的保存和恢复" class="headerlink" title="cisco 配置文件的保存和恢复"></a>cisco 配置文件的保存和恢复</h2><h3 id="保存配置文件"><a href="#保存配置文件" class="headerlink" title="保存配置文件"></a>保存配置文件</h3><p>思科保存配置文件目录结构大概如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">R1<span class="comment">#dir</span></span><br><span class="line">Directory of nvram:/</span><br><span class="line"></span><br><span class="line">  508  -rw-        2190                    &lt;no date&gt;  startup-config</span><br><span class="line">  509  ----          24                         &lt;no date&gt;  private-config</span><br><span class="line">  510  -rw-        2190                    &lt;no date&gt;  underlying-config</span><br><span class="line">    1  ----             34                         &lt;no date&gt;  persistent-data</span><br><span class="line">    2  -rw-           4                          &lt;no date&gt;  rf_cold_starts</span><br><span class="line">    3  -rw-           0                         &lt;no date&gt;  ifIndex-table</span><br></pre></td></tr></table></figure><p>启动配置文件为start-config</p><p>要保存当前配置文件的逻辑是先备份当前的启动文件startup-config </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">R1<span class="comment">#copy startup-config nvram:20190826.backup</span></span><br><span class="line">Destination filename [20190826.backup]? </span><br><span class="line"></span><br><span class="line">2190 bytes copied <span class="keyword">in</span> 1.136 secs (1928 bytes/sec)</span><br></pre></td></tr></table></figure><p>保存的配置文件如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">R1<span class="comment">#dir</span></span><br><span class="line">Directory of nvram:/</span><br><span class="line"></span><br><span class="line">  508  -rw-        2190                    &lt;no date&gt;  startup-config</span><br><span class="line">  509  ----          24                         &lt;no date&gt;  private-config</span><br><span class="line">  510  -rw-        2190                    &lt;no date&gt;  underlying-config</span><br><span class="line">    1  ----             34                         &lt;no date&gt;  persistent-data</span><br><span class="line">    2  -rw-           4                           &lt;no date&gt;  rf_cold_starts</span><br><span class="line">    3  -rw-           0                           &lt;no date&gt;  ifIndex-table</span><br><span class="line">    4  -rw-           2190                    &lt;no date&gt;  20190826.backup</span><br><span class="line"></span><br><span class="line">522232 bytes total (513822 bytes free)</span><br></pre></td></tr></table></figure><p>将当前配置保存为启动配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">R1<span class="comment">#copy running-config nvram:startup-config</span></span><br><span class="line">Destination filename [startup-config]?</span><br><span class="line">Building configuration...</span><br><span class="line">[OK]</span><br></pre></td></tr></table></figure><h3 id="恢复配置文件"><a href="#恢复配置文件" class="headerlink" title="恢复配置文件"></a>恢复配置文件</h3><p>例如恢复到20190826的配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">R1<span class="comment">#copy nvram:/20190826.backup startup-config</span></span><br><span class="line">Destination filename [startup-config]? y</span><br><span class="line"></span><br><span class="line">2190 bytes copied <span class="keyword">in</span> 1.108 secs (1977 bytes/sec)</span><br></pre></td></tr></table></figure><p>重启交换机，不需要保存运行中的配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">R1<span class="comment">#reload </span></span><br><span class="line">Proceed with reload? [confirm]y</span><br><span class="line">*Jul 27 02:14:18.199: %SYS-5-RELOAD: Reload requested by console. Reload Reason: Reload Command.</span><br><span class="line"></span><br><span class="line">                ROM: reload requested...</span><br></pre></td></tr></table></figure><h3 id="H3C-化为的操作思路"><a href="#H3C-化为的操作思路" class="headerlink" title="H3C 化为的操作思路"></a>H3C 化为的操作思路</h3><p>保存文件，选用配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;F1070&gt;save 20190828.cfg</span><br><span class="line">The current configuration will be saved to flash:/20190828.cfg. Continue? [Y/N]:y</span><br><span class="line">Now saving current configuration to the device.</span><br><span class="line">Saving configuration flash:/20190828.cfg.Please <span class="built_in">wait</span>...</span><br><span class="line">Configuration is saved to device successfully.</span><br></pre></td></tr></table></figure><p>配置启动项：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;F1070&gt;startup saved-configuration 20190828.cfg </span><br><span class="line">Please <span class="built_in">wait</span>...... Done.</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;cisco-配置文件的保存和恢复&quot;&gt;&lt;a href=&quot;#cisco-配置文件的保存和恢复&quot; class=&quot;headerlink&quot; title=&quot;cisco 配置文件的保存和恢复&quot;&gt;&lt;/a&gt;cisco 配置文件的保存和恢复&lt;/h2&gt;&lt;h3 id=&quot;保存配置文件&quot;&gt;&lt;
      
    
    </summary>
    
    
      <category term="network" scheme="http://example.com/tags/network/"/>
    
  </entry>
  
  <entry>
    <title>python pip</title>
    <link href="http://example.com/2019/06/17/python-pip/"/>
    <id>http://example.com/2019/06/17/python-pip/</id>
    <published>2019-06-17T02:27:48.000Z</published>
    <updated>2019-06-17T02:44:40.365Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ubuntu-pip相关小问题"><a href="#ubuntu-pip相关小问题" class="headerlink" title="ubuntu pip相关小问题"></a>ubuntu pip相关小问题</h2><h3 id="ImportError-No-module-named-‘setuptools’"><a href="#ImportError-No-module-named-‘setuptools’" class="headerlink" title="ImportError: No module named ‘setuptools’"></a>ImportError: No module named ‘setuptools’</h3><p>解决办法：安装setuptools</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Python 2.x:    sudo apt-get install python-setuptools</span><br><span class="line">Python 3.x:    sudo apt-get install python3-setuptools</span><br></pre></td></tr></table></figure><p>如果安装出现错误：AttributeError: module ‘setuptools.dist’ has no attribute ‘check_specifier’</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Python 2.x:</span><br><span class="line">pip install --upgrade pip</span><br><span class="line"><span class="built_in">hash</span> -r pip</span><br><span class="line"></span><br><span class="line">Python 3.x:</span><br><span class="line">pip3 install --upgrade pip</span><br><span class="line"><span class="built_in">hash</span> -r pip3</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> (Mask RCNN root folder)</span><br><span class="line">sudo python3 setup.py install</span><br></pre></td></tr></table></figure><h3 id="pip升级"><a href="#pip升级" class="headerlink" title="pip升级"></a>pip升级</h3><p>pip升级后出现错误：Import Error:cannot import name main</p><p>解决办法：</p><ul><li><p>方法1</p><p>更改from pip import main</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更改下面行内容</span></span><br><span class="line">from pip import main</span><br><span class="line"><span class="comment"># 更改为</span></span><br><span class="line">from pip._internal import main</span><br></pre></td></tr></table></figure><ul><li>方法2</li></ul><p>更改sys.exit</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 原内容：</span></span><br><span class="line">from pip import main</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    sys.exit(main())</span><br><span class="line"><span class="comment"># 更改后内容</span></span><br><span class="line">from pip import __main__</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    sys.exit(__main__._main())</span><br></pre></td></tr></table></figure><p>注意__main__左右的下划线是两个下划线。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ubuntu-pip相关小问题&quot;&gt;&lt;a href=&quot;#ubuntu-pip相关小问题&quot; class=&quot;headerlink&quot; title=&quot;ubuntu pip相关小问题&quot;&gt;&lt;/a&gt;ubuntu pip相关小问题&lt;/h2&gt;&lt;h3 id=&quot;ImportError-N
      
    
    </summary>
    
    
      <category term="linux" scheme="http://example.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>小新700 触摸板双击右键</title>
    <link href="http://example.com/2019/05/30/%E5%B0%8F%E6%96%B0700-%E8%A7%A6%E6%91%B8%E6%9D%BF%E5%8F%8C%E5%87%BB%E5%8F%B3%E9%94%AE/"/>
    <id>http://example.com/2019/05/30/小新700-触摸板双击右键/</id>
    <published>2019-05-30T14:23:17.000Z</published>
    <updated>2021-02-03T13:48:10.061Z</updated>
    
    <content type="html"><![CDATA[<h2 id="联想小新700触摸板双击右键设置"><a href="#联想小新700触摸板双击右键设置" class="headerlink" title="联想小新700触摸板双击右键设置"></a>联想小新700触摸板双击右键设置</h2><p>之前买的联想小新电脑，在设置触摸板时，双击右键的设置是不生效的。在windows下的触摸板设置，如单指、双指、三指、四指操作，使用习惯后，操作起来也是非常高效和舒服的。不过小新的这个synaptics装置，在安装最新驱动后，双击右键依然是不起作用的。在使用过程中就比较尴尬。</p><h3 id="操作方法"><a href="#操作方法" class="headerlink" title="操作方法"></a>操作方法</h3><p>打开注册表编辑器，修改注册表值，路径如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WIN＋R 运行 regedit，展开路径：</span><br><span class="line">计算机\HKEY_CURRENT_USER\Software\Synaptics\SynTP\</span><br></pre></td></tr></table></figure><p>展开路径，找到TouchPadPS2TM开头的项，如自己的小新为TouchPadPS2TM3105，点击该项，右边的键值，找到2FingerTapAction，双击将默认数据0修改为2。确定修改，重启系统，双击右键设置生效。操作结束。记录备用。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;联想小新700触摸板双击右键设置&quot;&gt;&lt;a href=&quot;#联想小新700触摸板双击右键设置&quot; class=&quot;headerlink&quot; title=&quot;联想小新700触摸板双击右键设置&quot;&gt;&lt;/a&gt;联想小新700触摸板双击右键设置&lt;/h2&gt;&lt;p&gt;之前买的联想小新电脑，在设置
      
    
    </summary>
    
    
      <category term="windows" scheme="http://example.com/tags/windows/"/>
    
  </entry>
  
</feed>
