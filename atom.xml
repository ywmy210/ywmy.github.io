<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>豆豆家</title>
  
  <subtitle>network &amp; delicacy</subtitle>
  <link href="/ywmy/atom.xml" rel="self"/>
  
  <link href="https://ywmy210.github.io/ywmy/"/>
  <updated>2019-03-08T09:27:13.435Z</updated>
  <id>https://ywmy210.github.io/ywmy/</id>
  
  <author>
    <name>Ian &amp; Doudou</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>mysql 常用操作</title>
    <link href="https://ywmy210.github.io/ywmy/2019/04/21/mysql-%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/"/>
    <id>https://ywmy210.github.io/ywmy/2019/04/21/mysql-常用操作/</id>
    <published>2019-04-21T08:17:48.167Z</published>
    <updated>2019-03-08T09:27:13.435Z</updated>
    
    <content type="html"><![CDATA[<h1 id="mysql基本常用命令汇总"><a href="#mysql基本常用命令汇总" class="headerlink" title="mysql基本常用命令汇总"></a>mysql基本常用命令汇总</h1><h2 id="常用总结"><a href="#常用总结" class="headerlink" title="常用总结"></a>常用总结</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">creat database name; 创建数据库</span><br><span class="line">use database_name; 选择数据库</span><br><span class="line">drop database db_name; 直接删除数据库，不提醒</span><br><span class="line">show tables; 显示表</span><br><span class="line">describe table_name; 表的详细描述</span><br><span class="line">select 中加上distinct去除重复字段</span><br><span class="line"></span><br><span class="line">显示当前mysql版本和当前日期</span><br><span class="line"></span><br><span class="line">select version(), current_date;</span><br><span class="line"></span><br><span class="line">修改用户密码，如root</span><br><span class="line"></span><br><span class="line">mysql&gt; update user <span class="built_in">set</span> authentication_string=password(<span class="string">'new_password'</span>) WHERE user=<span class="string">'root'</span>;</span><br><span class="line">Query OK, <span class="comment">### row affected, ### warning (0.08 sec)</span></span><br><span class="line">Rows matched: <span class="comment">###  Changed: ###  Warnings: 1</span></span><br><span class="line"></span><br><span class="line">创建用户</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CREATE USER <span class="string">'your_name'</span>@<span class="string">'localhost'</span> IDENTIFIED BY <span class="string">'password'</span>;</span><br><span class="line"></span><br><span class="line">用户授权</span><br><span class="line"></span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO <span class="string">'your_name'</span>@<span class="string">'localhost'</span> WITH GRANT OPTION</span><br><span class="line"></span><br><span class="line">取消授权</span><br><span class="line"></span><br><span class="line">mysql&gt; select user, host from mysql.user;  查看已经存在的用户</span><br><span class="line">mysql&gt; revoke all privileges on *.* from <span class="built_in">test</span>@localhost; 取消授权</span><br><span class="line">mysql&gt; delete from user <span class="built_in">where</span> user=<span class="string">"test"</span> and host=<span class="string">"localhost"</span>; 删除用户</span><br><span class="line">mysql&gt; delete from user <span class="built_in">where</span> user=<span class="string">"test"</span> and host=<span class="string">"localhost"</span>;</span><br></pre></td></tr></table></figure><h2 id="创建和操作表"><a href="#创建和操作表" class="headerlink" title="创建和操作表"></a>创建和操作表</h2><h3 id="创建表语法"><a href="#创建表语法" class="headerlink" title="创建表语法"></a>创建表语法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table &lt;表名&gt;(</span><br><span class="line">    &lt;列名<span class="comment">###  &lt;数据类型&gt; &lt;约束条件&gt;</span></span><br><span class="line">    &lt;列名<span class="comment">###  &lt;数据类型&gt; &lt;约束条件&gt;</span></span><br><span class="line">    &lt;列名<span class="comment">###  &lt;数据类型&gt; &lt;约束条件&gt;</span></span><br><span class="line">    .....</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="NULL值"><a href="#NULL值" class="headerlink" title="NULL值"></a>NULL值</h3><p>在定义表时，可以在约束条件中指定该列允许或不允许NULL值。如果指定不允许NULL值，则在插入数据时如果为NULL就会报错。</p><h3 id="默认值"><a href="#默认值" class="headerlink" title="默认值"></a>默认值</h3><p>可以在定义表时使用默认值，使用关键词default &lt;值&gt;进行设定，如果在插入数据时，没有值插入，则该列会插入默认值。</p><h3 id="更新表"><a href="#更新表" class="headerlink" title="更新表"></a>更新表</h3><p>更新表使用alter table语句，我们可以进行如下操作：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table &lt;表名&gt; add column &lt;列名&gt; &lt;数据类型&gt;;   //增加新列</span><br><span class="line">alter table &lt;表名&gt; drop column &lt;列名&gt;;  //删除列</span><br></pre></td></tr></table></figure><h3 id="重命名表"><a href="#重命名表" class="headerlink" title="重命名表"></a>重命名表</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename table &lt;旧表名&gt; to &lt;新表名&gt;;</span><br></pre></td></tr></table></figure><h3 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop table &lt;表名&gt;;</span><br></pre></td></tr></table></figure><h2 id="检索数据"><a href="#检索数据" class="headerlink" title="检索数据"></a>检索数据</h2><h3 id="检索单列"><a href="#检索单列" class="headerlink" title="检索单列"></a>检索单列</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &lt;列名&gt; from &lt;表名&gt;;</span><br></pre></td></tr></table></figure><h3 id="检索多列"><a href="#检索多列" class="headerlink" title="检索多列"></a>检索多列</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &lt;列名1&gt;, &lt;列名2&gt;, ... from &lt;表名&gt;;</span><br></pre></td></tr></table></figure><h3 id="检索不同值"><a href="#检索不同值" class="headerlink" title="检索不同值"></a>检索不同值</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select distinct(&lt;列名&gt;) from &lt;表名&gt;;</span><br></pre></td></tr></table></figure><h3 id="限制结果"><a href="#限制结果" class="headerlink" title="限制结果"></a>限制结果</h3><p>在mysql中，如果我们需要限制结果输出的条数，可以使用limit &lt;数字&gt;来表示限制的行数。</p><h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注释     //单行注释</span></span><br><span class="line">/* 多行注释</span><br><span class="line">   多行注释</span><br><span class="line">*/</span><br></pre></td></tr></table></figure><h2 id="排序检索数据"><a href="#排序检索数据" class="headerlink" title="排序检索数据"></a>排序检索数据</h2><p>有时我们需要对检索出来的数据进行排序，这时我们使用如下语句进行:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order by &lt;列名&gt; asc/desc;</span><br></pre></td></tr></table></figure><p>asc为升序排序，也是mysql中默认的排序方式；desc表示按照降序排序。此外根据需要我们也可以对多列进行排序，如下代码所示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order by &lt;列名1&gt; &lt;排序方法&gt;, &lt;列名2&gt; &lt;排序方法&gt;....;</span><br></pre></td></tr></table></figure><p>值得注意的是，<strong>order by 语句通常位于查询语句的最后面</strong>。后面会具体介绍查询语句的完整构成。</p><h2 id="过滤数据"><a href="#过滤数据" class="headerlink" title="过滤数据"></a>过滤数据</h2><h3 id="使用where子句"><a href="#使用where子句" class="headerlink" title="使用where子句"></a>使用where子句</h3><p>在sql中，我们使用where子名来对查询出的结果进行过滤，得到我们所需要的数据。它的格式如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select &lt;列名&gt; from &lt;表名&gt;</span><br><span class="line"><span class="built_in">where</span> &lt;过滤条件&gt;;</span><br></pre></td></tr></table></figure><p>过滤条件有多个时，我们可以使用and或or来进行多个条件的罗列。值得注意的是，当有多个过滤条件时，<strong>and的优先级会高于or</strong>，这也许会导致一些逻辑错误，需要注意。</p><h3 id="where子句操作符"><a href="#where子句操作符" class="headerlink" title="where子句操作符"></a>where子句操作符</h3><table><thead><tr><th>运算符</th><th>描述</th></tr></thead><tbody><tr><td>=</td><td>等于</td></tr><tr><td>&lt;&gt;</td><td>不等于。<strong>注释</strong>：在SQL的一些版本中，该操作符可以被写成!=</td></tr><tr><td>&gt;</td><td>大于</td></tr><tr><td>&lt;</td><td>小于</td></tr><tr><td>&gt;=</td><td>大于等于</td></tr><tr><td>&lt;=</td><td>小于等于</td></tr><tr><td>BETWEEN</td><td>在某个范围内</td></tr><tr><td>LINK</td><td>搜索某种模式</td></tr><tr><td>IN</td><td>指定针对某个列的多个可能值</td></tr></tbody></table><p>值得注意的是，在判断某个值是否为空值时，应该使用is null或is not null来判断，而不是使用”= null”或”!= null”。</p><h3 id="使用通配符进行过滤"><a href="#使用通配符进行过滤" class="headerlink" title="使用通配符进行过滤"></a>使用通配符进行过滤</h3><p>在使用通配符进行过滤进，我们使用like操作符进行。</p><p>通配符主要包括两个，它们分别为百分号’%’和下划线’<em>‘，其中’%’表示使用长度的字符串，而下划线’</em>‘只表示一个字符；需要注意的是，’%’不仅可以表示一个或多个字符，还可以表示0个字符。</p><h2 id="创建计算字段"><a href="#创建计算字段" class="headerlink" title="创建计算字段"></a>创建计算字段</h2><h3 id="计算字段"><a href="#计算字段" class="headerlink" title="计算字段"></a>计算字段</h3><p>存储在数据库中的数据一般不是应用程序所需要的格式。</p><p>我们需要直接从数据库中检索出转化、计算或格式化过的数据；而不是检索出数据，然后再在客户机应用改程序或报告程序中重新格式化。</p><p>只有数据库知道select语句中哪些列是实际的表列，哪些列是计算字段。从客户机（应用程序）的角度来看，计算字段的数据是以与其它列的数据相同的方式返回的。</p><h3 id="拼接字段"><a href="#拼接字段" class="headerlink" title="拼接字段"></a>拼接字段</h3><p>在mysql中，我们可以使用concat函数对字段进行拼接，格式如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">concat(str1, str2, str3.....);</span><br></pre></td></tr></table></figure><p>对于字符串中存在的空格，我们可以用字符串处理函数RTRIM()、LTRIM()、TRIM()来进行处理。</p><h3 id="使用别名"><a href="#使用别名" class="headerlink" title="使用别名"></a>使用别名</h3><p>我们可以用关键字as来给我们的列起一个别名。格式如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &lt;列名&gt; as &lt;别名&gt; from &lt;表名&gt;;</span><br></pre></td></tr></table></figure><h2 id="使用函数处理数据"><a href="#使用函数处理数据" class="headerlink" title="使用函数处理数据"></a>使用函数处理数据</h2><p>函数的可移植性是很可的，而且使用函数可以很方便的对数据进行处理。</p><p>mysql函数主要有甲种</p><ul><li>文本函数</li><li>数值函数</li><li>时间与日期函数</li><li>系统函数</li></ul><p>下面介绍常用的一些函数</p><h3 id="文本函数"><a href="#文本函数" class="headerlink" title="文本函数"></a>文本函数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">left(s, n)      //返回字符串左边的n个字符</span><br><span class="line">right(s, n)     //返回字符串右边的n个字符</span><br><span class="line">trim(s)         //去掉字符串s的空格</span><br><span class="line">ltrim(s)        //去掉字符中左边的空格</span><br><span class="line">rtrim(s)        //去掉字符串右边的空格</span><br><span class="line">length(s)       //计算字符串的长度</span><br><span class="line">lower(s)        //将字符串的所有字符变成小写</span><br><span class="line">upper(s)        //将字符串的所有字符变成大写</span><br></pre></td></tr></table></figure><h3 id="数值函数"><a href="#数值函数" class="headerlink" title="数值函数"></a>数值函数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">abs(x)      //绝对值</span><br><span class="line">cos(x)</span><br><span class="line">sin(x)</span><br><span class="line">tan(x)</span><br><span class="line">acos(x) asin(x) atan(x)     //三角函数</span><br><span class="line">ceil(x)        //返回大于或等于X的最小整数</span><br><span class="line">floor(x)       //舍去x的小数部分，只保留整数部分，并且不进行四舍五入</span><br><span class="line">pi()           //返回圆周率</span><br><span class="line">sqrt(x)        //平方根</span><br><span class="line">pow(x,y)       //x的y次方</span><br><span class="line">exp(x)         //返回e的x次方</span><br><span class="line">rand()         //返回0－1的随机数</span><br><span class="line">round(x,y)     //返回x的值小数点后面的第y位，进行四舍五入</span><br><span class="line">truncate(x,y)  //返回x的值小数点后面的第y位，不进行四舍五入</span><br></pre></td></tr></table></figure><h3 id="日期与时间函数"><a href="#日期与时间函数" class="headerlink" title="日期与时间函数"></a>日期与时间函数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">current_date()      //返回当前日期</span><br><span class="line">current_time()      //返回当前时间</span><br><span class="line">current_timestap()/now()        //返回当前日期和时间</span><br><span class="line">date()              //从日期或日期时间中撮日期值</span><br><span class="line">year() month() day() hour() minute()</span><br><span class="line">date_format(d, f)   //以指定格式显示日期</span><br><span class="line">datediff()</span><br><span class="line">timediff()</span><br><span class="line">timestapdiff()</span><br></pre></td></tr></table></figure><h3 id="汇总数据"><a href="#汇总数据" class="headerlink" title="汇总数据"></a>汇总数据</h3><p><strong>聚合函数</strong>：聚合函数就是用来数据汇总的一类函数。以下五个险函数务必牢记。它们通常和分级数据结合使用：</p><ul><li>avg()</li><li>min()</li><li>max()</li><li>count()</li><li>sum()</li></ul><p>需要注意的是，聚合函数均不会处理NULL值</p><h2 id="分级数据"><a href="#分级数据" class="headerlink" title="分级数据"></a>分级数据</h2><h3 id="创建分组"><a href="#创建分组" class="headerlink" title="创建分组"></a>创建分组</h3><p>创建分组使用group by子句，格式如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select &lt;列名&gt; from &lt;表名&gt;</span><br><span class="line"><span class="built_in">where</span> &lt;过滤条件&gt;</span><br><span class="line">group by &lt;列名&gt;</span><br><span class="line">having &lt;过滤条件&gt;</span><br><span class="line">order by &lt;列名&gt; &lt;排序方式&gt;</span><br></pre></td></tr></table></figure><p>其实上面的格式也是select语句完整格式。</p><h3 id="过滤分组"><a href="#过滤分组" class="headerlink" title="过滤分组"></a>过滤分组</h3><p>过滤分组倩having，牢记<strong>where是行级过滤，having是组级过滤</strong></p><h2 id="使用子查询"><a href="#使用子查询" class="headerlink" title="使用子查询"></a>使用子查询</h2><p>子查询也就是select语句的嵌套，有了子查询我们就可以进行复杂的查询。</p><p>子查询返回的一张表，所以基位置也比较灵活，可以位于rom后面，也可以位于where后面。</p><p>子查询也可以说是<strong>一个一次性的视图</strong>。</p><p>在执行顺序上，先执行子查询，再执行外层的查询。</p><p>牢记：<strong>where子句中不能使用聚合函数</strong></p><h2 id="连接表"><a href="#连接表" class="headerlink" title="连接表"></a>连接表</h2><p>表的连接主要分为以下几种：</p><ul><li>内连接</li><li>外连接（左连接、右连接）</li><li>自连接</li></ul><h3 id="内连接"><a href="#内连接" class="headerlink" title="内连接"></a>内连接</h3><p>语法格式如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 查询字段 FROM 表1 [as] 别名 [INNER] JOIN 表2 [as] 别名 ON 表1.关系字段 ＝ 表2.关系字段</span><br></pre></td></tr></table></figure><p>内连接就是两个表的次部分。</p><h3 id="左连接"><a href="#左连接" class="headerlink" title="左连接"></a>左连接</h3><p>语法格式如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 查询字段 FROM 表1 [as] 别名 LEFT JOIN 表2 [as] 别名 ON 表1.关系字段 ＝ 表2.关系字段</span><br></pre></td></tr></table></figure><p>左连接就是左边表的记录要全部显示出来，右右只有和械表匹配到的记录才进行显示。</p><h3 id="右连接"><a href="#右连接" class="headerlink" title="右连接"></a>右连接</h3><p>和左连接相反。</p><h3 id="自连接"><a href="#自连接" class="headerlink" title="自连接"></a>自连接</h3><p>就是表一张表看成两张表，进行自连接往往是一张表的某些列间存在逻辑关系。</p><h2 id="组合查询"><a href="#组合查询" class="headerlink" title="组合查询"></a>组合查询</h2><h3 id="创建组合查询"><a href="#创建组合查询" class="headerlink" title="创建组合查询"></a>创建组合查询</h3><p>创建组合查询时我们使用UNION将两个或多个select语句查询的结果组合在一起形成一个表。</p><p>需要不同的select语句返回相同数量的列且对应列的数据类型相同，事实上应该是意义都一样才合理。</p><h3 id="union与union-all"><a href="#union与union-all" class="headerlink" title="union与union all"></a>union与union all</h3><p>对于组合查询结果的排序只需要使用一个order by子名句，放在最后一个select语句的后面即可。</p><h2 id="插入、更新删除数据"><a href="#插入、更新删除数据" class="headerlink" title="插入、更新删除数据"></a>插入、更新删除数据</h2><h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into &lt;表名&gt;(列名1，列名2，列名3...) values (数据...);</span><br></pre></td></tr></table></figure><p>虽然表名后面的列名表不是严格要求的，但是这样会更安全。如果不写出列名，则需要严格按照表的定义插入数据。</p><p>如果我们只需要插入一行中的部分列，那么列出列名就变得必须了。</p><h4 id="插入检索出的数据"><a href="#插入检索出的数据" class="headerlink" title="插入检索出的数据"></a>插入检索出的数据</h4><p>使用insert …select 语句进行。以下是格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into &lt;表名&gt;(列名表)</span><br><span class="line">select &lt;列名表&gt; from &lt;表名&gt;;</span><br></pre></td></tr></table></figure><h4 id="复制表"><a href="#复制表" class="headerlink" title="复制表"></a>复制表</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create table copytable as </span><br><span class="line">select * from &lt;表名&gt;;</span><br></pre></td></tr></table></figure><h4 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">update &lt;表名&gt;</span><br><span class="line"><span class="built_in">set</span> &lt;列名&gt; = ...</span><br><span class="line"><span class="built_in">where</span> &lt;过滤条件&gt;;</span><br></pre></td></tr></table></figure><p>一定切记不要忘了过滤条件，否则将会对所有的行的数据进行更新。</p><h4 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delect from &lt;表名&gt; <span class="built_in">where</span> &lt;过滤条件&gt;;</span><br></pre></td></tr></table></figure><p>如果要删除某行中某列的元素，可以将其值更新为NULL。</p><h2 id="使用视图"><a href="#使用视图" class="headerlink" title="使用视图"></a>使用视图</h2><p>视图是一张虚表，它并不在座实际的数据，存储的只是select语句。</p><p>使用视力有如下的优点</p><ul><li>提高sql语句的重用性</li><li>保证了数据的安全性</li><li>大大简化了sql语句</li></ul><h3 id="创建视图"><a href="#创建视图" class="headerlink" title="创建视图"></a>创建视图</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create view &lt;视图名&gt; as &lt;select 语句&gt;;</span><br></pre></td></tr></table></figure><h3 id="删除视图"><a href="#删除视图" class="headerlink" title="删除视图"></a>删除视图</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop view &lt;视图名&gt;;</span><br></pre></td></tr></table></figure><h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><h3 id="什么是事务"><a href="#什么是事务" class="headerlink" title="什么是事务"></a>什么是事务</h3><p>需要在同一个处理单元中执行的一系列更新处理的集合。一个事务中包含了多少个更新处理或者包含了哪些处理，在DBMS中没有固定的标准，而是根据用户的要求决定的。</p><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">start tyransaction;</span><br><span class="line">DML 语句1；</span><br><span class="line">DML 语句2；</span><br><span class="line">DML 语句3；</span><br><span class="line">...</span><br><span class="line">ROLLBACK／COMMIT；</span><br></pre></td></tr></table></figure><h3 id="理解事务"><a href="#理解事务" class="headerlink" title="理解事务"></a>理解事务</h3><p>事务其实很好理解，它将一系列操作放在一个块中形成一个代码块，这个代码块要执行就全部执行，要么就不执行。</p><p>拿银行转账为例，转账过程为，我的账户金额减少－－》对方账户金额增加－－》交易完毕。</p><p>如果我的账户金额减少后出现了故障导致对方账户金额没有增加，那么这肯定是不被允许的。所以这个转账过程中的每一步都必须完整的执行。</p><p>ROLLBACK就是在DML语句出现故障时，来便利数据库回滚到执行操作前的状态。而COMMIT则是所有DML正确执行后才执行，告诉系统这个事务正常完成了，系统可以进入下一个新的状态了。</p><h2 id="补充知识点"><a href="#补充知识点" class="headerlink" title="补充知识点"></a>补充知识点</h2><h3 id="case-when-语句"><a href="#case-when-语句" class="headerlink" title="case when 语句"></a>case when 语句</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> when &lt;表达式1&gt; <span class="keyword">then</span> &lt;表达式&gt;</span><br><span class="line">     when &lt;表达式2&gt; them &lt;表达式&gt;</span><br><span class="line">     ...</span><br><span class="line">     <span class="keyword">else</span> &lt;表达式&gt;</span><br><span class="line">end</span><br></pre></td></tr></table></figure><h3 id="sql语句及种类"><a href="#sql语句及种类" class="headerlink" title="sql语句及种类"></a>sql语句及种类</h3><p>这是sql的基础知识：</p><p>－ DDL：数据定义语言，用来创建、删除存储数据的数据训以及数据库中的表的对象，包含的指令有：CREATE、DROOP、ALTER<br>－ DML：数据操纵语言，用来查询或者变更表中的记录。包含的指令有：SELECT、INSERT、UPDATE、DELETE<br>－ DCL：数据控制语言，用来确认或者取消对数据库中的数据进行的变量。包含的指令有：COMMIT、ROLLBACK、GRANT、REVOKE</p><h3 id="exists谓词"><a href="#exists谓词" class="headerlink" title="exists谓词"></a>exists谓词</h3><p>在sql语言中，exists(存在)谓词是一个非常重要的查询关键词。</p><p>exists代表<strong>存在</strong>量词。带有exists谓词的子查询不返回任何数据，只产生逻辑真值“true”或逻辑假值“flase”。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;mysql基本常用命令汇总&quot;&gt;&lt;a href=&quot;#mysql基本常用命令汇总&quot; class=&quot;headerlink&quot; title=&quot;mysql基本常用命令汇总&quot;&gt;&lt;/a&gt;mysql基本常用命令汇总&lt;/h1&gt;&lt;h2 id=&quot;常用总结&quot;&gt;&lt;a href=&quot;#常用总结&quot;
      
    
    </summary>
    
    
      <category term="database" scheme="https://ywmy210.github.io/ywmy/tags/database/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://ywmy210.github.io/ywmy/2019/04/20/hello-world/"/>
    <id>https://ywmy210.github.io/ywmy/2019/04/20/hello-world/</id>
    <published>2019-04-20T04:07:41.045Z</published>
    <updated>2019-04-20T04:07:41.045Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>linux下的病毒防护</title>
    <link href="https://ywmy210.github.io/ywmy/2019/04/18/linux%E4%B8%8B%E7%9A%84%E7%97%85%E6%AF%92%E9%98%B2%E6%8A%A4/"/>
    <id>https://ywmy210.github.io/ywmy/2019/04/18/linux下的病毒防护/</id>
    <published>2019-04-18T00:49:58.000Z</published>
    <updated>2019-04-18T02:32:54.488Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Linux-下的病毒防护"><a href="#Linux-下的病毒防护" class="headerlink" title="Ｌinux 下的病毒防护"></a>Ｌinux 下的病毒防护</h2><p>没有绝对安全的系统，linux下也存在病毒及安全后门。记录linux下的杀毒引擎clamav的安装及使用。</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>CentOS直接通过yum安装。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install epel-release -y</span><br><span class="line">sudo yum install clamav -y</span><br></pre></td></tr></table></figure><p>Ubuntu直接通过atp安装。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install clamav</span><br></pre></td></tr></table></figure><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>安装后，更新病毒库。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># freshclam</span></span><br><span class="line"><span class="comment"># 输出如下：</span></span><br><span class="line">...............</span><br><span class="line">ClamAV update process started at Sun Apr  7 11:10:18 2019</span><br><span class="line">Downloading main.cvd [100%]</span><br><span class="line">main.cvd updated (version: 58, sigs: 4566249, f-level: 60, builder: sigmgr)</span><br><span class="line">Downloading daily.cvd [100%]</span><br><span class="line">daily.cvd updated (version: 25422, sigs: 1552110, f-level: 63, builder: raynman)</span><br><span class="line">Downloading bytecode.cvd [100%]</span><br><span class="line">bytecode.cvd updated (version: 328, sigs: 94, f-level: 63, builder: neo)</span><br><span class="line">[LibClamAV] ******************************************************</span><br><span class="line">[LibClamAV] ***      Virus database timestamp <span class="keyword">in</span> the future!   ***</span><br><span class="line">[LibClamAV] ***  Please check the timezone and clock settings  ***</span><br><span class="line">[LibClamAV] ******************************************************</span><br><span class="line">Database updated (6118453 signatures) from database.clamav.net (IP: 104.16.219.84)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Linux-下的病毒防护&quot;&gt;&lt;a href=&quot;#Linux-下的病毒防护&quot; class=&quot;headerlink&quot; title=&quot;Ｌinux 下的病毒防护&quot;&gt;&lt;/a&gt;Ｌinux 下的病毒防护&lt;/h2&gt;&lt;p&gt;没有绝对安全的系统，linux下也存在病毒及安全后门。记录l
      
    
    </summary>
    
    
      <category term="linux" scheme="https://ywmy210.github.io/ywmy/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>ubuntu下的一些小折腾</title>
    <link href="https://ywmy210.github.io/ywmy/2019/04/17/ubuntu%E4%B8%8B%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%8A%98%E8%85%BE/"/>
    <id>https://ywmy210.github.io/ywmy/2019/04/17/ubuntu下的一些小折腾/</id>
    <published>2019-04-17T02:08:56.000Z</published>
    <updated>2019-04-17T03:27:16.282Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Ubuntu-18-04-小问题"><a href="#Ubuntu-18-04-小问题" class="headerlink" title="Ubuntu 18.04 小问题"></a>Ubuntu 18.04 小问题</h1><h2 id="ibus候选词方块"><a href="#ibus候选词方块" class="headerlink" title="ibus候选词方块"></a>ibus候选词方块</h2><ul><li>问题描述</li></ul><p>默认的ibus输入法，在输入中文的时候，会出现候选词为方块的现象，原因大致为输入法码表与系统字体渲染的问题。即码表中字符在系统的字体库中找不到对应的字体。虽然不影响使用，且码表中匹配的字大都为繁体或生僻字，看到方块，总有一种要干掉方块字的冲动。尝试把系统字体更改为思源黑体，不过输入法候选词中仍然存在方块。更改输入法显示字体：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ibus-setup</span><br></pre></td></tr></table></figure><p>更改如图：</p><p><img src="http://blog.ywmy.xyz/linux/ibus_setup.png" alt="ibus-setup"></p><p>尝试安装更多字符集的字体库，如明朝花园Ｂ。</p><p>下载链接<a href="1">请戳</a></p><p>补充CJK字体在不同程序之间输入显示的一个小问题，比如码表同[IDRN]源下加心，𢢵.这个字在VS CODE中可以显示，谷歌浏览器中也可以正常显示，在WPS中则显示为潮。</p><h2 id="vs-code-power-line-font"><a href="#vs-code-power-line-font" class="headerlink" title="vs code power-line font"></a>vs code power-line font</h2><ul><li>问题描述</li></ul><p>在昨天没事的时候，把系统的默认的bash更改为zsh，并配置了美化，oh my zsh。</p><p>终端上可以很赏心悦目了，不过在打开vs code的时候，调用zsh会出现power-line字体不显示的问题，具体可看下图：</p><p><img src="http://blog.ywmy.xyz/linux/vs_code_powerline.png" alt="vs_code_powerline"></p><ul><li>解决办法</li></ul><ol><li>安装power-line字体</li></ol><p>下载<a href="2">请戳</a></p><ol start="2"><li>配置vs code</li></ol><p>操作步骤：设置－&gt;打开json设置-&gt;输入以下调用字体信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">"terminal.integrated.fontFamily"</span>: <span class="string">"Menlo for Powerline"</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>参考下图：</p><p><img src="http://blog.ywmy.xyz/linux/vs_code_powerline_set.png" alt="vs_code_powerline_set"></p><p>完成设置后，显示效果生效，参考下图：</p><p><img src="http://blog.ywmy.xyz/linux/vs_code_json_set.png" alt="vs_code_json_ser"></p><p><a href="3">参考链接</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Ubuntu-18-04-小问题&quot;&gt;&lt;a href=&quot;#Ubuntu-18-04-小问题&quot; class=&quot;headerlink&quot; title=&quot;Ubuntu 18.04 小问题&quot;&gt;&lt;/a&gt;Ubuntu 18.04 小问题&lt;/h1&gt;&lt;h2 id=&quot;ibus候选词方块
      
    
    </summary>
    
    
      <category term="linux" scheme="https://ywmy210.github.io/ywmy/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>记一些ubuntu 18.04的小毛病</title>
    <link href="https://ywmy210.github.io/ywmy/2019/04/13/%E8%AE%B0%E4%B8%80%E4%BA%9Bubuntu-18-04%E7%9A%84%E5%B0%8F%E6%AF%9B%E7%97%85/"/>
    <id>https://ywmy210.github.io/ywmy/2019/04/13/记一些ubuntu-18-04的小毛病/</id>
    <published>2019-04-13T10:28:11.000Z</published>
    <updated>2019-04-14T02:02:20.813Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Ubuntu-18-04个人使用问题汇总"><a href="#Ubuntu-18-04个人使用问题汇总" class="headerlink" title="Ubuntu 18.04个人使用问题汇总"></a>Ubuntu 18.04个人使用问题汇总</h1><p>使用桌面版的ubuntu，总会有一些小问题，也经常会疑惑，好好的用着，怎么突然就不行了呢。本着能折腾就折腾的原则，记录一下，目前遇到的，比较深刻的小问题。</p><h2 id="启动后无法进入X-org环境"><a href="#启动后无法进入X-org环境" class="headerlink" title="启动后无法进入X.org环境"></a>启动后无法进入X.org环境</h2><p>在一次更新操作后，重启了，选择X.org进入后，只有桌面壁纸，鼠标键盘无反应。</p><p>但是进入Wayland环境没有问题，正常操作。</p><p>记录以下操作：</p><p>因为也确实不清楚原因。大概能猜到和桌面环境有关系。</p><p>操作尝试：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ubuntu-desktop</span><br><span class="line">sudo apt install xserver-xong-input-all</span><br><span class="line">sudo apt install input-utils</span><br></pre></td></tr></table></figure><p>结束后，重启，进入X.org桌面，好了。正常操作了。</p><h2 id="QT5程序缩放不正常"><a href="#QT5程序缩放不正常" class="headerlink" title="QT5程序缩放不正常"></a>QT5程序缩放不正常</h2><p>同样在一次电脑启动后，发现一个常用的程序，QT5界面本来运行时，正常的图标，变小了，窗口变大了，字体变模糊了，而且，窗口调整还不正常。</p><p>试了一下另外一个QT5写的程序，stacer。打开发现，比例倒是正常的，缩放比正常大了两倍左右，字体显示倒是正常。</p><p>还有一个也是天天用的。网易云音乐，打开后，也是比正常缩放大了两倍左右，字体也模糊。系统程序都是正常的，想了一下，应该是QT5程序的问题。</p><p>百度关键字，QT5 缩放，还真有和QT 5相关各种缩放问题，再想到是不是和屏幕分辨训练场有关，自己屏幕是1080P的，检索关键字：QT5 HiDPI scaling gonme 3，比如这篇<a href="https://unix.stackexchange.com/questions/433385/scaling-hidpi-issue-for-qt5-applications-under-gnome" target="_blank" rel="noopener">请戳</a>。还有一篇，也是写到高分辨率下的缩放问题，据说是一个多年没人管的BUG，链接<a href="https://my.oschina.net/flywuya/blog/1797527" target="_blank" rel="noopener">请戳</a>。</p><p>好了，这次明白了，思路就是启动程序时手动调整绽放比例，或者是调字体DPI。</p><p>最后给个直接改启动参数的方法。效果是出来了，也算是正常使用了。</p><p>参考网易云音乐的启动参数，字体显示正常，缩放不正常的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /usr/share/applications/netease-cloud-music.desktop</span><br><span class="line"></span><br><span class="line">[Desktop Entry]</span><br><span class="line">Version=1.0</span><br><span class="line">Type=Application</span><br><span class="line">Name=NetEase Cloud Music</span><br><span class="line">Name[zh_CN]=网易云音乐</span><br><span class="line">Name[zh_TW]=網易雲音樂</span><br><span class="line">Comment=NetEase Cloud Music</span><br><span class="line">Comment[zh_CN]=网易云音乐</span><br><span class="line">Comment[zh_TW]=網易雲音樂</span><br><span class="line">Icon=netease-cloud-music</span><br><span class="line">Exec=sh -c <span class="string">"unset SESSION_MANAGER &amp;&amp; netease-cloud-music %U"</span></span><br><span class="line">Categories=AudioVideo;Player;</span><br><span class="line">Terminal=<span class="literal">false</span></span><br><span class="line">StartupNotify=<span class="literal">true</span></span><br><span class="line">StartupWMClass=netease-cloud-music</span><br><span class="line">MimeType=audio/aac;audio/flac;audio/mp3;audio/mp4;audio/mpeg;audio/ogg;audio/x-ape;audio/x-flac;audio/x-mp3;audio/x-mpeg;audio/x-ms-wma;audio/x-vorbis;audio/x-vorbis+ogg;audio/x-wav;</span><br><span class="line">Exec=env QT_SCALE_FACTOR=0.5 /usr/bin/netease-cloud-music   <span class="comment">#这一行，启动时调整绽放比例</span></span><br></pre></td></tr></table></figure><p>参考stacer启动参数，绽放和字体都不正常的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /usr/share/applications/stacer.desktop </span><br><span class="line"></span><br><span class="line">[Desktop Entry]</span><br><span class="line">Name=Stacer</span><br><span class="line">Exec=stacer</span><br><span class="line">Comment=Linux System Optimizer and Monitoring</span><br><span class="line">Icon=stacer</span><br><span class="line">Type=Application</span><br><span class="line">Terminal=<span class="literal">false</span></span><br><span class="line">Encoding=UTF-8</span><br><span class="line">Categories=Utility;</span><br><span class="line">Exec=env QT_SCALE_FACTOR=0.5 QT_FONT_DPI=180 /usr/share/stacer/stacer  <span class="comment">#这一行，既调比例，也调DPI</span></span><br></pre></td></tr></table></figure><p>缩放比例和字体渲染，看自已屏幕分辨率，调整完后，试一下程序启动后的效果。好了，这个问题也算是处理结束。</p><p>再一次回到第一个问题上，Wayland环境上，基本自己使用的程序都能正常使用。有一点，自己买了一块wacom的手绘板，github上有一个linux wacom project的项目，可以支持linux使用手绘板。不过一个小问题，手绘板在wayland上使用的时候，手绘笔没办法选取程序的菜单项，暂时应该无解。所以默认就X.org环境启动系统使用了。</p><p>小记结束。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Ubuntu-18-04个人使用问题汇总&quot;&gt;&lt;a href=&quot;#Ubuntu-18-04个人使用问题汇总&quot; class=&quot;headerlink&quot; title=&quot;Ubuntu 18.04个人使用问题汇总&quot;&gt;&lt;/a&gt;Ubuntu 18.04个人使用问题汇总&lt;/h1&gt;&lt;
      
    
    </summary>
    
    
      <category term="linux" scheme="https://ywmy210.github.io/ywmy/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>ubuntu 18.04 安装 nginx</title>
    <link href="https://ywmy210.github.io/ywmy/2019/04/12/ubuntu-18-04-%E5%AE%89%E8%A3%85-nginx/"/>
    <id>https://ywmy210.github.io/ywmy/2019/04/12/ubuntu-18-04-安装-nginx/</id>
    <published>2019-04-12T03:25:50.000Z</published>
    <updated>2019-04-15T01:36:38.107Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ubuntu-18-04-安装-nginx"><a href="#ubuntu-18-04-安装-nginx" class="headerlink" title="ubuntu 18.04 安装 nginx"></a>ubuntu 18.04 安装 nginx</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>服务器上安装了两个服务。通过外网加端口访问。需求通过nginx代理访问两个服务。</p><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p>ubuntu 18.04,非root，常规用户账户。</p><h2 id="Step1-Installing-Nginx"><a href="#Step1-Installing-Nginx" class="headerlink" title="Step1-Installing Nginx"></a>Step1-Installing Nginx</h2><p>Ubuntu 18.04默认软件库中包含Nginx包。所以可以直接通过apt包管理工具进行安装。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install nginx</span><br></pre></td></tr></table></figure><h2 id="Step2-Adjusting-the-Firewall"><a href="#Step2-Adjusting-the-Firewall" class="headerlink" title="Step2-Adjusting the Firewall"></a>Step2-Adjusting the Firewall</h2><p>在进行Nginx测试之前，需求调整防火墙设置放通Nginx服务。</p><p>相看ufw应用列表。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw app list</span><br></pre></td></tr></table></figure><p>输出内容:</p><blockquote><p>Available applications:<br>Nginx Full<br>Nginx HTTP<br>Nginx HTTPS</p></blockquote><p>如所见，Nginx Full即放通80和443，Nginx HTTP即放通80，Nginx HTTPS即放通443。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow <span class="string">'Nginx FULL'</span></span><br></pre></td></tr></table></figure><h2 id="Step3-Checking-your-Web-Server"><a href="#Step3-Checking-your-Web-Server" class="headerlink" title="Step3-Checking your Web Server"></a>Step3-Checking your Web Server</h2><p>安装结束，程序服务就会启用。通过systemctl查看Nginx相关的进程信息。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status nginx </span><br><span class="line"></span><br><span class="line">● nginx.service - A high performance web server and a reverse proxy server</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Sat 2019-04-13 09:41:04 UTC; 10s ago</span><br><span class="line">     Docs: man:nginx(8)</span><br><span class="line">  Process: 4576 ExecStop=/sbin/start-stop-daemon --quiet --stop --retry QUIT/5 --pidfile /run/nginx.pid (code=exited, status=2)</span><br><span class="line">  Process: 4586 ExecStart=/usr/sbin/nginx -g daemon on; master_process on; (code=exited, status=0/SUCCESS)</span><br><span class="line">  Process: 4577 ExecStartPre=/usr/sbin/nginx -t -q -g daemon on; master_process on; (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 4589 (nginx)</span><br><span class="line">    Tasks: 2 (<span class="built_in">limit</span>: 1110)</span><br><span class="line">   CGroup: /system.slice/nginx.service</span><br><span class="line">           ├─4589 nginx: master process /usr/sbin/nginx -g daemon on; master_process on;</span><br><span class="line">           └─4593 nginx: worker process</span><br><span class="line"></span><br><span class="line">Apr 13 09:41:04 vultr_vps_server systemd[1]: Starting A high performance web server and a reverse proxy server...</span><br></pre></td></tr></table></figure><p>安装程序结束。</p><p>一个小问题：启动后的nginx有一个状态问题：</p><blockquote><p>nginx.service: Failed to parse PID from file /run/nginx.pid: Invalid argument</p></blockquote><p>解决方法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Workaround:</span><br><span class="line"></span><br><span class="line"> mkdir /etc/systemd/system/nginx.service.d</span><br><span class="line"> <span class="built_in">printf</span> <span class="string">"[Service]\nExecStartPost=/bin/sleep 0.1\n"</span> &gt; /etc/systemd/system/nginx.service.d/override.conf</span><br><span class="line"> systemctl daemon-reload</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ubuntu-18-04-安装-nginx&quot;&gt;&lt;a href=&quot;#ubuntu-18-04-安装-nginx&quot; class=&quot;headerlink&quot; title=&quot;ubuntu 18.04 安装 nginx&quot;&gt;&lt;/a&gt;ubuntu 18.04 安装 nginx&lt;/
      
    
    </summary>
    
    
      <category term="linux" scheme="https://ywmy210.github.io/ywmy/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>ubuntu 18.04 安装 lanproxy</title>
    <link href="https://ywmy210.github.io/ywmy/2019/04/11/ubuntu-18-04-%E5%AE%89%E8%A3%85-lanproxy/"/>
    <id>https://ywmy210.github.io/ywmy/2019/04/11/ubuntu-18-04-安装-lanproxy/</id>
    <published>2019-04-11T07:13:18.000Z</published>
    <updated>2019-04-11T08:36:28.845Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Ubuntu-18-04-安装-lanproxy"><a href="#Ubuntu-18-04-安装-lanproxy" class="headerlink" title="Ubuntu 18.04 安装 lanproxy"></a>Ubuntu 18.04 安装 lanproxy</h1><p>lanproxy git-hub地址<a href="https://github.com/ffay/lanproxy" target="_blank" rel="noopener">请戳</a></p><h2 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h2><h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><p>lanproxy依赖于java。服务端安装java通过包管理工具实现如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install default-jdk</span><br><span class="line"></span><br><span class="line">java --version</span><br><span class="line">openjdk 10.0.2 2018-07-17</span><br><span class="line">OpenJDK Runtime Environment (build 10.0.2+13-Ubuntu-1ubuntu0.18.04.4)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 10.0.2+13-Ubuntu-1ubuntu0.18.04.4, mixed mode)</span><br></pre></td></tr></table></figure><h3 id="下载服务端"><a href="#下载服务端" class="headerlink" title="下载服务端"></a>下载服务端</h3><p>本文直接是先下载到自己电脑，然后上传至服务器，方式随意。下载地址<a href="https://github.com/ffay/lanproxy/releases" target="_blank" rel="noopener">请戳</a></p><p>上传通过sftp</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sftp -i identify_file -P port user@host</span><br><span class="line">....</span><br><span class="line">&gt; put local_file remote_host_directory  <span class="comment">#上传至远程目录</span></span><br><span class="line">....</span><br><span class="line">退出sftp程序</span><br></pre></td></tr></table></figure><h3 id="服务端配置"><a href="#服务端配置" class="headerlink" title="服务端配置"></a>服务端配置</h3><p>登录远程主机，将程序包解压，把程序文件移动到你想要放置的路径如/usr/bin/</p><blockquote><p>/usr/bin/proxy-server  </p></blockquote><p>大概以上路径。</p><p>配置文件在程序的config目录下，名字为：config.properties</p><p>内容如下：</p><blockquote><p>server.bind=0.0.0.0<br>server.port=4900</p><p>server.ssl.enable=true<br>server.ssl.bind=0.0.0.0<br>server.ssl.port=4993<br>server.ssl.jksPath=test.jks<br>server.ssl.keyStorePassword=123456<br>server.ssl.keyManagerPassword=123456<br>server.ssl.needsClientAuth=false  </p><p>config.server.bind=0.0.0.0<br>config.server.port=8090<br>config.admin.username=admin<br>config.admin.password=admin  </p></blockquote><p>按需要更改。</p><h3 id="防火墙放通端口"><a href="#防火墙放通端口" class="headerlink" title="防火墙放通端口"></a>防火墙放通端口</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow 8090/tcp </span><br><span class="line">sudo ufw reload</span><br></pre></td></tr></table></figure><h3 id="服务器测试"><a href="#服务器测试" class="headerlink" title="服务器测试"></a>服务器测试</h3><p>运行服务端，启动程序脚本在程序目录bin文件夹下。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./startup.sh</span><br></pre></td></tr></table></figure><p>打开IP:8090。程序运行。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Ubuntu-18-04-安装-lanproxy&quot;&gt;&lt;a href=&quot;#Ubuntu-18-04-安装-lanproxy&quot; class=&quot;headerlink&quot; title=&quot;Ubuntu 18.04 安装 lanproxy&quot;&gt;&lt;/a&gt;Ubuntu 18.04 安
      
    
    </summary>
    
    
      <category term="linux" scheme="https://ywmy210.github.io/ywmy/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>ubuntu 18.04 安装wireshark</title>
    <link href="https://ywmy210.github.io/ywmy/2019/04/11/ubuntu-18-04-%E5%AE%89%E8%A3%85wireshark/"/>
    <id>https://ywmy210.github.io/ywmy/2019/04/11/ubuntu-18-04-安装wireshark/</id>
    <published>2019-04-11T05:24:21.000Z</published>
    <updated>2019-04-11T05:34:57.568Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Ubuntu-18-04-安装-wireshark"><a href="#Ubuntu-18-04-安装-wireshark" class="headerlink" title="Ubuntu 18.04 安装 wireshark"></a>Ubuntu 18.04 安装 wireshark</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install wireshark wireshark-common</span><br></pre></td></tr></table></figure><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>非root用户下的wireshark没有抓包权限</p><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><ol><li>以root用户运行</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo wireshark</span><br></pre></td></tr></table></figure><ol start="2"><li>配置非root用户抓包</li></ol><p>安装完成后，wireshark文档中有相应的处理方法。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gzip -d /usr/share/doc/wireshark-common/README.Debian.gz</span><br></pre></td></tr></table></figure><p>解压文档后，可以参考操作方法如下：</p><blockquote><p> sudo usermod -a -G wireshark {username}</p></blockquote><p>或者</p><blockquote><p>sudo gpasswd -a your_name wireshark  </p></blockquote><p>重新配置抓取权限</p><blockquote><p>sudo dpkg-reconfigure wireshark-common<br>“Should non-superusers be able to capture packages?”<br>选择yes(默认是no)</p></blockquote><p>注销用户或重启，再次打开wireshark，正常选取网卡列表。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Ubuntu-18-04-安装-wireshark&quot;&gt;&lt;a href=&quot;#Ubuntu-18-04-安装-wireshark&quot; class=&quot;headerlink&quot; title=&quot;Ubuntu 18.04 安装 wireshark&quot;&gt;&lt;/a&gt;Ubuntu 18.0
      
    
    </summary>
    
    
      <category term="linux" scheme="https://ywmy210.github.io/ywmy/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>华为交换机清除console密码</title>
    <link href="https://ywmy210.github.io/ywmy/2019/04/11/%E5%8D%8E%E4%B8%BA%E4%BA%A4%E6%8D%A2%E6%9C%BA%E6%B8%85%E9%99%A4console%E5%AF%86%E7%A0%81/"/>
    <id>https://ywmy210.github.io/ywmy/2019/04/11/华为交换机清除console密码/</id>
    <published>2019-04-11T01:14:56.000Z</published>
    <updated>2019-04-11T04:59:33.949Z</updated>
    
    <content type="html"><![CDATA[<h1 id="华为交换机清除console密码"><a href="#华为交换机清除console密码" class="headerlink" title="华为交换机清除console密码"></a>华为交换机清除console密码</h1><p>昨天下午在准备查看一台交换机配置的时候，发现原来给的登录信息已经不正确了。就想着用console登录试试，发现console登录也设置了用户名和密码，于是只能想到通过启动菜单来尝试清除密码了。</p><p>操作如下：</p><h2 id="启动菜单默认密码"><a href="#启动菜单默认密码" class="headerlink" title="启动菜单默认密码"></a>启动菜单默认密码</h2><ul><li>Console/telnet登录(框式/盒式)</li></ul><table><thead><tr><th>版本</th><th>缺省用户名</th><th>缺省密码</th><th>缺省级别</th></tr></thead><tbody><tr><td>V1R3C00</td><td>N/A</td><td>N/A</td><td>N/A</td></tr><tr><td>V1R5C01</td><td>N/A</td><td>N/A</td><td>N/A</td></tr><tr><td>V1R6C00－V1R6C05</td><td>N/A</td><td>N/A</td><td>N/A</td></tr><tr><td>V2R2C00－V2R6C00</td><td>N/A</td><td>N/A</td><td>N/A</td></tr></tbody></table><ul><li>Web登录(框式/盒式)</li></ul><table><thead><tr><th>版本</th><th>缺省用户名</th><th>缺省密码</th><th>缺省级别</th></tr></thead><tbody><tr><td>V1R3C00</td><td>admin</td><td>admin</td><td>0</td></tr><tr><td>V1R5C01</td><td>admin</td><td>admin</td><td>0</td></tr><tr><td>V1R6C00</td><td>admin</td><td>admin</td><td>0</td></tr><tr><td>V1R6C05</td><td>admin</td><td><a href="mailto:admin@huawei.com" target="_blank" rel="noopener">admin@huawei.com</a></td><td>0</td></tr><tr><td>V2R1C00</td><td>admin</td><td>admin</td><td>0</td></tr><tr><td>V2R3C00-V2R6C00</td><td>admin</td><td><a href="mailto:admin@huawei.com" target="_blank" rel="noopener">admin@huawei.com</a></td><td>0</td></tr></tbody></table><ul><li>BootROM(框式/盒式)</li></ul><table><thead><tr><th>版本</th><th>缺省用户名</th><th>缺省密码</th><th>缺省级别</th></tr></thead><tbody><tr><td>V1R3C00</td><td>N/A</td><td>9300</td><td>无</td></tr><tr><td>V1R5C01</td><td>N/A</td><td>huawei</td><td>无</td></tr><tr><td>V1R6C00</td><td>N/A</td><td>9300(框式)</td><td>无</td></tr><tr><td>V1R6C00</td><td>N/A</td><td>huawei(盒式)</td><td>无</td></tr></tbody></table><h2 id="恢复console密码"><a href="#恢复console密码" class="headerlink" title="恢复console密码"></a>恢复console密码</h2><ol><li>设备断电</li><li>重新加电</li><li>电脑连CONSOLE口</li><li><p>按CTRL＋B键加载BOOT MENU<br>加载图如下：</p><p><img src="http://blog.ywmy.xyz/network/huawei_boot_menu.png" alt="huawei_boot_memu"></p></li><li><p>清除console密码</p><p> 加载图如下：</p><p> <img src="http://blog.ywmy.xyz/network/clean_password_for_console_user.png" alt="clean_passwrod_for_console_user"></p></li><li><p>恢复默认启动项</p><p>加载图如下：</p><p><img src="http://blog.ywmy.xyz/network/boot_with_default_mode.png" alt="boot_with_default_mode"></p></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;华为交换机清除console密码&quot;&gt;&lt;a href=&quot;#华为交换机清除console密码&quot; class=&quot;headerlink&quot; title=&quot;华为交换机清除console密码&quot;&gt;&lt;/a&gt;华为交换机清除console密码&lt;/h1&gt;&lt;p&gt;昨天下午在准备查看一台交换机
      
    
    </summary>
    
    
      <category term="network" scheme="https://ywmy210.github.io/ywmy/tags/network/"/>
    
  </entry>
  
  <entry>
    <title>CentOS 环境变量配置错误</title>
    <link href="https://ywmy210.github.io/ywmy/2019/04/09/CentOS-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE%E9%94%99%E8%AF%AF/"/>
    <id>https://ywmy210.github.io/ywmy/2019/04/09/CentOS-环境变量配置错误/</id>
    <published>2019-04-09T02:28:32.000Z</published>
    <updated>2019-04-09T02:38:56.629Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CentOS-环境变量配置错误"><a href="#CentOS-环境变量配置错误" class="headerlink" title="CentOS 环境变量配置错误"></a>CentOS 环境变量配置错误</h1><p>今天在配置Maven时，写入一条环境变量，在重新应用环境变量后，发现只有cd命令可以用了。其它命令都不可用。解决办法如下：</p><h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/sudo /bin/vim /etc/profile</span><br></pre></td></tr></table></figure><p>把之前配置的环境变量删除</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/sudo reboot</span><br></pre></td></tr></table></figure><p>重启服务器，重启后，应用新的环境变量。命令正常使用。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;CentOS-环境变量配置错误&quot;&gt;&lt;a href=&quot;#CentOS-环境变量配置错误&quot; class=&quot;headerlink&quot; title=&quot;CentOS 环境变量配置错误&quot;&gt;&lt;/a&gt;CentOS 环境变量配置错误&lt;/h1&gt;&lt;p&gt;今天在配置Maven时，写入一条环境
      
    
    </summary>
    
    
      <category term="linux" scheme="https://ywmy210.github.io/ywmy/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>ssh signing failed</title>
    <link href="https://ywmy210.github.io/ywmy/2019/04/04/ssh-signing-failed/"/>
    <id>https://ywmy210.github.io/ywmy/2019/04/04/ssh-signing-failed/</id>
    <published>2019-04-04T08:15:06.000Z</published>
    <updated>2019-04-04T08:22:32.445Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ssh-signing-faild"><a href="#ssh-signing-faild" class="headerlink" title="ssh signing faild"></a>ssh signing faild</h1><p>前言，自己电脑重装后，把原来的ssh key文件重新拷贝到了新的系统。尝试通过KEY登录远程主机，发现报错如下：</p><blockquote><p>ssh: sign_and_send_pubkey: signing failed: agent refused operation  </p></blockquote><h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><p>选查看文件属性。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown yourname:yourname ~./ssh/*</span><br></pre></td></tr></table></figure><p>查看已添加的KEY</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-add -l</span><br></pre></td></tr></table></figure><p>更改key读写权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 ~./ssh/*</span><br></pre></td></tr></table></figure><p>好了。问题解决。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ssh-signing-faild&quot;&gt;&lt;a href=&quot;#ssh-signing-faild&quot; class=&quot;headerlink&quot; title=&quot;ssh signing faild&quot;&gt;&lt;/a&gt;ssh signing faild&lt;/h1&gt;&lt;p&gt;前言，自己电脑重装后
      
    
    </summary>
    
    
      <category term="linux" scheme="https://ywmy210.github.io/ywmy/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>ubuntu shadow-socket</title>
    <link href="https://ywmy210.github.io/ywmy/2019/04/04/ubuntu-shadow-socket/"/>
    <id>https://ywmy210.github.io/ywmy/2019/04/04/ubuntu-shadow-socket/</id>
    <published>2019-04-04T03:19:21.000Z</published>
    <updated>2019-04-04T03:33:52.134Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ubuntu-shadow-socket"><a href="#ubuntu-shadow-socket" class="headerlink" title="ubuntu shadow-socket"></a>ubuntu shadow-socket</h1><h2 id="0x01-install"><a href="#0x01-install" class="headerlink" title="0x01 install"></a>0x01 install</h2><ul><li>ubuntu</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt install python-pip</span><br><span class="line">pip install shadowsocks</span><br></pre></td></tr></table></figure><p>or </p><p>install pip</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://bootstrap.pypa.ip/get-pip.py</span><br><span class="line">python get-pip.py</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo easy_install shadowsocks</span><br></pre></td></tr></table></figure><ul><li>centos</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install python-setuptool &amp;&amp; easy_install pip</span><br><span class="line">pip install shadowsocks</span><br></pre></td></tr></table></figure><h2 id="0x02-config-file"><a href="#0x02-config-file" class="headerlink" title="0x02 config_file"></a>0x02 config_file</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/shadowsocks.json</span><br><span class="line"></span><br><span class="line">&#123; </span><br><span class="line">   <span class="string">"server"</span>:<span class="string">"my_server_ip"</span>, </span><br><span class="line">   <span class="string">"server_port"</span>:25, </span><br><span class="line">   <span class="string">"local_address"</span>: <span class="string">"127.0.0.1"</span>, </span><br><span class="line">   <span class="string">"local_port"</span>:1080, </span><br><span class="line">   <span class="string">"password"</span>:<span class="string">"mypassword"</span>,</span><br><span class="line">   <span class="string">"timeout"</span>:300, </span><br><span class="line">   <span class="string">"method"</span>:<span class="string">"aes-256-cfb"</span>, </span><br><span class="line">   <span class="string">"fast_open"</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="0x03-start-server"><a href="#0x03-start-server" class="headerlink" title="0x03 start server"></a>0x03 start server</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssserver -c /etc/shadowsocks.json</span><br></pre></td></tr></table></figure><p>后台启动和停止服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssserver -c /etc/shadowsocks.json -d start </span><br><span class="line">ssserver -c /etc/shadowsocks.json -d stop</span><br></pre></td></tr></table></figure><h2 id="0X04-download"><a href="#0X04-download" class="headerlink" title="0X04 download"></a>0X04 download</h2><p>下载<a href="https://github.com/shadowsocks" target="_blank" rel="noopener">请戳</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ubuntu-shadow-socket&quot;&gt;&lt;a href=&quot;#ubuntu-shadow-socket&quot; class=&quot;headerlink&quot; title=&quot;ubuntu shadow-socket&quot;&gt;&lt;/a&gt;ubuntu shadow-socket&lt;/h1&gt;&lt;
      
    
    </summary>
    
    
      <category term="linux" scheme="https://ywmy210.github.io/ywmy/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>centos 7 zabbix proxy</title>
    <link href="https://ywmy210.github.io/ywmy/2019/04/04/centos-7-zabbix-proxy/"/>
    <id>https://ywmy210.github.io/ywmy/2019/04/04/centos-7-zabbix-proxy/</id>
    <published>2019-04-04T00:47:36.000Z</published>
    <updated>2019-04-04T16:05:35.031Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CentOS-7-安装配置Zabbix-Proxy"><a href="#CentOS-7-安装配置Zabbix-Proxy" class="headerlink" title="CentOS 7 安装配置Zabbix Proxy"></a>CentOS 7 安装配置Zabbix Proxy</h1><h2 id="安装数据库"><a href="#安装数据库" class="headerlink" title="安装数据库"></a>安装数据库</h2><ul><li>安装mariadb </li></ul><p>可以参考链接[centos 安装 mariadb][1]。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install mariadb mariadb-server</span><br></pre></td></tr></table></figure><ul><li>启用服务</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl start mariadb</span><br><span class="line">systemctl status mariadb </span><br><span class="line">systemctl <span class="built_in">enable</span> mariadb    //开机自启动</span><br></pre></td></tr></table></figure><h2 id="安装zabbix-proxy-zabbix-agent"><a href="#安装zabbix-proxy-zabbix-agent" class="headerlink" title="安装zabbix_proxy,zabbix_agent"></a>安装zabbix_proxy,zabbix_agent</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh https://repo.zabbix.com/zabbix/4.2/rhel/7/x86_64/zabbix-release-4.2-1.el7.noarch.rpm</span><br><span class="line">yum clean all </span><br><span class="line">yum install zabbix-proxy zabbix-agent</span><br></pre></td></tr></table></figure><h2 id="配置数据库"><a href="#配置数据库" class="headerlink" title="配置数据库"></a>配置数据库</h2><ul><li>初始化配置</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql -uroot -p</span></span><br><span class="line">password</span><br><span class="line">mysql&gt; create database zabbix character <span class="built_in">set</span> utf8 collate utf8_bin;</span><br><span class="line">mysql&gt; grant all privileges on zabbix.* to zabbix@localhost identified by <span class="string">'password'</span>;</span><br><span class="line">mysql&gt; quit;</span><br></pre></td></tr></table></figure><ul><li>导入数据库</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zcat /usr/share/doc/zabbix-proxy-mysql-4.2.0/schema.sql.gz | mysql -uzabbix -p zabbix_proxy</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;CentOS-7-安装配置Zabbix-Proxy&quot;&gt;&lt;a href=&quot;#CentOS-7-安装配置Zabbix-Proxy&quot; class=&quot;headerlink&quot; title=&quot;CentOS 7 安装配置Zabbix Proxy&quot;&gt;&lt;/a&gt;CentOS 7 安装
      
    
    </summary>
    
    
      <category term="linux" scheme="https://ywmy210.github.io/ywmy/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>华为GPON配置说明</title>
    <link href="https://ywmy210.github.io/ywmy/2019/04/02/%E5%8D%8E%E4%B8%BAGPON%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E/"/>
    <id>https://ywmy210.github.io/ywmy/2019/04/02/华为GPON配置说明/</id>
    <published>2019-04-02T02:13:56.000Z</published>
    <updated>2019-04-02T04:36:23.319Z</updated>
    
    <content type="html"><![CDATA[<p>#华为GPON配置说明</p><h2 id="名词说明"><a href="#名词说明" class="headerlink" title="名词说明"></a>名词说明</h2><ol><li>DBA模块：创建的dba模板时，给tcont引的，dba模板的作用是对整中ONU上行进行限速的。一个PON口上行带宽为1G，实际能用到的只有900M，所以要对ONU的上行进行合理分配。</li><li>Tcont：tcont是连接dba和gemport的通道，也就是说emport是通过和tcont联系，才把dba的作用引用过来的。</li><li>Gemport：gemport是OLT线程工作的最小单元，前面的dba，tcont都是最终给gemport用。</li><li>线路模板ont-lineprofile：ONU注册时要选择相应的线路模板，里面包含tcont，gem等信息。</li><li>DBA模板，线路模板，可以创建多个；一个线路模板中：tcont有八个（0－7），gem可以创建128个（0－127）；一个gem中可有映射8个：gem mapping 1 0；gem mapping 1 1；一直到gem mapping 1 7；但是一个线路模板中最多只能创建128条gem mapping，超出会报错。</li></ol><h2 id="数据规划"><a href="#数据规划" class="headerlink" title="数据规划"></a>数据规划</h2><p>以花都狮岭数据规划为例：</p><p>OLT：网管VLAN 22；</p><pre><code>IP：172.17.21.132；网关：172.17.21.129；语音VLAN 100；语音IP：172.16.0.11</code></pre><p>ONU：所属OLT的PON串口0/18/3<br>    ONUID：1<br>    ONU网管IP：172.17.21.134；网关：172.17.21.129；<br>    语音VLAN 100；语音IP：172.16.0.21</p><p>数据配置</p><ol><li><p>数据配置</p><ul><li><p>创建DBA模板</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">dba-profile add profile-id 102 profile-name DBA_2M type3 assure 2048 max 10240   //保证（assure）2M，最大10M</span><br><span class="line"></span><br><span class="line">查看DBA模板信息</span><br><span class="line"></span><br><span class="line">display dba-profile all </span><br><span class="line"></span><br><span class="line">//以上命令，关于type：</span><br><span class="line">type1                 Fixed bandwidth       //固定带宽</span><br><span class="line">type2                 Assured bandwidth             //保证带宽</span><br><span class="line">type3                 Assured bandwidth, Maximum bandwidth          //保证带宽，最大峰值带宽</span><br><span class="line">type4                 Maximum bandwidth         //最大带宽</span><br><span class="line">type5                 Fixed bandwidth, Assured bandwidth, Maximum bandwidth             //固定带宽，保证带宽，最大带宽</span><br><span class="line"></span><br><span class="line">dba-profile add profile-id 105 profile-name DBA_5M type3 assure 5210 max 20480</span><br><span class="line">dba-profile add profile-id 120 profile-name DBA_20M type3 assure 20480 max 102400</span><br><span class="line">dba-profile add profile-ed 150 profile-anem DBA_50M type3 assure 51200 max 512000</span><br><span class="line"></span><br><span class="line">创建线路模板</span><br><span class="line"></span><br><span class="line">创建线路模板101：供ONU ID 1到5 用；由于一个线路模板中gem mapping最多只能创建128条；故一个线路模板不要被过多的ONU调用。</span><br><span class="line"></span><br><span class="line">ont-lineprofile gpon profile-id 101 profile-name MA561-_1_5</span><br><span class="line"></span><br><span class="line">查看线路信息：</span><br><span class="line"></span><br><span class="line">display ont-lineprofile gpon all</span><br><span class="line"></span><br><span class="line">查看具体线路信息</span><br><span class="line"></span><br><span class="line">BJ-BaiGongShi-JingQu-MA5608T(config)#display ont-lineprofile gpon profile-id 122 </span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line">Profile-ID          :122</span><br><span class="line">Profile-name        :PWGB_10G</span><br><span class="line">Access-type         :GPON</span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line">FEC upstream switch :Disable </span><br><span class="line">OMCC encrypt switch :Off</span><br><span class="line">Qos mode            :GEM-CAR</span><br><span class="line">Mapping mode        :VLAN</span><br><span class="line">TR069 management    :Disable</span><br><span class="line">TR069 IP index      :0</span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line">&lt;T-CONT   0&gt;          DBA Profile-ID:1</span><br><span class="line">&lt;T-CONT   1&gt;          DBA Profile-ID:90</span><br><span class="line">&lt;Gem Index 1&gt;</span><br><span class="line">--------------------------------------------------------------------</span><br><span class="line">|Serv-Type:ETH |Encrypt:off |Cascade:off |GEM-CAR:6            |</span><br><span class="line">|Upstream-priority-queue:-  |Downstream-priority-queue:-       |</span><br><span class="line">--------------------------------------------------------------------</span><br><span class="line">Mapping VLAN  Priority Port    Port  Bundle  Flow  Transparent</span><br><span class="line">index                  type    ID    ID      CAR   </span><br><span class="line">--------------------------------------------------------------------</span><br><span class="line">0       30    -        -       -     -       -     -          </span><br><span class="line">1       10    -        -       -     -       -     -          </span><br><span class="line">--------------------------------------------------------------------</span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line">Notes: Run the display traffic table ip command to query </span><br><span class="line">     traffic table configuration</span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line">Binding times       :0</span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">线路模板的编号为101，模板名称MA5610_1_5</span><br><span class="line"></span><br><span class="line">tcont 1 dba-profile-id 120</span><br><span class="line">//tcont1绑定120的DBA模板</span><br><span class="line">tcont 2 dba-profile-id 105</span><br><span class="line">//tcont2绑定105的DBA模板</span><br><span class="line">tcont 3 dba-profile-id 102</span><br><span class="line">//tcont3绑定102的DBA模板</span><br><span class="line"></span><br><span class="line">gem add 1 eth1 tcont 1</span><br><span class="line">//gem 1 绑定tcont1</span><br><span class="line">gem add 2 eth2 tcont 2</span><br><span class="line">//gem 2 绑定tont1</span><br><span class="line">gem add 126 eth tcont 2</span><br><span class="line">//gem 126 绑定 tcont2</span><br><span class="line">gem add 127 eth tcont 3 </span><br><span class="line">//gem 126 绑定 tcont3</span><br><span class="line">gem mapping 126 0 vlan 100</span><br><span class="line">//gem 126 与 vlan 100 映射</span><br><span class="line">gem mapping 127 0 vlan 22</span><br><span class="line">//gem 的 127 与 vlan 22 映射</span><br><span class="line"></span><br><span class="line">commit</span><br><span class="line">//提交，保存线路模板</span><br><span class="line"></span><br><span class="line">quit</span><br><span class="line"></span><br><span class="line">创建线路模板102：供ONU ID 6到10 用</span><br><span class="line">ont-lineprofile gpon profile-id 102 profile-nanme MA5610_6_10</span><br><span class="line"></span><br><span class="line">tcont 1 dba-profile-id 120</span><br><span class="line">tcont 2 dba-profile-id 105</span><br><span class="line">tcont 3 dba-profile-id 102</span><br><span class="line">gem add 1 eth tcont 1</span><br><span class="line">gem add 2 eth tcont 1</span><br><span class="line">gem add 126 eth tcont 2</span><br><span class="line">gem add 127 eth tcont 3</span><br><span class="line">gem mapping 126 0 vlan 100</span><br><span class="line">gem mapping 127 0 vlan 22</span><br><span class="line">commit </span><br><span class="line">quit </span><br><span class="line"></span><br><span class="line">创建线路模板103：供 ONU ID 11到15 用</span><br><span class="line">ont-lineprofile gpon profile-id 103 profile-name MA5610_11_15</span><br><span class="line">tcont 1 dba-profile-id 120</span><br><span class="line">tcont 2 dba-profile-id 105</span><br><span class="line">tcont 3 dba-profile-id 102</span><br><span class="line"></span><br><span class="line">gem add 1 eth tcont 1</span><br><span class="line">gem add 2 eth tcont 1</span><br><span class="line">gem add 126 eth tcont 2</span><br><span class="line">gem add 127 eth tcont 3</span><br><span class="line">gem mapping 126 0 vlan 100</span><br><span class="line">gem mapping 127 0 vlan 22</span><br><span class="line">commit</span><br><span class="line">quit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">创建线路模板104：供ONU ID 16到20 用</span><br><span class="line">ont-line-profile gpen profile-id 104 profile-name MA5610_16_20</span><br><span class="line">tcont 1 dba-profile-id 120</span><br><span class="line">tcont 2 dba-profile-id 105</span><br><span class="line">tcont 3 dba-profile-id 102</span><br><span class="line">gem add 1 eth tcont 1</span><br><span class="line">gem add 2 eth tcont 1</span><br><span class="line">gem add 126 eth tcont 2</span><br><span class="line">gem add 127 eth tcont 3</span><br><span class="line">gem mapping 126 0 vlan 100</span><br><span class="line">gem mapping 127 0 vlan 22</span><br><span class="line">commit </span><br><span class="line">quit</span><br></pre></td></tr></table></figure></li></ul></li></ol><ul><li>注册ONU</li></ul><p>进入0/18槽口的PON板</p><p>intface gpon 0/18</p><p>ont add 3 1 sn-auth 48575443FFE2329A snap ont-lineprofile-id 101</p><p>给ONU注册，第三个PON口，ONU编号1，SN号：48575443FFE2329A</p><p>ont ipconfig 3 1 static ip-address 172.17.21.134 mask 255.255.255.128 gateway 172.17.21.129 vlan 22</p><p>给刚刚注册的ONU，下发管理IP地址，网关掩码，ONU上会自动生成一条缺少路由。</p><ul><li>OLT上透传ONU上来的VLAN</li></ul><p>service-port vlan 22 gpon 1/18/3 ont 1 gemport 127 multi-service user-vlan 22 </p><p>//给ONU透传网管VLAN22</p><p>service-port vlan 100 gpon 0/18/3 ont 1 gemport 126 multi-service user-vlan 100</p><p>//ONU透传语音VLAN100</p><p>ONU上语音数据配置</p><p>telnet 172.17.21.134 登入到ONU上配置数据</p><p>board confim 0</p><p>//单板确认</p><p>fax-modem parameters rfc2198-start-mode disable Rfc21985SmartStartup</p><p>//关闭2198自启动功能</p><p>vlan 100 smart </p><p>//创建语音VLAN 100</p><p>port vlan 100 0/0 1</p><p>//透传VLAN 100</p><p>interface vlanif 100</p><p>ip address 172.16.0.23 255.255.254.0</p><p>//配置语音地址</p><p>quit</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;#华为GPON配置说明&lt;/p&gt;
&lt;h2 id=&quot;名词说明&quot;&gt;&lt;a href=&quot;#名词说明&quot; class=&quot;headerlink&quot; title=&quot;名词说明&quot;&gt;&lt;/a&gt;名词说明&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;DBA模块：创建的dba模板时，给tcont引的，dba模板的作用是对整中
      
    
    </summary>
    
    
      <category term="network" scheme="https://ywmy210.github.io/ywmy/tags/network/"/>
    
  </entry>
  
  <entry>
    <title>install Open.Vpn on CentOS 7 with easy-rsa 3</title>
    <link href="https://ywmy210.github.io/ywmy/2019/04/02/install-Open-Vpn-on-CentOS-7-with-easy-rsa-3/"/>
    <id>https://ywmy210.github.io/ywmy/2019/04/02/install-Open-Vpn-on-CentOS-7-with-easy-rsa-3/</id>
    <published>2019-04-01T16:01:01.000Z</published>
    <updated>2019-04-01T17:19:44.012Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CentOS-7-Open-Vpn-WITH-easyrsa-3"><a href="#CentOS-7-Open-Vpn-WITH-easyrsa-3" class="headerlink" title="CentOS 7 Open.Vpn WITH easyrsa 3"></a>CentOS 7 Open.Vpn WITH easyrsa 3</h1><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><blockquote><p>CentOS Linux release 7.6.1810 (Core)<br>openvpn-2.4.7-1.el7.x86_64<br>easy-rsa-3.0.3-1.el7.noarch</p></blockquote><p>两人个概念：</p><ul><li>PKI：Public Key Infrastructure，公钥基础设施</li><li>CA：Certificate Authority，PKI的核心</li></ul><p>操作步骤：</p><ul><li>init-pki      //建立一个空的PKI结构</li><li>build-ca      //创建CA</li><li>gen-dh        //创建diffie-hellman文件</li><li>gen-req       //创建证书</li><li>sign-req      //签约证书</li></ul><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release</span><br><span class="line">yum install openvpn easy-rsa</span><br></pre></td></tr></table></figure><p>写在前面，一件重要的事情，时间同步有重要性，在一次配置中，配置结束后，客户端认证错误，大概报错内容：VERIFY ERROR: depth=1, error=certificate is noe yes valid:CN=xxxx</p><p>后查看服务器时间，发现时间不对，于是，更新时间，后报错消失。</p><p>更新时间操作如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install ntp ntpdate</span><br><span class="line">ntpdate 0.cn.pool.ntp.org</span><br></pre></td></tr></table></figure><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><ul><li>复制模版到配置文件目录</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/doc/openvpn-2.4.7/sample/sample-config-files/server.conf /etc/openvpn/your_config_file_name.conf</span><br></pre></td></tr></table></figure><ul><li>修改配置文件</li></ul><p>修改配置如下：</p><p>取消注释</p><p>tls-auth ta.key</p><p>取消注释</p><p>topology subnet</p><p>TCP／UDP看自己需求，我这边配置的为TCP</p><p>取消注释</p><p>push “redirect-gateway def1 bypass-dhcp”</p><p>取消注释</p><p>push “dhcp-option DNS 223.5.5.5”<br>push “dhcp-option DNS 223.6.6.6”</p><p>以上为阿里云的DNS</p><p>取消注释</p><p>duplicate-cn</p><p>取消注释</p><p>comp-lzo</p><p>取消注释</p><p>user nobody<br>group nobody</p><p>使用的TCP协议通信的，以下是重点：</p><p>explicit-exit-notify 只在udp模式下起作用，如果使用TCP，请更改为以下：</p><p>explicit-exit-notify 1<br>to<br>explicit-exit-notify 0</p><p>最终配置文件如下所示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="comment"># Sample OpenVPN 2.0 config file for            #</span></span><br><span class="line"><span class="comment"># multi-client server.                          #</span></span><br><span class="line"><span class="comment">#                                               #</span></span><br><span class="line"><span class="comment"># This file is for the server side              #</span></span><br><span class="line"><span class="comment"># of a many-clients &lt;-&gt; one-server              #</span></span><br><span class="line"><span class="comment"># OpenVPN configuration.                        #</span></span><br><span class="line"><span class="comment">#                                               #</span></span><br><span class="line"><span class="comment"># OpenVPN also supports                         #</span></span><br><span class="line"><span class="comment"># single-machine &lt;-&gt; single-machine             #</span></span><br><span class="line"><span class="comment"># configurations (See the Examples page         #</span></span><br><span class="line"><span class="comment"># on the web site for more info).               #</span></span><br><span class="line"><span class="comment">#                                               #</span></span><br><span class="line"><span class="comment"># This config should work on Windows            #</span></span><br><span class="line"><span class="comment"># or Linux/BSD systems.  Remember on            #</span></span><br><span class="line"><span class="comment"># Windows to quote pathnames and use            #</span></span><br><span class="line"><span class="comment"># double backslashes, e.g.:                     #</span></span><br><span class="line"><span class="comment"># "C:\\Program Files\\OpenVPN\\config\\foo.key" #</span></span><br><span class="line"><span class="comment">#                                               #</span></span><br><span class="line"><span class="comment"># Comments are preceded with '#' or ';'         #</span></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Which local IP address should OpenVPN</span></span><br><span class="line"><span class="comment"># listen on? (optional)</span></span><br><span class="line">;<span class="built_in">local</span> a.b.c.d</span><br><span class="line"></span><br><span class="line"><span class="comment"># Which TCP/UDP port should OpenVPN listen on?</span></span><br><span class="line"><span class="comment"># If you want to run multiple OpenVPN instances</span></span><br><span class="line"><span class="comment"># on the same machine, use a different port</span></span><br><span class="line"><span class="comment"># number for each one.  You will need to</span></span><br><span class="line"><span class="comment"># open up this port on your firewall.</span></span><br><span class="line">port 1194</span><br><span class="line"></span><br><span class="line"><span class="comment"># TCP or UDP server?</span></span><br><span class="line">proto tcp</span><br><span class="line">;proto udp</span><br><span class="line"></span><br><span class="line"><span class="comment"># "dev tun" will create a routed IP tunnel,</span></span><br><span class="line"><span class="comment"># "dev tap" will create an ethernet tunnel.</span></span><br><span class="line"><span class="comment"># Use "dev tap0" if you are ethernet bridging</span></span><br><span class="line"><span class="comment"># and have precreated a tap0 virtual interface</span></span><br><span class="line"><span class="comment"># and bridged it with your ethernet interface.</span></span><br><span class="line"><span class="comment"># If you want to control access policies</span></span><br><span class="line"><span class="comment"># over the VPN, you must create firewall</span></span><br><span class="line"><span class="comment"># rules for the the TUN/TAP interface.</span></span><br><span class="line"><span class="comment"># On non-Windows systems, you can give</span></span><br><span class="line"><span class="comment"># an explicit unit number, such as tun0.</span></span><br><span class="line"><span class="comment"># On Windows, use "dev-node" for this.</span></span><br><span class="line"><span class="comment"># On most systems, the VPN will not function</span></span><br><span class="line"><span class="comment"># unless you partially or fully disable</span></span><br><span class="line"><span class="comment"># the firewall for the TUN/TAP interface.</span></span><br><span class="line">;dev tap</span><br><span class="line">dev tun</span><br><span class="line"></span><br><span class="line"><span class="comment"># Windows needs the TAP-Win32 adapter name</span></span><br><span class="line"><span class="comment"># from the Network Connections panel if you</span></span><br><span class="line"><span class="comment"># have more than one.  On XP SP2 or higher,</span></span><br><span class="line"><span class="comment"># you may need to selectively disable the</span></span><br><span class="line"><span class="comment"># Windows firewall for the TAP adapter.</span></span><br><span class="line"><span class="comment"># Non-Windows systems usually don't need this.</span></span><br><span class="line">;dev-node MyTap</span><br><span class="line"></span><br><span class="line"><span class="comment"># SSL/TLS root certificate (ca), certificate</span></span><br><span class="line"><span class="comment"># (cert), and private key (key).  Each client</span></span><br><span class="line"><span class="comment"># and the server must have their own cert and</span></span><br><span class="line"><span class="comment"># key file.  The server and all clients will</span></span><br><span class="line"><span class="comment"># use the same ca file.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># See the "easy-rsa" directory for a series</span></span><br><span class="line"><span class="comment"># of scripts for generating RSA certificates</span></span><br><span class="line"><span class="comment"># and private keys.  Remember to use</span></span><br><span class="line"><span class="comment"># a unique Common Name for the server</span></span><br><span class="line"><span class="comment"># and each of the client certificates.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Any X509 key management system can be used.</span></span><br><span class="line"><span class="comment"># OpenVPN can also use a PKCS #12 formatted key file</span></span><br><span class="line"><span class="comment"># (see "pkcs12" directive in man page).</span></span><br><span class="line">ca /etc/openvpn/easy-rsa/pki/ca.crt</span><br><span class="line">cert /etc/openvpn/easy-rsa/pki/issued/your_server.crt</span><br><span class="line">key /etc/openvpn/easy-rsa/pki/private/your_server.key  <span class="comment"># This file should be kept secret</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Diffie hellman parameters.</span></span><br><span class="line"><span class="comment"># Generate your own with:</span></span><br><span class="line"><span class="comment">#   openssl dhparam -out dh2048.pem 2048</span></span><br><span class="line">dh /etc/openvpn/easy-rsa/pki/dh.pem</span><br><span class="line"></span><br><span class="line"><span class="comment"># Network topology</span></span><br><span class="line"><span class="comment"># Should be subnet (addressing via IP)</span></span><br><span class="line"><span class="comment"># unless Windows clients v2.0.9 and lower have to</span></span><br><span class="line"><span class="comment"># be supported (then net30, i.e. a /30 per client)</span></span><br><span class="line"><span class="comment"># Defaults to net30 (not recommended)</span></span><br><span class="line">;topology subnet</span><br><span class="line"></span><br><span class="line"><span class="comment"># Configure server mode and supply a VPN subnet</span></span><br><span class="line"><span class="comment"># for OpenVPN to draw client addresses from.</span></span><br><span class="line"><span class="comment"># The server will take 10.8.0.1 for itself,</span></span><br><span class="line"><span class="comment"># the rest will be made available to clients.</span></span><br><span class="line"><span class="comment"># Each client will be able to reach the server</span></span><br><span class="line"><span class="comment"># on 10.8.0.1. Comment this line out if you are</span></span><br><span class="line"><span class="comment"># ethernet bridging. See the man page for more info.</span></span><br><span class="line">server 10.8.0.0 255.255.255.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># Maintain a record of client &lt;-&gt; virtual IP address</span></span><br><span class="line"><span class="comment"># associations in this file.  If OpenVPN goes down or</span></span><br><span class="line"><span class="comment"># is restarted, reconnecting clients can be assigned</span></span><br><span class="line"><span class="comment"># the same virtual IP address from the pool that was</span></span><br><span class="line"><span class="comment"># previously assigned.</span></span><br><span class="line">ifconfig-pool-persist ipp.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># Configure server mode for ethernet bridging.</span></span><br><span class="line"><span class="comment"># You must first use your OS's bridging capability</span></span><br><span class="line"><span class="comment"># to bridge the TAP interface with the ethernet</span></span><br><span class="line"><span class="comment"># NIC interface.  Then you must manually set the</span></span><br><span class="line"><span class="comment"># IP/netmask on the bridge interface, here we</span></span><br><span class="line"><span class="comment"># assume 10.8.0.4/255.255.255.0.  Finally we</span></span><br><span class="line"><span class="comment"># must set aside an IP range in this subnet</span></span><br><span class="line"><span class="comment"># (start=10.8.0.50 end=10.8.0.100) to allocate</span></span><br><span class="line"><span class="comment"># to connecting clients.  Leave this line commented</span></span><br><span class="line"><span class="comment"># out unless you are ethernet bridging.</span></span><br><span class="line">;server-bridge 10.8.0.4 255.255.255.0 10.8.0.50 10.8.0.100</span><br><span class="line"></span><br><span class="line"><span class="comment"># Configure server mode for ethernet bridging</span></span><br><span class="line"><span class="comment"># using a DHCP-proxy, where clients talk</span></span><br><span class="line"><span class="comment"># to the OpenVPN server-side DHCP server</span></span><br><span class="line"><span class="comment"># to receive their IP address allocation</span></span><br><span class="line"><span class="comment"># and DNS server addresses.  You must first use</span></span><br><span class="line"><span class="comment"># your OS's bridging capability to bridge the TAP</span></span><br><span class="line"><span class="comment"># interface with the ethernet NIC interface.</span></span><br><span class="line"><span class="comment"># Note: this mode only works on clients (such as</span></span><br><span class="line"><span class="comment"># Windows), where the client-side TAP adapter is</span></span><br><span class="line"><span class="comment"># bound to a DHCP client.</span></span><br><span class="line">;server-bridge</span><br><span class="line"></span><br><span class="line"><span class="comment"># Push routes to the client to allow it</span></span><br><span class="line"><span class="comment"># to reach other private subnets behind</span></span><br><span class="line"><span class="comment"># the server.  Remember that these</span></span><br><span class="line"><span class="comment"># private subnets will also need</span></span><br><span class="line"><span class="comment"># to know to route the OpenVPN client</span></span><br><span class="line"><span class="comment"># address pool (10.8.0.0/255.255.255.0)</span></span><br><span class="line"><span class="comment"># back to the OpenVPN server.</span></span><br><span class="line">;push <span class="string">"route 192.168.10.0 255.255.255.0"</span></span><br><span class="line">;push <span class="string">"route 192.168.20.0 255.255.255.0"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># To assign specific IP addresses to specific</span></span><br><span class="line"><span class="comment"># clients or if a connecting client has a private</span></span><br><span class="line"><span class="comment"># subnet behind it that should also have VPN access,</span></span><br><span class="line"><span class="comment"># use the subdirectory "ccd" for client-specific</span></span><br><span class="line"><span class="comment"># configuration files (see man page for more info).</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># EXAMPLE: Suppose the client</span></span><br><span class="line"><span class="comment"># having the certificate common name "Thelonious"</span></span><br><span class="line"><span class="comment"># also has a small subnet behind his connecting</span></span><br><span class="line"><span class="comment"># machine, such as 192.168.40.128/255.255.255.248.</span></span><br><span class="line"><span class="comment"># First, uncomment out these lines:</span></span><br><span class="line">;client-config-dir ccd</span><br><span class="line">;route 192.168.40.128 255.255.255.248</span><br><span class="line"><span class="comment"># Then create a file ccd/Thelonious with this line:</span></span><br><span class="line"><span class="comment">#   iroute 192.168.40.128 255.255.255.248</span></span><br><span class="line"><span class="comment"># This will allow Thelonious' private subnet to</span></span><br><span class="line"><span class="comment"># access the VPN.  This example will only work</span></span><br><span class="line"><span class="comment"># if you are routing, not bridging, i.e. you are</span></span><br><span class="line"><span class="comment"># using "dev tun" and "server" directives.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># EXAMPLE: Suppose you want to give</span></span><br><span class="line"><span class="comment"># Thelonious a fixed VPN IP address of 10.9.0.1.</span></span><br><span class="line"><span class="comment"># First uncomment out these lines:</span></span><br><span class="line">;client-config-dir ccd</span><br><span class="line">;route 10.9.0.0 255.255.255.252</span><br><span class="line"><span class="comment"># Then add this line to ccd/Thelonious:</span></span><br><span class="line"><span class="comment">#   ifconfig-push 10.9.0.1 10.9.0.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Suppose that you want to enable different</span></span><br><span class="line"><span class="comment"># firewall access policies for different groups</span></span><br><span class="line"><span class="comment"># of clients.  There are two methods:</span></span><br><span class="line"><span class="comment"># (1) Run multiple OpenVPN daemons, one for each</span></span><br><span class="line"><span class="comment">#     group, and firewall the TUN/TAP interface</span></span><br><span class="line"><span class="comment">#     for each group/daemon appropriately.</span></span><br><span class="line"><span class="comment"># (2) (Advanced) Create a script to dynamically</span></span><br><span class="line"><span class="comment">#     modify the firewall in response to access</span></span><br><span class="line"><span class="comment">#     from different clients.  See man</span></span><br><span class="line"><span class="comment">#     page for more info on learn-address script.</span></span><br><span class="line">;learn-address ./script</span><br><span class="line"></span><br><span class="line"><span class="comment"># If enabled, this directive will configure</span></span><br><span class="line"><span class="comment"># all clients to redirect their default</span></span><br><span class="line"><span class="comment"># network gateway through the VPN, causing</span></span><br><span class="line"><span class="comment"># all IP traffic such as web browsing and</span></span><br><span class="line"><span class="comment"># and DNS lookups to go through the VPN</span></span><br><span class="line"><span class="comment"># (The OpenVPN server machine may need to NAT</span></span><br><span class="line"><span class="comment"># or bridge the TUN/TAP interface to the internet</span></span><br><span class="line"><span class="comment"># in order for this to work properly).</span></span><br><span class="line">push <span class="string">"redirect-gateway def1 bypass-dhcp"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Certain Windows-specific network settings</span></span><br><span class="line"><span class="comment"># can be pushed to clients, such as DNS</span></span><br><span class="line"><span class="comment"># or WINS server addresses.  CAVEAT:</span></span><br><span class="line"><span class="comment"># http://openvpn.net/faq.html#dhcpcaveats</span></span><br><span class="line"><span class="comment"># The addresses below refer to the public</span></span><br><span class="line"><span class="comment"># DNS servers provided by opendns.com.</span></span><br><span class="line">push <span class="string">"dhcp-option DNS 223.5.5.5"</span></span><br><span class="line">push <span class="string">"dhcp-option DNS 223.6.6.6"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Uncomment this directive to allow different</span></span><br><span class="line"><span class="comment"># clients to be able to "see" each other.</span></span><br><span class="line"><span class="comment"># By default, clients will only see the server.</span></span><br><span class="line"><span class="comment"># To force clients to only see the server, you</span></span><br><span class="line"><span class="comment"># will also need to appropriately firewall the</span></span><br><span class="line"><span class="comment"># server's TUN/TAP interface.</span></span><br><span class="line">;client-to-client</span><br><span class="line"></span><br><span class="line"><span class="comment"># Uncomment this directive if multiple clients</span></span><br><span class="line"><span class="comment"># might connect with the same certificate/key</span></span><br><span class="line"><span class="comment"># files or common names.  This is recommended</span></span><br><span class="line"><span class="comment"># only for testing purposes.  For production use,</span></span><br><span class="line"><span class="comment"># each client should have its own certificate/key</span></span><br><span class="line"><span class="comment"># pair.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># IF YOU HAVE NOT GENERATED INDIVIDUAL</span></span><br><span class="line"><span class="comment"># CERTIFICATE/KEY PAIRS FOR EACH CLIENT,</span></span><br><span class="line"><span class="comment"># EACH HAVING ITS OWN UNIQUE "COMMON NAME",</span></span><br><span class="line"><span class="comment"># UNCOMMENT THIS LINE OUT.</span></span><br><span class="line">duplicate-cn</span><br><span class="line"></span><br><span class="line"><span class="comment"># The keepalive directive causes ping-like</span></span><br><span class="line"><span class="comment"># messages to be sent back and forth over</span></span><br><span class="line"><span class="comment"># the link so that each side knows when</span></span><br><span class="line"><span class="comment"># the other side has gone down.</span></span><br><span class="line"><span class="comment"># Ping every 10 seconds, assume that remote</span></span><br><span class="line"><span class="comment"># peer is down if no ping received during</span></span><br><span class="line"><span class="comment"># a 120 second time period.</span></span><br><span class="line">keepalive 10 120</span><br><span class="line"></span><br><span class="line"><span class="comment"># For extra security beyond that provided</span></span><br><span class="line"><span class="comment"># by SSL/TLS, create an "HMAC firewall"</span></span><br><span class="line"><span class="comment"># to help block DoS attacks and UDP port flooding.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Generate with:</span></span><br><span class="line"><span class="comment">#   openvpn --genkey --secret ta.key</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The server and each client must have</span></span><br><span class="line"><span class="comment"># a copy of this key.</span></span><br><span class="line"><span class="comment"># The second parameter should be '0'</span></span><br><span class="line"><span class="comment"># on the server and '1' on the clients.</span></span><br><span class="line">tls-auth ta.key 0 <span class="comment"># This file is secret</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Select a cryptographic cipher.</span></span><br><span class="line"><span class="comment"># This config item must be copied to</span></span><br><span class="line"><span class="comment"># the client config file as well.</span></span><br><span class="line"><span class="comment"># Note that v2.4 client/server will automatically</span></span><br><span class="line"><span class="comment"># negotiate AES-256-GCM in TLS mode.</span></span><br><span class="line"><span class="comment"># See also the ncp-cipher option in the manpage</span></span><br><span class="line">cipher AES-256-CBC</span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable compression on the VPN link and push the</span></span><br><span class="line"><span class="comment"># option to the client (v2.4+ only, for earlier</span></span><br><span class="line"><span class="comment"># versions see below)</span></span><br><span class="line">;compress lz4-v2</span><br><span class="line">;push <span class="string">"compress lz4-v2"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># For compression compatible with older clients use comp-lzo</span></span><br><span class="line"><span class="comment"># If you enable it here, you must also</span></span><br><span class="line"><span class="comment"># enable it in the client config file.</span></span><br><span class="line">comp-lzo</span><br><span class="line"></span><br><span class="line"><span class="comment"># The maximum number of concurrently connected</span></span><br><span class="line"><span class="comment"># clients we want to allow.</span></span><br><span class="line">;max-clients 100</span><br><span class="line"></span><br><span class="line"><span class="comment"># It's a good idea to reduce the OpenVPN</span></span><br><span class="line"><span class="comment"># daemon's privileges after initialization.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You can uncomment this out on</span></span><br><span class="line"><span class="comment"># non-Windows systems.</span></span><br><span class="line">user nobody</span><br><span class="line">group nobody</span><br><span class="line"></span><br><span class="line"><span class="comment"># The persist options will try to avoid</span></span><br><span class="line"><span class="comment"># accessing certain resources on restart</span></span><br><span class="line"><span class="comment"># that may no longer be accessible because</span></span><br><span class="line"><span class="comment"># of the privilege downgrade.</span></span><br><span class="line">persist-key</span><br><span class="line">persist-tun</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output a short status file showing</span></span><br><span class="line"><span class="comment"># current connections, truncated</span></span><br><span class="line"><span class="comment"># and rewritten every minute.</span></span><br><span class="line">status openvpn-status.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># By default, log messages will go to the syslog (or</span></span><br><span class="line"><span class="comment"># on Windows, if running as a service, they will go to</span></span><br><span class="line"><span class="comment"># the "\Program Files\OpenVPN\log" directory).</span></span><br><span class="line"><span class="comment"># Use log or log-append to override this default.</span></span><br><span class="line"><span class="comment"># "log" will truncate the log file on OpenVPN startup,</span></span><br><span class="line"><span class="comment"># while "log-append" will append to it.  Use one</span></span><br><span class="line"><span class="comment"># or the other (but not both).</span></span><br><span class="line"><span class="built_in">log</span>         openvpn.log</span><br><span class="line"><span class="built_in">log</span>-append  openvpn.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the appropriate level of log</span></span><br><span class="line"><span class="comment"># file verbosity.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 0 is silent, except for fatal errors</span></span><br><span class="line"><span class="comment"># 4 is reasonable for general usage</span></span><br><span class="line"><span class="comment"># 5 and 6 can help to debug connection problems</span></span><br><span class="line"><span class="comment"># 9 is extremely verbose</span></span><br><span class="line">verb 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># Silence repeating messages.  At most 20</span></span><br><span class="line"><span class="comment"># sequential messages of the same message</span></span><br><span class="line"><span class="comment"># category will be output to the log.</span></span><br><span class="line">;mute 20</span><br><span class="line"></span><br><span class="line"><span class="comment"># Notify the client that when the server restarts so it</span></span><br><span class="line"><span class="comment"># can automatically reconnect.</span></span><br><span class="line"><span class="comment">#explicit-exit-notify 1</span></span><br></pre></td></tr></table></figure><p>生成ta.key文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openvpn --genkey --secret ta.key</span><br></pre></td></tr></table></figure><h3 id="生成证书及签约"><a href="#生成证书及签约" class="headerlink" title="生成证书及签约"></a>生成证书及签约</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mkdir /etc/openvpn/easr-rsa</span><br><span class="line">cp -rf /usr/share/easy-rsa/3.0.3/* /etc/openvpn/easy-rsa</span><br><span class="line"><span class="built_in">cd</span> /etc/openvpn/easy-rsa</span><br><span class="line"></span><br><span class="line">./easyrsa init-pki</span><br><span class="line">./easyrsa build-ca</span><br><span class="line"></span><br><span class="line">./easyrsa gen-req your_server nopass        //创建服务端证书</span><br><span class="line">./easyrsa gen-req your_client nopass         //创建客户端证书</span><br><span class="line">./easyrsa sign-req server your_server               //签约服务端证书</span><br><span class="line">./easy-rsa sign-req client your_client              //签约客户端证书</span><br><span class="line">./easyrsa gen-dh</span><br></pre></td></tr></table></figure><p>记住此时配置的目录结构，要记住与服务的conf文件中目录路径一致。</p><h3 id="转发及防火墙配置"><a href="#转发及防火墙配置" class="headerlink" title="转发及防火墙配置"></a>转发及防火墙配置</h3><ul><li>配置转发</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysctl.conf</span><br><span class="line">//添加一行</span><br><span class="line">net.ipv4.ip_forward =1</span><br></pre></td></tr></table></figure><p>重启服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart network.service</span><br></pre></td></tr></table></figure><ul><li>防火墙配置</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --add-port=1194</span><br><span class="line">firewall-cmd --add-masquerade </span><br><span class="line">firewall-cmd --complete-reload</span><br></pre></td></tr></table></figure><h3 id="启用服务"><a href="#启用服务" class="headerlink" title="启用服务"></a>启用服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">systemctl start openvpn@your_config</span><br><span class="line">systemctl status openvpn@your_conf</span><br><span class="line">//输出如下：</span><br><span class="line">● openvpn@bldjvpn.service - OpenVPN Robust And Highly Flexible Tunneling Application On bldjvpn</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/openvpn@.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Mon 2019-04-01 23:29:10 CST; 1h 27min ago</span><br><span class="line"> Main PID: 25355 (openvpn)</span><br><span class="line">   Status: <span class="string">"Initialization Sequence Completed"</span></span><br><span class="line">   CGroup: /system.slice/system-openvpn.slice/openvpn@your_conf.service</span><br><span class="line">           └─25355 /usr/sbin/openvpn --<span class="built_in">cd</span> /etc/openvpn/ --co...</span><br><span class="line"></span><br><span class="line">Apr 01 23:29:10 bldj-vpn systemd[1]: Starting OpenVPN Robust...</span><br><span class="line">Apr 01 23:29:10 bldj-vpn systemd[1]: Started OpenVPN Robust ...</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show <span class="keyword">in</span> full.</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> openvpn@your_conf      //开机自启动</span><br></pre></td></tr></table></figure><h3 id="配置客户端"><a href="#配置客户端" class="headerlink" title="配置客户端"></a>配置客户端</h3><p>在/etc/openvpn/client目录下创建如下目录结构：</p><blockquote><p>.<br>├── base.conf<br>├── files<br>├── keys<br>│   ├── your_client.crt<br>│   ├── your_client.key<br>│   ├── ca.crt<br>│   └── ta.key<br>└── make_conf.sh  </p></blockquote><p>files文件输出为客户端的配置文件，keys文件用来存储需要客户端证书文件。</p><p>复制这些文件到files目录：</p><blockquote><p>/etc/openvpn/easy-rsa/pki/ca.crt<br>/etc/openvpn/easy-rsa/pki/issued/your_client.crt<br>/etc/openvpn/easy-rsa/pki/private/your_client.key<br>/etc/openvpn/ta.key  </p></blockquote><p>配置客户端配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/doc/openvpn-2.4.7/sample/sample-config-files/client.conf /etc/openvpn/client/base.conf</span><br></pre></td></tr></table></figure><p>配置参考如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">##############################################</span></span><br><span class="line"><span class="comment"># Sample client-side OpenVPN 2.0 config file #</span></span><br><span class="line"><span class="comment"># for connecting to multi-client server.     #</span></span><br><span class="line"><span class="comment">#                                            #</span></span><br><span class="line"><span class="comment"># This configuration can be used by multiple #</span></span><br><span class="line"><span class="comment"># clients, however each client should have   #</span></span><br><span class="line"><span class="comment"># its own cert and key files.                #</span></span><br><span class="line"><span class="comment">#                                            #</span></span><br><span class="line"><span class="comment"># On Windows, you might want to rename this  #</span></span><br><span class="line"><span class="comment"># file so it has a .ovpn extension           #</span></span><br><span class="line"><span class="comment">##############################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specify that we are a client and that we</span></span><br><span class="line"><span class="comment"># will be pulling certain config file directives</span></span><br><span class="line"><span class="comment"># from the server.</span></span><br><span class="line">client</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use the same setting as you are using on</span></span><br><span class="line"><span class="comment"># the server.</span></span><br><span class="line"><span class="comment"># On most systems, the VPN will not function</span></span><br><span class="line"><span class="comment"># unless you partially or fully disable</span></span><br><span class="line"><span class="comment"># the firewall for the TUN/TAP interface.</span></span><br><span class="line">;dev tap</span><br><span class="line">dev tun</span><br><span class="line"></span><br><span class="line"><span class="comment"># Windows needs the TAP-Win32 adapter name</span></span><br><span class="line"><span class="comment"># from the Network Connections panel</span></span><br><span class="line"><span class="comment"># if you have more than one.  On XP SP2,</span></span><br><span class="line"><span class="comment"># you may need to disable the firewall</span></span><br><span class="line"><span class="comment"># for the TAP adapter.</span></span><br><span class="line">;dev-node MyTap</span><br><span class="line"></span><br><span class="line"><span class="comment"># Are we connecting to a TCP or</span></span><br><span class="line"><span class="comment"># UDP server?  Use the same setting as</span></span><br><span class="line"><span class="comment"># on the server.</span></span><br><span class="line">proto tcp</span><br><span class="line">;proto udp</span><br><span class="line"></span><br><span class="line"><span class="comment"># The hostname/IP and port of the server.</span></span><br><span class="line"><span class="comment"># You can have multiple remote entries</span></span><br><span class="line"><span class="comment"># to load balance between the servers.</span></span><br><span class="line">remote your_server port_number</span><br><span class="line">;remote my-server-2 1194</span><br><span class="line"></span><br><span class="line"><span class="comment"># Choose a random host from the remote</span></span><br><span class="line"><span class="comment"># list for load-balancing.  Otherwise</span></span><br><span class="line"><span class="comment"># try hosts in the order specified.</span></span><br><span class="line">;remote-random</span><br><span class="line"></span><br><span class="line"><span class="comment"># Keep trying indefinitely to resolve the</span></span><br><span class="line"><span class="comment"># host name of the OpenVPN server.  Very useful</span></span><br><span class="line"><span class="comment"># on machines which are not permanently connected</span></span><br><span class="line"><span class="comment"># to the internet such as laptops.</span></span><br><span class="line">resolv-retry infinite</span><br><span class="line"></span><br><span class="line"><span class="comment"># Most clients don't need to bind to</span></span><br><span class="line"><span class="comment"># a specific local port number.</span></span><br><span class="line">nobind</span><br><span class="line"></span><br><span class="line"><span class="comment"># Downgrade privileges after initialization (non-Windows only)</span></span><br><span class="line">;user nobody</span><br><span class="line">;group nobody</span><br><span class="line"></span><br><span class="line"><span class="comment"># Try to preserve some state across restarts.</span></span><br><span class="line">persist-key</span><br><span class="line">persist-tun</span><br><span class="line"></span><br><span class="line"><span class="comment"># If you are connecting through an</span></span><br><span class="line"><span class="comment"># HTTP proxy to reach the actual OpenVPN</span></span><br><span class="line"><span class="comment"># server, put the proxy server/IP and</span></span><br><span class="line"><span class="comment"># port number here.  See the man page</span></span><br><span class="line"><span class="comment"># if your proxy server requires</span></span><br><span class="line"><span class="comment"># authentication.</span></span><br><span class="line">;http-proxy-retry <span class="comment"># retry on connection failures</span></span><br><span class="line">;http-proxy [proxy server] [proxy port <span class="comment">#]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Wireless networks often produce a lot</span></span><br><span class="line"><span class="comment"># of duplicate packets.  Set this flag</span></span><br><span class="line"><span class="comment"># to silence duplicate packet warnings.</span></span><br><span class="line">;mute-replay-warnings</span><br><span class="line"></span><br><span class="line"><span class="comment"># SSL/TLS parms.</span></span><br><span class="line"><span class="comment"># See the server config file for more</span></span><br><span class="line"><span class="comment"># description.  It's best to use</span></span><br><span class="line"><span class="comment"># a separate .crt/.key file pair</span></span><br><span class="line"><span class="comment"># for each client.  A single ca</span></span><br><span class="line"><span class="comment"># file can be used for all clients.</span></span><br><span class="line">ca ca.crt</span><br><span class="line">cert client.crt</span><br><span class="line">key client.key</span><br><span class="line"></span><br><span class="line"><span class="comment"># Verify server certificate by checking that the</span></span><br><span class="line"><span class="comment"># certicate has the correct key usage set.</span></span><br><span class="line"><span class="comment"># This is an important precaution to protect against</span></span><br><span class="line"><span class="comment"># a potential attack discussed here:</span></span><br><span class="line"><span class="comment">#  http://openvpn.net/howto.html#mitm</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># To use this feature, you will need to generate</span></span><br><span class="line"><span class="comment"># your server certificates with the keyUsage set to</span></span><br><span class="line"><span class="comment">#   digitalSignature, keyEncipherment</span></span><br><span class="line"><span class="comment"># and the extendedKeyUsage to</span></span><br><span class="line"><span class="comment">#   serverAuth</span></span><br><span class="line"><span class="comment"># EasyRSA can do this for you.</span></span><br><span class="line">remote-cert-tls server</span><br><span class="line"></span><br><span class="line"><span class="comment"># If a tls-auth key is used on the server</span></span><br><span class="line"><span class="comment"># then every client must also have the key.</span></span><br><span class="line">tls-auth ta.key 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># Select a cryptographic cipher.</span></span><br><span class="line"><span class="comment"># If the cipher option is used on the server</span></span><br><span class="line"><span class="comment"># then you must also specify it here.</span></span><br><span class="line"><span class="comment"># Note that v2.4 client/server will automatically</span></span><br><span class="line"><span class="comment"># negotiate AES-256-GCM in TLS mode.</span></span><br><span class="line"><span class="comment"># See also the ncp-cipher option in the manpage</span></span><br><span class="line">cipher AES-256-CBC</span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable compression on the VPN link.</span></span><br><span class="line"><span class="comment"># Don't enable this unless it is also</span></span><br><span class="line"><span class="comment"># enabled in the server config file.</span></span><br><span class="line">comp-lzo</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set log file verbosity.</span></span><br><span class="line">verb 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># Silence repeating messages</span></span><br><span class="line">;mute 20</span><br><span class="line">auth-user-pass</span><br></pre></td></tr></table></figure><p>创建配置脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">vim make_conf.sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># First argument: Client identifier</span></span><br><span class="line"></span><br><span class="line">KEY_DIR=./keys</span><br><span class="line">OUTPUT_DIR=./files</span><br><span class="line">BASE_CONFIG=./base.conf</span><br><span class="line"></span><br><span class="line">cat <span class="variable">$&#123;BASE_CONFIG&#125;</span> \</span><br><span class="line">    &lt;(<span class="built_in">echo</span> -e <span class="string">'&lt;ca&gt;'</span>) \</span><br><span class="line">    <span class="variable">$&#123;KEY_DIR&#125;</span>/ca.crt \</span><br><span class="line">    &lt;(<span class="built_in">echo</span> -e <span class="string">'&lt;/ca&gt;\n&lt;cert&gt;'</span>) \</span><br><span class="line">    <span class="variable">$&#123;KEY_DIR&#125;</span>/<span class="variable">$&#123;1&#125;</span>.crt \</span><br><span class="line">    &lt;(<span class="built_in">echo</span> -e <span class="string">'&lt;/cert&gt;\n&lt;key&gt;'</span>) \</span><br><span class="line">    <span class="variable">$&#123;KEY_DIR&#125;</span>/<span class="variable">$&#123;1&#125;</span>.key \</span><br><span class="line">    &lt;(<span class="built_in">echo</span> -e <span class="string">'&lt;/key&gt;\n&lt;tls-auth&gt;'</span>) \</span><br><span class="line">    <span class="variable">$&#123;KEY_DIR&#125;</span>/ta.key \</span><br><span class="line">    &lt;(<span class="built_in">echo</span> -e <span class="string">'&lt;/tls-auth&gt;'</span>) \</span><br><span class="line">    &gt; <span class="variable">$&#123;OUTPUT_DIR&#125;</span>/<span class="variable">$&#123;1&#125;</span>.ovpn</span><br></pre></td></tr></table></figure><p>给脚本添加执行权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod u+x make_conf.sh</span><br></pre></td></tr></table></figure><p>通过脚本生成配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./make_conf.sh your_client</span><br></pre></td></tr></table></figure><p>输出配置文件在files目录中。好了，至此配置完成，我们需要做的就是把配置文件下载到自己的电脑上，可心安心使用了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sftp -P ssh_port name@openvpn_server_ip:/etc/openvpn/client/files/client1.ovpn ~/</span><br></pre></td></tr></table></figure><p>通过文件导入OPEN.VPN客户端程序，我们就可以正常使用了。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;CentOS-7-Open-Vpn-WITH-easyrsa-3&quot;&gt;&lt;a href=&quot;#CentOS-7-Open-Vpn-WITH-easyrsa-3&quot; class=&quot;headerlink&quot; title=&quot;CentOS 7 Open.Vpn WITH easyr
      
    
    </summary>
    
    
      <category term="linux" scheme="https://ywmy210.github.io/ywmy/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>ttf-mscorefonts-installer ubuntu</title>
    <link href="https://ywmy210.github.io/ywmy/2019/04/01/ttf-mscorefonts-installer-ubuntu/"/>
    <id>https://ywmy210.github.io/ywmy/2019/04/01/ttf-mscorefonts-installer-ubuntu/</id>
    <published>2019-04-01T07:03:26.000Z</published>
    <updated>2019-04-01T07:13:53.207Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ttf-mscorefonts-installer下载额外数据失败"><a href="#ttf-mscorefonts-installer下载额外数据失败" class="headerlink" title="ttf-mscorefonts-installer下载额外数据失败"></a>ttf-mscorefonts-installer下载额外数据失败</h1><p>完成ubuntu安装后，特别是安装wine之后，电脑经常跳出更新信息：</p><blockquote><p>下载额外数据文件失败<br>以下软件包要求安装后下载附加数据，但其数据无法下载或无法处理。<br>ttf-mscorefonts-installer<br>稍后系统将自动重试下载，您也可以手工立即重试。执行此命令需要有活动的网络连接。  </p></blockquote><p>点击重试后，实际后台自动既即出。输入密码后无响应了。实际上没有执行操作。虽不影响使用，不过挺经常跳出来挺麻烦。</p><h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><ul><li>下载文件</li></ul><p>查看目录/usr/share/package-data-downloads/目录下，有一个文件ttf-mscorefonts-installer，查看内容如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Url: http://downloads.sourceforge.net/corefonts/andale32.exe</span><br><span class="line">Sha256: 0524fe42951adc3a7eb870e32f0920313c71f170c859b5f770d82b4ee111e970</span><br><span class="line"></span><br><span class="line">Url: http://downloads.sourceforge.net/corefonts/arial32.exe</span><br><span class="line">Sha256: 85297a4d146e9c87ac6f74822734bdee5f4b2a722d7eaa584b7f2cbf76f478f6</span><br><span class="line"></span><br><span class="line">Url: http://downloads.sourceforge.net/corefonts/arialb32.exe</span><br><span class="line">Sha256: a425f0ffb6a1a5ede5b979ed6177f4f4f4fdef6ae7c302a7b7720ef332fec0a8</span><br><span class="line"></span><br><span class="line">Url: http://downloads.sourceforge.net/corefonts/comic32.exe</span><br><span class="line">Sha256: 9c6df3feefde26d4e41d4a4fe5db2a89f9123a772594d7f59afd062625cd204e</span><br><span class="line"></span><br><span class="line">Url: http://downloads.sourceforge.net/corefonts/courie32.exe</span><br><span class="line">Sha256: bb511d861655dde879ae552eb86b134d6fae67cb58502e6ff73ec5d9151f3384</span><br><span class="line"></span><br><span class="line">Url: http://downloads.sourceforge.net/corefonts/georgi32.exe</span><br><span class="line">Sha256: 2c2c7dcda6606ea5cf08918fb7cd3f3359e9e84338dc690013f20cd42e930301</span><br><span class="line"></span><br><span class="line">Url: http://downloads.sourceforge.net/corefonts/impact32.exe</span><br><span class="line">Sha256: 6061ef3b7401d9642f5dfdb5f2b376aa14663f6275e60a51207ad4facf2fccfb</span><br><span class="line"></span><br><span class="line">Url: http://downloads.sourceforge.net/corefonts/times32.exe</span><br><span class="line">Sha256: db56595ec6ef5d3de5c24994f001f03b2a13e37cee27bc25c58f6f43e8f807ab</span><br><span class="line"></span><br><span class="line">Url: http://downloads.sourceforge.net/corefonts/trebuc32.exe</span><br><span class="line">Sha256: 5a690d9bb8510be1b8b4fe49f1f2319651fe51bbe54775ddddd8ef0bd07fdac9</span><br><span class="line"></span><br><span class="line">Url: http://downloads.sourceforge.net/corefonts/verdan32.exe</span><br><span class="line">Sha256: c1cb61255e363166794e47664e2f21af8e3a26cb6346eb8d2ae2fa85dd5aad96</span><br><span class="line"></span><br><span class="line">Url: http://downloads.sourceforge.net/corefonts/webdin32.exe</span><br><span class="line">Sha256: 64595b5abc1080fba8610c5c34fab5863408e806aafe84653ca8575bed17d75a</span><br><span class="line"></span><br><span class="line">Script: /usr/lib/msttcorefonts/update-ms-fonts</span><br><span class="line">Should-Download: msttcorefonts/accepted-mscorefonts-eula</span><br></pre></td></tr></table></figure><p>可以看到11个文件的下载链接。直接下载字体文件，放在一个文件夹里。如/home/yourname/ttf-mscorefonts/目录下。</p><ul><li>手动更新</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg-reconfigure ttf-mscorefonts-installer</span><br></pre></td></tr></table></figure><p>指定下载字体的目录，确认安装配置。</p><ul><li>删除下载失败的通知信息</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/share/package-data-downloads/</span><br><span class="line">sudo rm ttf-mscorefonts-installer</span><br><span class="line"><span class="built_in">cd</span> /var/lib/update-notifier/package-data-downloads/</span><br><span class="line">sudo rm ttf-mscorefonts-installer</span><br><span class="line"><span class="built_in">cd</span> /var/lib/update-notifier/user.d/</span><br><span class="line">sudo rm data-downloads-failed</span><br></pre></td></tr></table></figure><p>至此更新结束。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ttf-mscorefonts-installer下载额外数据失败&quot;&gt;&lt;a href=&quot;#ttf-mscorefonts-installer下载额外数据失败&quot; class=&quot;headerlink&quot; title=&quot;ttf-mscorefonts-installer下
      
    
    </summary>
    
    
      <category term="linux" scheme="https://ywmy210.github.io/ywmy/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>windows 脚本更改密码/远程端口/开放防火墙端口</title>
    <link href="https://ywmy210.github.io/ywmy/2019/03/31/windows-%E8%84%9A%E6%9C%AC%E6%9B%B4%E6%94%B9%E5%AF%86%E7%A0%81-%E8%BF%9C%E7%A8%8B%E7%AB%AF%E5%8F%A3-%E5%BC%80%E6%94%BE%E9%98%B2%E7%81%AB%E5%A2%99%E7%AB%AF%E5%8F%A3/"/>
    <id>https://ywmy210.github.io/ywmy/2019/03/31/windows-脚本更改密码-远程端口-开放防火墙端口/</id>
    <published>2019-03-31T08:12:21.000Z</published>
    <updated>2019-03-31T08:52:59.673Z</updated>
    
    <content type="html"><![CDATA[<h1 id="脚本更改用户密码-远程端口-开放防火墙端口"><a href="#脚本更改用户密码-远程端口-开放防火墙端口" class="headerlink" title="脚本更改用户密码/远程端口/开放防火墙端口"></a>脚本更改用户密码/远程端口/开放防火墙端口</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line">:begin</span><br><span class="line"><span class="built_in">echo</span> %Date% %Time% &gt;&gt; change.txt</span><br><span class="line"><span class="built_in">echo</span> <span class="comment">#######################</span></span><br><span class="line"><span class="built_in">set</span> /p input=请输入需要修改的密码:</span><br><span class="line"><span class="built_in">echo</span> 密码修改为:%input% &gt;&gt; change.txt</span><br><span class="line">net user administrator %input% &amp;&amp; <span class="built_in">echo</span> 密码修改成功 || <span class="built_in">echo</span> 密码修改失败，输入密码为弱密码，请重新输入强密码 &amp;&amp; goto begin</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="comment">##############</span></span><br><span class="line"><span class="built_in">echo</span> 修改远程桌面端口</span><br><span class="line"><span class="built_in">echo</span> <span class="comment">##############</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> /p c=请输入新的远程登录端口:</span><br><span class="line">reg add <span class="string">"HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\Wds\rdpwd\Tds\tcp"</span> /v <span class="string">"PortNumber"</span> /t REG_DWORD /d <span class="string">"%c"</span> /f</span><br><span class="line">reg add <span class="string">"HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp"</span> /v <span class="string">"PortNumber"</span> /t REG_DWORD /d <span class="string">"%c"</span> /f</span><br><span class="line"><span class="built_in">echo</span> 远程桌面端口更改为：%c% &gt;&gt; change.txt</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="comment">######################</span></span><br><span class="line"><span class="built_in">echo</span> 配置防火墙开放远程端口%c%</span><br><span class="line"><span class="built_in">echo</span> <span class="comment">######################</span></span><br><span class="line"></span><br><span class="line">netsh firewall show state | findstr 操作模式 &gt; %temp%\1.txt</span><br><span class="line"><span class="built_in">set</span> /p a= &lt;%temp%\1.txt</span><br><span class="line"><span class="built_in">set</span> b=%a:~-2%</span><br><span class="line">del %temp%\1.txt</span><br><span class="line"><span class="keyword">if</span> <span class="string">"%b%"</span>==<span class="string">"启用"</span> (<span class="built_in">echo</span> 防火墙已经开放%c%端口 &amp;&amp; netsh firewall <span class="built_in">set</span> protopening TCP %c% <span class="built_in">enable</span> &gt; NUL) <span class="keyword">else</span> <span class="built_in">echo</span> 防火墙未开启，无须配置</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="comment">##########</span></span><br><span class="line"><span class="built_in">echo</span> 重启生效</span><br><span class="line"><span class="built_in">echo</span> <span class="comment">##########</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;脚本更改用户密码-远程端口-开放防火墙端口&quot;&gt;&lt;a href=&quot;#脚本更改用户密码-远程端口-开放防火墙端口&quot; class=&quot;headerlink&quot; title=&quot;脚本更改用户密码/远程端口/开放防火墙端口&quot;&gt;&lt;/a&gt;脚本更改用户密码/远程端口/开放防火墙端口&lt;/
      
    
    </summary>
    
    
      <category term="windows" scheme="https://ywmy210.github.io/ywmy/tags/windows/"/>
    
  </entry>
  
  <entry>
    <title>centos 7 配置ntp服务</title>
    <link href="https://ywmy210.github.io/ywmy/2019/03/31/centos-7-%E9%85%8D%E7%BD%AEntp%E6%9C%8D%E5%8A%A1/"/>
    <id>https://ywmy210.github.io/ywmy/2019/03/31/centos-7-配置ntp服务/</id>
    <published>2019-03-31T06:36:44.000Z</published>
    <updated>2019-03-31T07:09:50.852Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CentOS配置ntp-server"><a href="#CentOS配置ntp-server" class="headerlink" title="CentOS配置ntp server"></a>CentOS配置ntp server</h1><p>网络时间协议 - NTP - 是运行在传输层 123 号端口的 UDP 协议，它允许计算机通过网络同步准确时间。随着时间的流逝，计算机内部时间会出现漂移，这会导致时间不一致问题，尤其是对于服务器和客户端日志文件，或者你想要复制服务器的资源或数据库。</p><h2 id="安装和配置ntp-serve"><a href="#安装和配置ntp-serve" class="headerlink" title="安装和配置ntp serve"></a>安装和配置ntp serve</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>可直接通过官方yum安装。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install ntp</span><br></pre></td></tr></table></figure><h3 id="选择NTP-SERVER"><a href="#选择NTP-SERVER" class="headerlink" title="选择NTP SERVER"></a>选择NTP SERVER</h3><p>NTP Public Pool Time Servers，安装NTP后，可以在NTP公共服务器池中选择所在地理位置的服务器列表。服务池链接[请戳][1]。</p><p>如中国的服务器池为：</p><blockquote><p>0.cn.pool.ntp.org<br>1.cn.pool.ntp.org<br>2.cn.pool.ntp.org<br>3.cn.pool.ntp.org  </p></blockquote><h3 id="更改ntp服务配置文件"><a href="#更改ntp服务配置文件" class="headerlink" title="更改ntp服务配置文件"></a>更改ntp服务配置文件</h3><p>配置文件为/etc/ntp.conf：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ntp.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># For more information about this file, see the man pages</span></span><br><span class="line"><span class="comment"># ntp.conf(5), ntp_acc(5), ntp_auth(5), ntp_clock(5), ntp_misc(5), ntp_mon(5).</span></span><br><span class="line"></span><br><span class="line">driftfile /var/lib/ntp/drift</span><br><span class="line"></span><br><span class="line"><span class="comment"># Permit time synchronization with our time source, but do not</span></span><br><span class="line"><span class="comment"># permit the source to query or modify the service on this system.</span></span><br><span class="line">restrict default nomodify notrap nopeer noquery</span><br><span class="line"></span><br><span class="line"><span class="comment"># Permit all access over the loopback interface.  This could</span></span><br><span class="line"><span class="comment"># be tightened as well, but to do so would effect some of</span></span><br><span class="line"><span class="comment"># the administrative functions.</span></span><br><span class="line">restrict 127.0.0.1 </span><br><span class="line">restrict ::1</span><br><span class="line"></span><br><span class="line"><span class="comment"># Hosts on local network are less restricted.</span></span><br><span class="line"><span class="comment">#restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap</span></span><br><span class="line"></span><br><span class="line">restrict 172.17.10.0 mask 255.255.255.0 nomodify notrap</span><br><span class="line">restrict 52.109.3.0 mask 255.255.255.0 nomodify notrap</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use public servers from the pool.ntp.org project.</span></span><br><span class="line"><span class="comment"># Please consider joining the pool (http://www.pool.ntp.org/join.html).</span></span><br><span class="line">server 0.cn.pool.ntp.org</span><br><span class="line">server 1.cn.pool.ntp.org</span><br><span class="line">server 2.cn.pool.ntp.org</span><br><span class="line">server 3.cn.pool.ntp.org</span><br><span class="line"></span><br><span class="line"><span class="comment">#broadcast 192.168.1.255 autokey        # broadcast server</span></span><br><span class="line"><span class="comment">#broadcastclient                        # broadcast client</span></span><br><span class="line"><span class="comment">#broadcast 224.0.1.1 autokey            # multicast server</span></span><br><span class="line"><span class="comment">#multicastclient 224.0.1.1              # multicast client</span></span><br><span class="line"><span class="comment">#manycastserver 239.255.254.254         # manycast server</span></span><br><span class="line"><span class="comment">#manycastclient 239.255.254.254 autokey # manycast client</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable public key cryptography.</span></span><br><span class="line"><span class="comment">#crypto</span></span><br><span class="line"></span><br><span class="line">includefile /etc/ntp/crypto/pw</span><br><span class="line"></span><br><span class="line"><span class="comment"># Key file containing the keys and key identifiers used when operating</span></span><br><span class="line"><span class="comment"># with symmetric key cryptography. </span></span><br><span class="line">keys /etc/ntp/keys</span><br><span class="line"></span><br><span class="line"><span class="comment"># Specify the key identifiers which are trusted.</span></span><br><span class="line"><span class="comment">#trustedkey 4 8 42</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specify the key identifier to use with the ntpdc utility.</span></span><br><span class="line"><span class="comment">#requestkey 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specify the key identifier to use with the ntpq utility.</span></span><br><span class="line"><span class="comment">#controlkey 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable writing of statistics records.</span></span><br><span class="line"><span class="comment">#statistics clockstats cryptostats loopstats peerstats</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable the monitoring facility to prevent amplification attacks using ntpdc</span></span><br><span class="line"><span class="comment"># monlist command when default restrict does not include the noquery flag. See</span></span><br><span class="line"><span class="comment"># CVE-2013-5211 for more details.</span></span><br><span class="line"><span class="comment"># Note: Monitoring will not be disabled with the limited restriction flag.</span></span><br><span class="line"><span class="built_in">disable</span> monitor</span><br><span class="line"></span><br><span class="line">logfile /var/<span class="built_in">log</span>/ntp.log</span><br></pre></td></tr></table></figure><p>更改如上所示：</p><blockquote><p>restrict 172.17.10.0 mask 255.255.255.0 nomodify notrap</p></blockquote><p>nomodify notrap 语句意味着不允许你的客户端配置服务器或者作为同步时间的节点。</p><blockquote><p>logfile /var/log/ntp.log  </p></blockquote><p>如果需要用于错误处理的额外信息，以防你的 NTP 守护进程出现问题，添加一个 logfile 语句，用于记录所有 NTP 服务器问题到一个指定的日志文件。</p><p>保存配置文件。</p><h2 id="启用服务以及防火墙配置"><a href="#启用服务以及防火墙配置" class="headerlink" title="启用服务以及防火墙配置"></a>启用服务以及防火墙配置</h2><h3 id="开放NTP-SERVE端口"><a href="#开放NTP-SERVE端口" class="headerlink" title="开放NTP SERVE端口"></a>开放NTP SERVE端口</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --add-service=ntp --permanent</span><br><span class="line">sudo firewall-cmd --complete-reload</span><br></pre></td></tr></table></figure><h3 id="启用NTP-SERVER"><a href="#启用NTP-SERVER" class="headerlink" title="启用NTP SERVER"></a>启用NTP SERVER</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start ntpd</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> ntpd</span><br><span class="line">sudo systemctl status ntpd</span><br><span class="line"></span><br><span class="line">● ntpd.service - Network Time Service</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/ntpd.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Sun 2019-03-31 14:33:27 CST; 23min ago</span><br><span class="line"> Main PID: 14926 (ntpd)</span><br><span class="line">   CGroup: /system.slice/ntpd.service</span><br><span class="line">           └─14926 /usr/sbin/ntpd -u ntp:ntp -g</span><br><span class="line"></span><br><span class="line">Mar 31 14:33:27 ntp-server systemd[1]: Starting Network Time Service...</span><br><span class="line">Mar 31 14:33:27 ntp-server systemd[1]: Started Network Time Service.</span><br><span class="line">Mar 31 14:33:27 ntp-server ntpd[14926]: proto: precision = 0.054 usec</span><br><span class="line">Mar 31 14:33:27 ntp-server ntpd[14926]: 0.0.0.0 c01d 0d kern kernel time sync enabled</span><br></pre></td></tr></table></figure><h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@ntp-server ~]<span class="comment"># ntpq -p</span></span><br><span class="line">     remote           refid      st t when poll reach   delay   offset  jitter</span><br><span class="line">==============================================================================</span><br><span class="line"> ntp1.ams1.nl.le 130.133.1.10     2 u  309  128  104  286.324  -30.954   2.799</span><br><span class="line">*electrode.felix 89.231.96.83     2 u   79  128  177  245.661   -4.341  11.315</span><br><span class="line"> 118.190.21.209  .STEP.          16 u    - 1024    0    0.000    0.000   0.000</span><br><span class="line"> biisoni.miuku.n .STEP.          16 u    - 1024    0    0.000    0.000   0.000</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ntp-server ~]<span class="comment"># date -R</span></span><br><span class="line">Sun, 31 Mar 2019 15:06:12 +0800</span><br></pre></td></tr></table></figure><p>查询ntp服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@ntp-server ~]<span class="comment"># ntpdate -q 0.cn.pool.ntp.org</span></span><br><span class="line">server 78.46.102.180, stratum 2, offset -0.004452, delay 0.25752</span><br><span class="line">server 51.15.238.170, stratum 0, offset 0.000000, delay 0.00000</span><br><span class="line">server 199.182.204.197, stratum 0, offset 0.000000, delay 0.00000</span><br><span class="line">server 94.130.49.186, stratum 3, offset -0.021914, delay 0.32487</span><br><span class="line">31 Mar 15:09:05 ntpdate[24663]: adjust time server 78.46.102.180 offset -0.004452 sec</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;CentOS配置ntp-server&quot;&gt;&lt;a href=&quot;#CentOS配置ntp-server&quot; class=&quot;headerlink&quot; title=&quot;CentOS配置ntp server&quot;&gt;&lt;/a&gt;CentOS配置ntp server&lt;/h1&gt;&lt;p&gt;网络时间协议
      
    
    </summary>
    
    
      <category term="linux" scheme="https://ywmy210.github.io/ywmy/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>华为获取诊断信息文件</title>
    <link href="https://ywmy210.github.io/ywmy/2019/03/29/%E5%8D%8E%E4%B8%BA%E8%8E%B7%E5%8F%96%E8%AF%8A%E6%96%AD%E4%BF%A1%E6%81%AF%E6%96%87%E4%BB%B6/"/>
    <id>https://ywmy210.github.io/ywmy/2019/03/29/华为获取诊断信息文件/</id>
    <published>2019-03-29T09:29:09.000Z</published>
    <updated>2019-03-29T09:33:08.398Z</updated>
    
    <content type="html"><![CDATA[<h1 id="华为交换机获取诊断信息"><a href="#华为交换机获取诊断信息" class="headerlink" title="华为交换机获取诊断信息"></a>华为交换机获取诊断信息</h1><p>获取设备诊断信息，用于判断设备故障。</p><h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;HEXIN&gt;display diagnostic-information dia-info.txt</span><br><span class="line">Now saving the diagnostic information to the device</span><br><span class="line">34%/        //输出进度</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;华为交换机获取诊断信息&quot;&gt;&lt;a href=&quot;#华为交换机获取诊断信息&quot; class=&quot;headerlink&quot; title=&quot;华为交换机获取诊断信息&quot;&gt;&lt;/a&gt;华为交换机获取诊断信息&lt;/h1&gt;&lt;p&gt;获取设备诊断信息，用于判断设备故障。&lt;/p&gt;
&lt;h2 id=&quot;操作&quot;
      
    
    </summary>
    
    
      <category term="network" scheme="https://ywmy210.github.io/ywmy/tags/network/"/>
    
  </entry>
  
  <entry>
    <title>更改windows默认3389端口</title>
    <link href="https://ywmy210.github.io/ywmy/2019/03/29/%E6%9B%B4%E6%94%B9windows%E9%BB%98%E8%AE%A43389%E7%AB%AF%E5%8F%A3/"/>
    <id>https://ywmy210.github.io/ywmy/2019/03/29/更改windows默认3389端口/</id>
    <published>2019-03-29T08:45:38.000Z</published>
    <updated>2019-03-29T09:06:17.435Z</updated>
    
    <content type="html"><![CDATA[<h1 id="windows远程端口更改"><a href="#windows远程端口更改" class="headerlink" title="windows远程端口更改"></a>windows远程端口更改</h1><p>windows默认远程协议RDP端口为3389，更改默认端口操作如下：</p><h2 id="通过注册表更改默认RDP端口"><a href="#通过注册表更改默认RDP端口" class="headerlink" title="通过注册表更改默认RDP端口"></a>通过注册表更改默认RDP端口</h2><p>WIN+R运行程序regedit。注册表编辑器。</p><p>HKEY_LOCAL_MACHINE -&gt; SYSTEM -&gt; CurrentControlSet -&gt; Control -&gt; Terminal Server -&gt; Wds -&gt; rdpwd -&gt; Tds -tcp -&gt; PortNumber -&gt; 基数用十进制方式显示 -&gt; 更改为想要的端口号</p><p>HKEY_LOCAL_MACHINE -&gt; SYSTEM -&gt; CurrentControlSet -&gt; Control -&gt; Terminal Server -&gt; WinStations -&gt; RDP-Tcp -&gt; PortNumber -&gt; 基数用十进制方式显示 -&gt; 更改为想要的端口号</p><p>重启系统后，使用新的端口号进行远程连接。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;windows远程端口更改&quot;&gt;&lt;a href=&quot;#windows远程端口更改&quot; class=&quot;headerlink&quot; title=&quot;windows远程端口更改&quot;&gt;&lt;/a&gt;windows远程端口更改&lt;/h1&gt;&lt;p&gt;windows默认远程协议RDP端口为3389，更改
      
    
    </summary>
    
    
      <category term="windows" scheme="https://ywmy210.github.io/ywmy/tags/windows/"/>
    
  </entry>
  
</feed>
